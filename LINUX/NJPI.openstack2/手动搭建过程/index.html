
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../%E5%87%A0%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84%E6%9C%AF%E8%AF%AD/">
      
      
        <link rel="next" href="../%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.5">
    
    
      
        <title>openstack_stein_2node_install 1 - 基础环境搭建 - Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openstack_stein_2node_install-1-" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="/" title="Docs" class="md-header__button md-logo" aria-label="Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              openstack_stein_2node_install 1 - 基础环境搭建
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="/" title="Docs" class="md-nav__button md-logo" aria-label="Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../Blog/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../C%2B%2B/first/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    C++
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../Hadoop/00-main/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Hadoop
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LINUX
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            LINUX
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../commend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../linux%E9%87%8D%E7%BD%AEroot%E5%AF%86%E7%A0%81/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux重置root密码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%8A%A8source%20.bashrc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    设置自动source .bashrc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../NJPI.openstack%2C%E5%8D%95%E6%9C%BA%E7%89%88/01/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    NJPI.openstack,单机版
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    NJPI.openstack2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            NJPI.openstack2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-1-nova%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 1 nova说明
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-1-neutron%28%E8%AF%B4%E6%98%8E%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    06 1 neutron(说明)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%87%A0%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84%E6%9C%AF%E8%AF%AD/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    几个有用的术语
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    openstack_stein_2node_install 1 - 基础环境搭建
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    openstack_stein_2node_install 1 - 基础环境搭建
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1、系统拓扑图
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2、基本环节搭建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2、基本环节搭建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-security" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 安全(security)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22host-networking" class="md-nav__link">
    <span class="md-ellipsis">
      2.2主机网络（host networking)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2主机网络（host networking)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221controller" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1controller节点配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-compute" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 Compute节点配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.3测试连通型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-ntp" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 配置NTP服务
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 配置NTP服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231controller" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1controller节点配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    服务安装流程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../docker/%E6%9C%AA%E5%AE%8C%E6%88%90docker/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../redhat%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%28%E4%B9%A6%29/01%E7%8E%AF%E5%A2%83%E4%BB%8B%E7%BB%8D/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Redhat系统管理(书)
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../shell/01vim%EF%BC%881%EF%BC%89/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Shell
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../unubtu/%E5%AE%89%E8%A3%85ubuntu18/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Unubtu
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../awesome-reverse-main/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Awesome reverse main
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../other/adb/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Other
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../python/Linux-%E6%A1%86%E6%9E%B6%E8%BF%90%E8%A1%8C%E8%AF%B4%E6%98%8E/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Python
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E4%BA%91%E8%AE%A1%E7%AE%97/1.%E4%BA%91%E8%AE%A1%E7%AE%97%E6%8A%80%E6%9C%AF%E4%B8%8E%E5%BA%94%E7%94%A8/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    云计算
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E5%8D%97%E5%B7%A5/java/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    南工
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../../%E8%99%9A%E6%8B%9F%E5%8C%96/01/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    虚拟化
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1、系统拓扑图
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2、基本环节搭建
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2、基本环节搭建">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-security" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 安全(security)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22host-networking" class="md-nav__link">
    <span class="md-ellipsis">
      2.2主机网络（host networking)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.2主机网络（host networking)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#221controller" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.1controller节点配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#222-compute" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.2 Compute节点配置
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#223" class="md-nav__link">
    <span class="md-ellipsis">
      2.2.3测试连通型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-ntp" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 配置NTP服务
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 配置NTP服务">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231controller" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1controller节点配置
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="openstack_stein_2node_install-1-">openstack_stein_2node_install 1 - 基础环境搭建</h1>
<h2 id="1">1、系统拓扑图</h2>
<ol>
<li>系统拓扑图
   <img alt="" src="../_v_images/20191014011328239_541166351.png" /></li>
<li>
<p>说明：</p>
</li>
<li>
<p>本次配置为两个节点的openstack</p>
</li>
<li>controller与compute节点都有两块网卡ens33,ens37</li>
<li>ens37连接192.168.10.0/24网络，此网络为管理网络（Management Network）</li>
<li>
<p>ens33连接10.10.10.0/24网络，此网络为provider网络（provider Network）,改网络为实例提供外网。改网络接口不需要配置地址。</p>
<ol>
<li><strong>注意：</strong></li>
</ol>
</li>
<li>
<p>ens33如果开始时不配置网络地址，则ens37必须能够上网，否则不能下载安装包</p>
</li>
<li>如果ens37不能够上网，只有ens33能够上网，则在配置开始时，对ens33设置ip地址，让controller节点能够连接internet，在openstack配置完成后，删除ens33的ip地址。本例中采用此方案。如下图所示：</li>
</ol>
<blockquote>
<p><img alt="" src="../_v_images/20191014011433989_789616212.png" /></p>
</blockquote>
<h2 id="2">2、基本环节搭建</h2>
<h3 id="21-security">2.1 安全(security)</h3>
<ol>
<li>openstack需要各种服务，每个服务都需要设置密码。</li>
<li>设置密码，可以使用以下代码生成随机密码：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openssl rand -hex 10</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a>ea4f99cd40067b6dcfad
</span></code></pre></div></td></tr></table></div>
<ol>
<li>openstack需要设置密码的服务</li>
</ol>
<table>
<thead>
<tr>
<th>Password name</th>
<th>Description</th>
<th>密码</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database password (no variable used)</td>
<td>Root password for the database</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>ADMIN_PASS</td>
<td>Password of user admin</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>CINDER_DBPASS</td>
<td>Database password for the Block Storage service</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>CINDER_PASS</td>
<td>Password of Block Storage service user cinder</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>DASH_DBPASS</td>
<td>Database password for the Dashboard</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>DEMO_PASS</td>
<td>Password of user demo</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>GLANCE_DBPASS</td>
<td>Database password for Image service</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>GLANCE_PASS</td>
<td>Password of Image service user glance</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>KEYSTONE_DBPASS</td>
<td>Database password of Identity service</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>METADATA_SECRET</td>
<td>Secret for the metadata proxy</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>NEUTRON_DBPASS</td>
<td>Database password for the Networking service</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>NEUTRON_PASS</td>
<td>Password of Networking service user neutron</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>NOVA_DBPASS</td>
<td>Database password for Compute service</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>NOVA_PASS</td>
<td>Password of Compute service user nova</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>PLACEMENT_PASS</td>
<td>Password of the Placement service user placement</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
<tr>
<td>RABBIT_PASS</td>
<td>Password of RabbitMQ user openstack</td>
<td>ea4f99cd40067b6dcfad</td>
</tr>
</tbody>
</table>
<ol>
<li><strong>说明：</strong>
   可以对以上密码设置一个统一的密码，如：openstack</li>
</ol>
<h3 id="22host-networking">2.2主机网络（host networking)</h3>
<h4 id="221controller">2.2.1controller节点配置</h4>
<ol>
<li>管理网络接口配置(ens37)配置：1. 管理网络接口配置(ens37)配置：g</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># cat /etc/sysconfig/network-scripts/ifcfg-ens37</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="nv">TYPE</span><span class="o">=</span>Ethernet
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nv">BOOTPROTO</span><span class="o">=</span>static
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="nv">DEFROUTE</span><span class="o">=</span>yegs
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="nv">PEERDNS</span><span class="o">=</span>yes
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="nv">PEERROUTES</span><span class="o">=</span>yes
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="nv">IPV4_FAILURE_FATAL</span><span class="o">=</span>no
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="nv">IPV6INIT</span><span class="o">=</span>yes
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="nv">IPV6_AUTOCONF</span><span class="o">=</span>yes
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="nv">IPV6_DEFROUTE</span><span class="o">=</span>yes
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="nv">IPV6_PEERDNS</span><span class="o">=</span>yes
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="nv">IPV6_PEERROUTES</span><span class="o">=</span>yes
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="nv">IPV6_FAILURE_FATAL</span><span class="o">=</span>no
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="nv">UUID</span><span class="o">=</span>af61a7aa-1a75-3758-8b1d-2e6acf6ace95
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="nv">NAME</span><span class="o">=</span>ens37
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="nv">DEVICE</span><span class="o">=</span>ens37
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="nv">ONBOOT</span><span class="o">=</span>yes
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="nv">IPADDR</span><span class="o">=</span><span class="m">192</span>.168.10.17
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="nv">NETMASK</span><span class="o">=</span><span class="m">255</span>.255.255.0
</span></code></pre></div></td></tr></table></div>
<ol>
<li>provider 网络接口(ens33）配置</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># cat /etc/sysconfig/network-scripts/ifcfg-ens33</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="nv">TYPE</span><span class="o">=</span>Ethernet
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="nv">BOOTPROTO</span><span class="o">=</span>static
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="nv">DEFROUTE</span><span class="o">=</span>yes
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="nv">PEERDNS</span><span class="o">=</span>yes
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="nv">PEERROUTES</span><span class="o">=</span>yes
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="nv">IPV4_FAILURE_FATAL</span><span class="o">=</span>no
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="nv">IPV6INIT</span><span class="o">=</span>yes
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="nv">IPV6_AUTOCONF</span><span class="o">=</span>yes
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="nv">IPV6_DEFROUTE</span><span class="o">=</span>yes
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="nv">IPV6_PEERDNS</span><span class="o">=</span>yes
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="nv">IPV6_PEERROUTES</span><span class="o">=</span>yes
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="nv">IPV6_FAILURE_FATAL</span><span class="o">=</span>no
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="nv">NAME</span><span class="o">=</span>ens33
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="nv">DEVICE</span><span class="o">=</span>ens33
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="nv">ONBOOT</span><span class="o">=</span>yes
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="nv">IPADDR</span><span class="o">=</span><span class="m">10</span>.10.10.17
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="nv">NETMASK</span><span class="o">=</span><span class="m">255</span>.255.255.0
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="nv">GATEWAY</span><span class="o">=</span><span class="m">10</span>.10.10.2
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="nv">DNS1</span><span class="o">=</span><span class="m">8</span>.8.8.8
</span></code></pre></div></td></tr></table></div>
<ol>
<li>/etc/hosts配置</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># cat /etc/hosts</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="m">127</span>.0.0.1<span class="w">   </span>localhost<span class="w"> </span>localhost.localdomain<span class="w"> </span>localhost4<span class="w"> </span>localhost4.localdomain4
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a>::1<span class="w">         </span>localhost<span class="w"> </span>localhost.localdomain<span class="w"> </span>localhost6<span class="w"> </span>localhost6.localdomain6
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="m">192</span>.168.10.17<span class="w"> </span>controller
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="m">192</span>.168.10.18<span class="w"> </span>compute
</span></code></pre></div></td></tr></table></div>
<p><strong>说明：</strong>
设置管理网络地址，不要设置provider网络地址</p>
<h4 id="222-compute">2.2.2 Compute节点配置</h4>
<ol>
<li>管理网络接口(ens37）配置</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="o">[</span>root@compute<span class="w"> </span>~<span class="o">]</span><span class="c1"># cat /etc/sysconfig/network-scripts/ifcfg-ens37</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="nv">TYPE</span><span class="o">=</span>Ethernet
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="nv">BOOTPROTO</span><span class="o">=</span>static
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="nv">DEFROUTE</span><span class="o">=</span>yes
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="nv">PEERDNS</span><span class="o">=</span>yes
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="nv">PEERROUTES</span><span class="o">=</span>yes
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="nv">IPV4_FAILURE_FATAL</span><span class="o">=</span>no
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="nv">IPV6INIT</span><span class="o">=</span>yes
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="nv">IPV6_AUTOCONF</span><span class="o">=</span>yes
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="nv">IPV6_DEFROUTE</span><span class="o">=</span>yes
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="nv">IPV6_PEERDNS</span><span class="o">=</span>yes
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="nv">IPV6_PEERROUTES</span><span class="o">=</span>yes
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="nv">IPV6_FAILURE_FATAL</span><span class="o">=</span>no
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="nv">UUID</span><span class="o">=</span>af61a7aa-1a75-3758-8b1d-2e6acf6ace95
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="nv">NAME</span><span class="o">=</span>ens37
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="nv">DEVICE</span><span class="o">=</span>ens37
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="nv">ONBOOT</span><span class="o">=</span>yes
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="nv">IPADDR</span><span class="o">=</span><span class="m">192</span>.168.10.18
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="nv">NETMASK</span><span class="o">=</span><span class="m">255</span>.255.255.02
</span></code></pre></div></td></tr></table></div>
<p>2 . provider 网络接口(ens33）配置：</p>
<p><code>shell
 [root@compute ~]# cat /etc/sysconfig/network-scripts/ifcfg-ens33
TYPE=Ethernet
BOOTPROTO=static
DEFROUTE=yes
PEERDNS=yes
PEERROUTES=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_PEERDNS=yes
IPV6_PEERROUTES=yes
IPV6_FAILURE_FATAL=no
NAME=ens33
DEVICE=ens33
ONBOOT=yes
IPADDR=10.10.10.18
NETMASK=255.255.255.0
GATEWAY=10.10.10.2
DNS1=8.8.8.8</code></p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code>3. /etc/hosts配置
   拷贝 controller节点 /etc/hosts文件到compute节点，命令如下：
</code></pre></div></td></tr></table></div>
<p><code>shell
[root@compute ~]# scp root@192.168.10.17:/etc/hosts /etc/hosts
The authenticity of host '192.168.10.17 (192.168.10.17)' can't be established.
ECDSA key fingerprint is SHA256:YHPabnLNSR7Bljly0ZgI2PxXAasnYD9K0lsQRM38kTk.
ECDSA key fingerprint is MD5:8d:be:fd:de:3a:1d:20:dc:e1:ae:b4:17:c3:a5:2f:e4.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.10.17' (ECDSA) to the list of known hosts.
root@192.168.10.17's password:
hosts                                         100%  205   182.9KB/s   00:00</code></p>
<h4 id="223">2.2.3测试连通型</h4>
<ol>
<li>controller 能否ping通 compute节点与外网</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># ping compute</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a>PING<span class="w"> </span>compute<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.18<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>compute<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.18<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.639<span class="w"> </span>ms
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>compute<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.18<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.483<span class="w"> </span>ms
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>compute<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.18<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.682<span class="w"> </span>ms
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>compute<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.18<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">4</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.833<span class="w"> </span>ms
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>compute<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.18<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">5</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.744<span class="w"> </span>ms
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a>---<span class="w"> </span>compute<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="m">5</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">5</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>4004ms
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.483/0.676/0.833/0.117<span class="w"> </span>ms
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># ping 10.10.10.18</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a>PING<span class="w"> </span><span class="m">10</span>.10.10.18<span class="w"> </span><span class="o">(</span><span class="m">10</span>.10.10.18<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.10.10.18:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.771<span class="w"> </span>ms
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.10.10.18:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.550<span class="w"> </span>ms
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.10.10.18:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.678<span class="w"> </span>ms
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a>^C
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17"></a>---<span class="w"> </span><span class="m">10</span>.10.10.18<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="m">3</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">3</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>2005ms
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.550/0.666/0.771/0.093<span class="w"> </span>ms
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># ping www.baidu.com</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21"></a>PING<span class="w"> </span>www.a.shifen.com<span class="w"> </span><span class="o">(</span><span class="m">183</span>.232.231.174<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">183</span>.232.231.174<span class="w"> </span><span class="o">(</span><span class="m">183</span>.232.231.174<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">128</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">42</span>.8<span class="w"> </span>ms
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">183</span>.232.231.174<span class="w"> </span><span class="o">(</span><span class="m">183</span>.232.231.174<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">128</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">42</span>.6<span class="w"> </span>ms
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24"></a>^C
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25"></a>---<span class="w"> </span>www.a.shifen.com<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>1005ms
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">42</span>.662/42.762/42.862/0.100<span class="w"> </span>ms
</span></code></pre></div></td></tr></table></div>
<ol>
<li>compute节点能否 ping通 controller节点与外网</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="o">[</span>root@compute<span class="w"> </span>~<span class="o">]</span><span class="c1"># ping controller</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a>PING<span class="w"> </span>controller<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.17<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>controller<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.17<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.497<span class="w"> </span>ms
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span>controller<span class="w"> </span><span class="o">(</span><span class="m">192</span>.168.10.17<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.734<span class="w"> </span>ms
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a>^C
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a>---<span class="w"> </span>controller<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>1001ms
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.497/0.615/0.734/0.121<span class="w"> </span>ms
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="o">[</span>root@compute<span class="w"> </span>~<span class="o">]</span><span class="c1"># ping 10.10.10.17</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a>PING<span class="w"> </span><span class="m">10</span>.10.10.17<span class="w"> </span><span class="o">(</span><span class="m">10</span>.10.10.17<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.10.10.17:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.478<span class="w"> </span>ms
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">10</span>.10.10.17:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">64</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">0</span>.598<span class="w"> </span>ms
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a>^C
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a>---<span class="w"> </span><span class="m">10</span>.10.10.17<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>1001ms
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.478/0.538/0.598/0.060<span class="w"> </span>ms
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="o">[</span>root@compute<span class="w"> </span>~<span class="o">]</span><span class="c1"># ping www.baidu.com</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18"></a>PING<span class="w"> </span>www.a.shifen.com<span class="w"> </span><span class="o">(</span><span class="m">183</span>.232.231.172<span class="o">)</span><span class="w"> </span><span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span><span class="w"> </span>bytes<span class="w"> </span>of<span class="w"> </span>data.
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">183</span>.232.231.172<span class="w"> </span><span class="o">(</span><span class="m">183</span>.232.231.172<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">128</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">29</span>.2<span class="w"> </span>ms
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="m">64</span><span class="w"> </span>bytes<span class="w"> </span>from<span class="w"> </span><span class="m">183</span>.232.231.172<span class="w"> </span><span class="o">(</span><span class="m">183</span>.232.231.172<span class="o">)</span>:<span class="w"> </span><span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">ttl</span><span class="o">=</span><span class="m">128</span><span class="w"> </span><span class="nv">time</span><span class="o">=</span><span class="m">30</span>.2<span class="w"> </span>ms
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21"></a>^C
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22"></a>---<span class="w"> </span>www.a.shifen.com<span class="w"> </span>ping<span class="w"> </span>statistics<span class="w"> </span>---
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="m">2</span><span class="w"> </span>packets<span class="w"> </span>transmitted,<span class="w"> </span><span class="m">2</span><span class="w"> </span>received,<span class="w"> </span><span class="m">0</span>%<span class="w"> </span>packet<span class="w"> </span>loss,<span class="w"> </span><span class="nb">time</span><span class="w"> </span>1003ms
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24"></a>rtt<span class="w"> </span>min/avg/max/mdev<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">29</span>.231/29.720/30.210/0.518<span class="w"> </span>ms
</span></code></pre></div></td></tr></table></div>
<p><strong>说明：</strong>
所有测试必须能够ping通</p>
<h3 id="23-ntp">2.3 配置NTP服务</h3>
<h4 id="231controller">2.3.1controller节点配置</h4>
<ol>
<li>安装chrony包</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># yum install chrony</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>配置/etc/chrony.conf文件
   增加两行内容：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a>server<span class="w"> </span><span class="m">192</span>.168.10.17<span class="w"> </span>iburst
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>allow<span class="w"> </span><span class="m">192</span>.168.10.0/24
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>3. 设置服务自启动与启动服务
</code></pre></div></td></tr></table></div>
<p>```shell
 # systemctl enable chronyd.service</p>
<h1 id="systemctl-start-chronydservice">systemctl start chronyd.service</h1>
<p>```</p>
<p>####  2.3.2 compute节点配置</p>
<ol>
<li>安装chrony包</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># yum install chrony</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>配置/etc/chrony.conf文件
   <strong>删除所有的server，增加1行</strong></li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a>server<span class="w"> </span>controller<span class="w">  </span>iburst
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>3. 设置服务自启动与启动服务
</code></pre></div></td></tr></table></div>
<p>```shell
 # systemctl enable chronyd.service</p>
<h1 id="systemctl-start-chronydservice_1">systemctl start chronyd.service</h1>
<p>```</p>
<h4 id="233">2.3.3 测试</h4>
<ol>
<li>controller节点</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span>
<span class="normal"><a href="#__codelineno-11-7">7</a></span>
<span class="normal"><a href="#__codelineno-11-8">8</a></span>
<span class="normal"><a href="#__codelineno-11-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># chronyc sources</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="m">210</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span><span class="nv">sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a>MS<span class="w"> </span>Name/IP<span class="w"> </span>address<span class="w">         </span>Stratum<span class="w"> </span>Poll<span class="w"> </span>Reach<span class="w"> </span>LastRx<span class="w"> </span>Last<span class="w"> </span><span class="nv">sample</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="o">===============================================================================</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a>^-<span class="w"> </span>controller<span class="w">                    </span><span class="m">3</span><span class="w">   </span><span class="m">6</span><span class="w">   </span><span class="m">377</span><span class="w">    </span><span class="m">33</span><span class="w">    </span>-16us<span class="o">[</span><span class="w">  </span>-16us<span class="o">]</span><span class="w"> </span>+/-<span class="w">   </span>21ms
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a>^*<span class="w"> </span><span class="m">203</span>.107.6.88<span class="w">                  </span><span class="m">2</span><span class="w">   </span><span class="m">8</span><span class="w">   </span><span class="m">377</span><span class="w">    </span><span class="m">90</span><span class="w">   </span>-176us<span class="o">[</span><span class="w"> </span>-227us<span class="o">]</span><span class="w"> </span>+/-<span class="w">   </span>21ms
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a>^?<span class="w"> </span>ntp1.ams1.nl.leaseweb.net<span class="w">     </span><span class="m">2</span><span class="w">   </span><span class="m">9</span><span class="w">     </span><span class="m">0</span><span class="w">   </span>39m<span class="w">    </span>+14ms<span class="o">[</span><span class="w"> </span>-9633s<span class="o">]</span><span class="w"> </span>+/-<span class="w">  </span>202ms
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a>^-<span class="w"> </span>ntp.xtom.nl<span class="w">                   </span><span class="m">2</span><span class="w">   </span><span class="m">7</span><span class="w">   </span><span class="m">377</span><span class="w">    </span><span class="m">18</span><span class="w">  </span>+6113us<span class="o">[</span>+6113us<span class="o">]</span><span class="w"> </span>+/-<span class="w">  </span>111ms
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a>^-<span class="w"> </span>electrode.felixc.at<span class="w">           </span><span class="m">3</span><span class="w">   </span><span class="m">7</span><span class="w">   </span><span class="m">307</span><span class="w">    </span><span class="m">89</span><span class="w">    </span>+12ms<span class="o">[</span><span class="w">  </span>+12ms<span class="o">]</span><span class="w"> </span>+/-<span class="w">  </span><span class="m">182</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>compute节点</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a>root@compute<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># chronyc sources</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="m">210</span><span class="w"> </span>Number<span class="w"> </span>of<span class="w"> </span><span class="nv">sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a>MS<span class="w"> </span>Name/IP<span class="w"> </span>address<span class="w">         </span>Stratum<span class="w"> </span>Poll<span class="w"> </span>Reach<span class="w"> </span>LastRx<span class="w"> </span>Last<span class="w"> </span><span class="nv">sample</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="o">===============================================================================</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a>^?<span class="w"> </span>controller<span class="w">                    </span><span class="m">0</span><span class="w">   </span><span class="m">7</span><span class="w">     </span><span class="m">0</span><span class="w">     </span>-<span class="w">     </span>+0ns<span class="o">[</span><span class="w">   </span>+0ns<span class="o">]</span><span class="w"> </span>+/-<span class="w">    </span>0ns
</span></code></pre></div></td></tr></table></div>
<h3 id="24-openstack-packages">2.4  openstack packages配置</h3>
<p><strong>对于所有节点（controller,comute节点）安装</strong></p>
<h4 id="241-openstack-respositor">2.4.1 安装openstack respositor</h4>
<ol>
<li>stein版本</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="w"> </span><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install centos-release-openstack-stein</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>rocky版本</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="w"> </span><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install centos-release-openstack-rocky</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>queen版本</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="w"> </span><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install centos-release-openstack-queen</span>
</span></code></pre></div></td></tr></table></div>
<p>安装完成后，在/etc/yum.repos.d文件夹下新增以下的repo文件：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="w"> </span>root@controlller<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># ls</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a>CentOS-NFS-Ganesha-28.repo<span class="w">  </span>CentOS-OpenStack-stein.repo
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a>CentOS-Ceph-Nautilus.repo<span class="w">  </span>CentOS-QEMU-EV.repo
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a>CentOS-Storage-common.repo
</span></code></pre></div></td></tr></table></div>
<h4 id="242">2.4.2 安装其他包</h4>
<ol>
<li>更新系统</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="w"> </span><span class="o">[</span>root@controlller<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># yum upgrade</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>安装openstack client</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>yum.repos.d<span class="o">]</span><span class="c1"># yum install python-openstackclient</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>安装 openstack-selinux
   对于centos来说，sexlinux，默认处于打开状态，有两种解决办法:</li>
</ol>
<blockquote>
<p>(1) 禁止sexlinux，打开/etc/selinux/conf,设置：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nv">SELINUX</span><span class="o">=</span>disabled
</span></code></pre></div></td></tr></table></div>
<p>(2)安装openstack-selinux，解决selinux限制</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># yum install openstack-selinux</span>
</span></code></pre></div></td></tr></table></div>
</blockquote>
<h3 id="25-mariadb">2.5 安装数据库（mariadb）</h3>
<p><strong>在controller节点安装数据库</strong></p>
<h4 id="251-mariadb">2.5.1 安装mariadb</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># yum install mariadb mariadb-server python2-PyMySQL</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="252-mysql">2.5.2 配置mysql</h4>
<ol>
<li>在/etc/my.cnf.d下创建文件openstack.cnf,内容如下：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span>
<span class="normal"><a href="#__codelineno-22-6">6</a></span>
<span class="normal"><a href="#__codelineno-22-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1"></a>bind-address<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">192</span>.168.10.17
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2"></a>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3"></a>default-storage-engine<span class="w"> </span><span class="o">=</span><span class="w"> </span>innodb
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="nv">innodb_file_per_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>on
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="nv">max_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4096</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6"></a>collation-server<span class="w"> </span><span class="o">=</span><span class="w"> </span>utf8_general_ci
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7"></a>character-set-server<span class="w"> </span><span class="o">=</span><span class="w"> </span>utf8
</span></code></pre></div></td></tr></table></div>
<p><strong>注意：如果启动客户端报错，请在bind-addres行前面增加一行，内容为：[mysqld]</strong></p>
<ol>
<li>配置自启动与启动mysql服务</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1"># systemctl enable mariadb.service</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="c1"># systemctl start mariadb.service</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>安装数据库,设置root用户密码为：123456</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span>
<span class="normal"><a href="#__codelineno-24-34">34</a></span>
<span class="normal"><a href="#__codelineno-24-35">35</a></span>
<span class="normal"><a href="#__codelineno-24-36">36</a></span>
<span class="normal"><a href="#__codelineno-24-37">37</a></span>
<span class="normal"><a href="#__codelineno-24-38">38</a></span>
<span class="normal"><a href="#__codelineno-24-39">39</a></span>
<span class="normal"><a href="#__codelineno-24-40">40</a></span>
<span class="normal"><a href="#__codelineno-24-41">41</a></span>
<span class="normal"><a href="#__codelineno-24-42">42</a></span>
<span class="normal"><a href="#__codelineno-24-43">43</a></span>
<span class="normal"><a href="#__codelineno-24-44">44</a></span>
<span class="normal"><a href="#__codelineno-24-45">45</a></span>
<span class="normal"><a href="#__codelineno-24-46">46</a></span>
<span class="normal"><a href="#__codelineno-24-47">47</a></span>
<span class="normal"><a href="#__codelineno-24-48">48</a></span>
<span class="normal"><a href="#__codelineno-24-49">49</a></span>
<span class="normal"><a href="#__codelineno-24-50">50</a></span>
<span class="normal"><a href="#__codelineno-24-51">51</a></span>
<span class="normal"><a href="#__codelineno-24-52">52</a></span>
<span class="normal"><a href="#__codelineno-24-53">53</a></span>
<span class="normal"><a href="#__codelineno-24-54">54</a></span>
<span class="normal"><a href="#__codelineno-24-55">55</a></span>
<span class="normal"><a href="#__codelineno-24-56">56</a></span>
<span class="normal"><a href="#__codelineno-24-57">57</a></span>
<span class="normal"><a href="#__codelineno-24-58">58</a></span>
<span class="normal"><a href="#__codelineno-24-59">59</a></span>
<span class="normal"><a href="#__codelineno-24-60">60</a></span>
<span class="normal"><a href="#__codelineno-24-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>my.cnf.d<span class="o">]</span><span class="c1"># mysql_secure_installation</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a>NOTE:<span class="w"> </span>RUNNING<span class="w"> </span>ALL<span class="w"> </span>PARTS<span class="w"> </span>OF<span class="w"> </span>THIS<span class="w"> </span>SCRIPT<span class="w"> </span>IS<span class="w"> </span>RECOMMENDED<span class="w"> </span>FOR<span class="w"> </span>ALL<span class="w"> </span>MariaDB
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">      </span>SERVERS<span class="w"> </span>IN<span class="w"> </span>PRODUCTION<span class="w"> </span>USE!<span class="w">  </span>PLEASE<span class="w"> </span>READ<span class="w"> </span>EACH<span class="w"> </span>STEP<span class="w"> </span>CAREFULLY!
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a>In<span class="w"> </span>order<span class="w"> </span>to<span class="w"> </span>log<span class="w"> </span>into<span class="w"> </span>MariaDB<span class="w"> </span>to<span class="w"> </span>secure<span class="w"> </span>it,<span class="w"> </span>we<span class="s1">&#39;ll need the current</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="s1">password for the root user.  If you&#39;</span>ve<span class="w"> </span>just<span class="w"> </span>installed<span class="w"> </span>MariaDB,<span class="w"> </span>and
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a>you<span class="w"> </span>haven<span class="s1">&#39;t set the root password yet, the password will be blank,</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="s1">so you should just press enter here.</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="s1">Enter current password for root (enter for none):</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="s1">OK, successfully used password, moving on...</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="s1">Setting the root password ensures that nobody can log into the MariaDB</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="s1">root user without the proper authorisation.</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16"></a>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="s1">Set root password? [Y/n] Y</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="s1">New password:</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="s1">Re-enter new password:</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="s1">Password updated successfully!</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="s1">Reloading privilege tables..</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22"></a><span class="s1"> ... Success!</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23"></a>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24"></a>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25"></a><span class="s1">By default, a MariaDB installation has an anonymous user, allowing anyone</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26"></a><span class="s1">to log into MariaDB without having to have a user account created for</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27"></a><span class="s1">them.  This is intended only for testing, and to make the installation</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28"></a><span class="s1">go a bit smoother.  You should remove them before moving into a</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29"></a><span class="s1">production environment.</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30"></a>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31"></a><span class="s1">Remove anonymous users? [Y/n] Y</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32"></a><span class="s1"> ... Success!</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33"></a>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34"></a><span class="s1">Normally, root should only be allowed to connect from &#39;</span>localhost<span class="s1">&#39;.  This</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35"></a><span class="s1">ensures that someone cannot guess at the root password from the network.</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36"></a>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37"></a><span class="s1">Disallow root login remotely? [Y/n] n</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38"></a><span class="s1"> ... skipping.</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39"></a>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40"></a><span class="s1">By default, MariaDB comes with a database named &#39;</span>test<span class="s1">&#39; that anyone can</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41"></a><span class="s1">access.  This is also intended only for testing, and should be removed</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42"></a><span class="s1">before moving into a production environment.</span>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43"></a>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44"></a><span class="s1">Remove test database and access to it? [Y/n] Y</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45"></a><span class="s1"> - Dropping test database...</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46"></a><span class="s1"> ... Success!</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47"></a><span class="s1"> - Removing privileges on test database...</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48"></a><span class="s1"> ... Success!</span>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49"></a>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50"></a><span class="s1">Reloading the privilege tables will ensure that all changes made so far</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51"></a><span class="s1">will take effect immediately.</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52"></a>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53"></a><span class="s1">Reload privilege tables now? [Y/n] Y</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54"></a><span class="s1"> ... Success!</span>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55"></a>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56"></a><span class="s1">Cleaning up...</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57"></a>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58"></a><span class="s1">All done!  If you&#39;</span>ve<span class="w"> </span>completed<span class="w"> </span>all<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>above<span class="w"> </span>steps,<span class="w"> </span>your<span class="w"> </span>MariaDB
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59"></a>installation<span class="w"> </span>should<span class="w"> </span>now<span class="w"> </span>be<span class="w"> </span>secure.
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60"></a>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61"></a>Thanks<span class="w"> </span><span class="k">for</span><span class="w"> </span>using<span class="w"> </span>MariaDB!
</span></code></pre></div></td></tr></table></div>
<ol>
<li>设置客户端免密登录
   正常情况下使用mysql客户端命令登录mysql需要输入用户名与密码，可以在/etc/my.cnf.d/client.conf下配置：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="o">[</span>client<span class="o">]</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="c1"># This group is not read by mysql client library,</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="c1"># If you use the same .cnf file for MySQL and MariaDB,</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="c1"># use it for MariaDB-only client options</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="nv">user</span><span class="o">=</span>root
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="nv">password</span><span class="o">=</span><span class="s2">&quot;123456&quot;</span>
</span></code></pre></div></td></tr></table></div>
<p>这样只有在终端中输入mysql就可以直接登录了</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a>root@controlller<span class="w"> </span>my.cnf.d<span class="o">]</span><span class="c1"># mysql</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a>Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>MariaDB<span class="w"> </span>monitor.<span class="w">  </span>Commands<span class="w"> </span>end<span class="w"> </span>with<span class="w"> </span><span class="p">;</span><span class="w"> </span>or<span class="w"> </span><span class="se">\g</span>.
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a>Your<span class="w"> </span>MariaDB<span class="w"> </span>connection<span class="w"> </span>id<span class="w"> </span>is<span class="w"> </span><span class="m">22</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a>Server<span class="w"> </span>version:<span class="w"> </span><span class="m">10</span>.3.10-MariaDB<span class="w"> </span>MariaDB<span class="w"> </span>Server
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6"></a>Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">2018</span>,<span class="w"> </span>Oracle,<span class="w"> </span>MariaDB<span class="w"> </span>Corporation<span class="w"> </span>Ab<span class="w"> </span>and<span class="w"> </span>others.
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7"></a>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8"></a>Type<span class="w"> </span><span class="s1">&#39;help;&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;\h&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>help.<span class="w"> </span>Type<span class="w"> </span><span class="s1">&#39;\c&#39;</span><span class="w"> </span>to<span class="w"> </span>clear<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>input<span class="w"> </span>statement.
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;
</span></code></pre></div></td></tr></table></div>
<h3 id="26">2.6安装消息队列</h3>
<p>openstack中使用消息队列，消息队列用于controller节点与compute之间的消息通信，openstack使用消息队列来协调各种服务之间的操作与状态信息，消息队列服务通常安装在contoller节点上。消息队列软件有：RabbitMQ，Qpid，ZeroMQ,本次使用RabbitMQ
<strong>在controller节点上安装</strong></p>
<h4 id="261rabbitmq">2.6.1安装rabbitmq</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install rabbitmq-server -y</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="262">2.6.2设置开机自启动与启动服务</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1">#  systemctl enable rabbitmq-server.service</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2"></a>Created<span class="w"> </span>symlink<span class="w"> </span>from<span class="w"> </span>/etc/systemd/system/multi-user.target.wants/rabbitmq-server.service<span class="w"> </span>to<span class="w"> </span>/usr/lib/systemd/system/rabbitmq-server.service.
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># systemctl start rabbitmq-server.service</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1">#</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="263">2.6.3 设置消息队列用户名与密码</h4>
<ol>
<li>设置用户与密码</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># rabbitmqctl  add_user openstack ea4f99cd40067b6dcfad</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a>Creating<span class="w"> </span>user<span class="w"> </span><span class="s2">&quot;openstack&quot;</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>查看设置的用户与密码</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># rabbitmqctl list_users</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a>Listing<span class="w"> </span>users
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a>openstack<span class="w">   </span><span class="o">[]</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a>guest<span class="w">   </span><span class="o">[</span>administrator<span class="o">]</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="264">2.6.4设置用户权限</h4>
<ol>
<li>语法：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1"></a>rabbitmqctl<span class="w"> </span>set_permissions<span class="w"> </span>&lt;user&gt;<span class="w"> </span>&lt;conf&gt;<span class="w"> </span>&lt;write&gt;<span class="w"> </span>&lt;read&gt;
</span></code></pre></div></td></tr></table></div>
<ol>
<li>说明：</li>
</ol>
<blockquote>
<ul>
<li><user>是指为某个用户设置权限</li>
<li><conf>设置配置权限</li>
<li><write>设置写权限</li>
<li><read>设置度权限</li>
</ul>
</blockquote>
<ol>
<li>对openstack用户设置权限</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1">#rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2"></a>Setting<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="s2">&quot;openstack&quot;</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>vhost<span class="w"> </span><span class="s2">&quot;/&quot;</span>
</span></code></pre></div></td></tr></table></div>
<p><strong>说明：</strong>
<strong>对openstack用户设置了所有的配置，写与读的权限</strong></p>
<ol>
<li>查看openstack用户的权限</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># rabbitmqctl list_user_permissions openstack</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2"></a>Listing<span class="w"> </span>permissions<span class="w"> </span><span class="k">for</span><span class="w"> </span>user<span class="w"> </span><span class="s2">&quot;openstack&quot;</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3"></a>/<span class="w">   </span>.*<span class="w">  </span>.*<span class="w">  </span>.*
</span></code></pre></div></td></tr></table></div>
<h3 id="27-memcached">2.7 安装缓存服务(MemCached)</h3>
<p>openstack为其他服务提供身份识别服务，需要使用Memcached来缓存tokens，缓存服务通常安装在controller节点上。
<strong>在controller节点上安装</strong></p>
<h4 id="271-memcached">2.7.1 安装memcached包</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install memcached python-memcached -y</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="272-memcached">2.7.2 配置memcached</h4>
<p>编辑/etc/sysconfig/memcached文件，修改：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-l 127.0.0.1,::1&quot;</span>
</span></code></pre></div></td></tr></table></div>
<p>为：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">&quot;-l 127.0.0.1,::1,controller&quot;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="273">2.7.3设置自启动与启动服务</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># systemctl enable memcached.service</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2"></a>Created<span class="w"> </span>symlink<span class="w"> </span>from<span class="w"> </span>/etc/systemd/system/multi-user.target.wants/memcached.service<span class="w"> </span>to<span class="w"> </span>/usr/lib/systemd/system/memcached.service.
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># systemctl start memcached.service</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1">#</span>
</span></code></pre></div></td></tr></table></div>
<p>查看服务是否启动成功：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># systemctl status memcached.service</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="28-etcd">2.8 配置Etcd</h3>
<p>Etcd是一种可靠的分布式键值对管理软件，可以存储分布式键锁，存储配置信息，跟踪服务的是否存活等应用场景。openstack服务会用到Etcd软件。
<strong>etcd服务安装在controller节点上</strong></p>
<h4 id="281">2.8.1安装包</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># yum install etcd</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="282-etcdconf">2.8.2 配置etcd.conf</h4>
<p>编辑/etc/etcd/etcd.conf,内容如下：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1">#[Member]</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="nv">ETCD_DATA_DIR</span><span class="o">=</span><span class="s2">&quot;/var/lib/etcd/default.etcd&quot;</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="nv">ETCD_LISTEN_PEER_URLS</span><span class="o">=</span><span class="s2">&quot;http://192.168.10.17:2380&quot;</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="nv">ETCD_LISTEN_CLIENT_URLS</span><span class="o">=</span><span class="s2">&quot;http://192.168.10.17:2379&quot;</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="nv">ETCD_NAME</span><span class="o">=</span><span class="s2">&quot;controller&quot;</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="c1">#[Clustering]</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="nv">ETCD_INITIAL_ADVERTISE_PEER_URLS</span><span class="o">=</span><span class="s2">&quot;http://192.168.10.17:2380&quot;</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="nv">ETCD_ADVERTISE_CLIENT_URLS</span><span class="o">=</span><span class="s2">&quot;http://192.168.10.17:2379&quot;</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="nv">ETCD_INITIAL_CLUSTER</span><span class="o">=</span><span class="s2">&quot;controller=http://192.168.10.17:2380&quot;</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="nv">ETCD_INITIAL_CLUSTER_TOKEN</span><span class="o">=</span><span class="s2">&quot;etcd-cluster-01&quot;</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="nv">ETCD_INITIAL_CLUSTER_STATE</span><span class="o">=</span><span class="s2">&quot;new&quot;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="283">2.8.3 设置自启动与启动服务</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># systemctl enable etcd</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="c1"># systemctl start etcd</span>
</span></code></pre></div></td></tr></table></div>
<p>查看服务是否启动成功：
x</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a>[root@controlller ~]# systemctl status etcd
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a>● etcd.service - Etcd Server
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a>   Loaded: loaded (/usr/lib/systemd/system/etcd.service; enabled; vendor preset: disabled)
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a>   Active: active (running) since 日 2019-10-13 23:01:17 CST; 1min 0s ago
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a> Main PID: 43139 (etcd)
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a>   CGroup: /system.slice/etcd.service
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a>           └─43139 /usr/bin/etcd --name=controller --data-dir=/var/lib/etcd/d...
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a>10月 13 23:01:17 controlller etcd[43139]: 850ca1f0fc28aca8 received MsgVote...2
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a>10月 13 23:01:17 controlller etcd[43139]: 850ca1f0fc28aca8 became leader at...2
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a>10月 13 23:01:17 controlller etcd[43139]: raft.node: 850ca1f0fc28aca8 elect...2
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12"></a>10月 13 23:01:17 controlller etcd[43139]: published {Name:controller Client...b
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13"></a>10月 13 23:01:17 controlller etcd[43139]: setting up the initial cluster ve...3
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14"></a>10月 13 23:01:17 controlller systemd[1]: Started Etcd Server.
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15"></a>10月 13 23:01:17 controlller etcd[43139]: set the initial cluster version t...3
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16"></a>10月 13 23:01:17 controlller etcd[43139]: enabled capabilities for version 3.3
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17"></a>10月 13 23:01:17 controlller etcd[43139]: ready to serve client requests
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18"></a>10月 13 23:01:17 controlller etcd[43139]: serving insecure client requests ...!
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19"></a>Hint: Some lines were ellipsized, use -l to show in full.
</span></code></pre></div></td></tr></table></div>
<h1 id="openstack_stein_2node_install-2">openstack_stein_2node_install-2</h1>
<h2 id="3">3、安装认证服务</h2>
<p><strong>在控制节点上安装</strong></p>
<h3 id="31">3.1 认证服务概述</h3>
<h4 id="311keystone">3.1.1keystone对象</h4>
<ol>
<li>User：指使用Openstack service的用户，可以是人、服务、系统，但凡使用了Openstack service的对象都可以称为User。</li>
<li>Project(Tenant)：可以理解为一个人、或服务所拥有的 资源集合 。在一个Project(Tenant)中可以包含多个User，每一个User都会根据权限的划分来使用Project(Tenant)中的资源。比如通过Nova创建虚拟机时要指定到某个Project中，在Cinder创建卷也要指定到某个Project中。User访问Project的资源前，必须要与该Project关联，并且指定User在Project下的Role。</li>
<li>Role：用于划分权限。可以通过给User指定Role，使User获得Role对应的操作权限。Keystone返回给User的Token包含了Role列表，被访问的Services会判断访问它的User和User提供的Token中所包含的Role。系统默认使用管理Role admin和成员Role <em>member</em> 。</li>
<li>Token：是一个字符串表示，作为访问资源的令牌。Token包含了在 指定范围和有效时间内 可以被访问的资源。</li>
<li>Credentials：用于确认用户身份的凭证。</li>
<li>Authentication：确定用户身份的过程。</li>
<li>Service：Openstack service，即Openstack中运行的组件服务。</li>
<li>Endpoint：一个可以通过网络来访问和定位某个Openstack service的地址，通常是一个URL。根据使用对象分为三类：
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1"></a>admin<span class="w"> </span>url<span class="w"> </span>–&gt;<span class="w"> </span>给admin用户使用，Post：35357
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2"></a>internal<span class="w"> </span>url<span class="w"> </span>–&gt;<span class="w"> </span>OpenStack内部服务使用来跟别的服务通信，Port：5000
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3"></a>public<span class="w"> </span>url<span class="w"> </span>–&gt;<span class="w"> </span>其它用户可以访问的地址，Post：5000
</span></code></pre></div></td></tr></table></div></li>
<li>domain，project，user，role之间的关系</li>
<li><img alt="" src="../_v_images/20191026101840366_100014045.png" /></li>
<li>keystone为openstack默认的认证服务，有三种认证方式：</li>
<li>UUID</li>
<li>PKI</li>
<li>Fernet</li>
</ol>
<h4 id="312-uuid">3.1.2 UUID认证方式</h4>
<p>当用户需要访问nova，操作流程如下：
1. 首先要用有效的用户名/密码先去keystone认证，keystone返回给用户一个token(即UUID)。
2. 其次，用户使用获得的token向nova申请服务
3. nova收到请求后，用用户的token去向keystone进行请求验证。
4. keystone通过比对token，以及检查token的有效期，判断token的有效性，返回结果给nova。
5. nova根据keystone认证信息处理用户请求
  * yes， 发送200，给用户
  * no,  发送401,拒绝访问
    访问流程如下图所示：
<img alt="" src="../_v_images/20191022021806598_1815744078.png" /></p>
<h4 id="313-pki">3.1.3 PKI认证</h4>
<p>1.数字签名原理
<img alt="" src="../_v_images/20191022100108093_1930434501.png" /></p>
<ol>
<li>使用pki keystone认证流程
<img alt="" src="../_v_images/20191022102113431_629719431.png" /></li>
</ol>
<h4 id="314-fernet">3.1.4 fernet认证</h4>
<p>UUID方式的缺点：
 时间长了，会产出大量的token，导致数据库性能变差,改进：fernet
 fernet token
   当前主流推荐的token格式，它采用 cryptography 对称加密库(symmetric cryptography，加密密钥和解密密钥相同) 加密 token，具体由 AES-CBC 加密和散列函数 SHA256 签名。
不需要存储于数据库，减少了磁盘的 IO，带来了一定的性能提升。</p>
<h3 id="32-prerequisities">3.2  前提条件（prerequisities)</h3>
<ol>
<li>使用root用户连接数据库 
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1"></a>mysql<span class="w"> </span>-uroot<span class="w"> </span>-p
</span></code></pre></div></td></tr></table></div></li>
<li>创建keystone数据库
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1"></a>create<span class="w"> </span>database<span class="w"> </span>keystone<span class="p">;</span>
</span></code></pre></div></td></tr></table></div></li>
<li>创建并授权keystone用户
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="w">  </span>create<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;keystone&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span>identified<span class="w"> </span>by<span class="w"> </span><span class="s1">&#39;keystone&#39;</span><span class="p">;</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="w">  </span>create<span class="w"> </span>user<span class="w"> </span><span class="s1">&#39;keystone&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span>identified<span class="w"> </span>by<span class="w"> </span><span class="s1">&#39;keystone&#39;</span><span class="p">;</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="w">  </span>grant<span class="w"> </span>all<span class="w"> </span>privileges<span class="w"> </span>on<span class="w"> </span>keystone.*<span class="w"> </span>to<span class="w"> </span>keystone<span class="p">;</span>
</span></code></pre></div></td></tr></table></div></li>
</ol>
<h3 id="33-keystonehttpd-mod_wsgi">3.3 安装keystone，httpd及 mod_wsgi模块</h3>
<ol>
<li>openstack-keystone openstack认证软件</li>
<li>httpd apache http服务器</li>
<li>mod_wsgi模块，可以解析python软件
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a>yum<span class="w"> </span>install<span class="w"> </span>openstack-keystone<span class="w"> </span>httpd<span class="w"> </span>mod_wsgi
</span></code></pre></div></td></tr></table></div></li>
<li>配置 /etc/keystone/keystone.conf文件
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span>
<span class="normal"><a href="#__codelineno-48-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="o">[</span>database<span class="o">]</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="c1"># ...</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://keystone:keystone@controller/keystone
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="o">[</span>token<span class="o">]</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="c1"># ...</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="nv">provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>fernet
</span></code></pre></div></td></tr></table></div></li>
<li>同步数据库
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1"># su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span>
</span></code></pre></div></td></tr></table></div>
<strong>说明:</strong></li>
<li>su -s 后跟执行脚本 -s 是shell的缩写</li>
<li>sh -c  从字符串执行</li>
<li>sh -c ""  parameter , 作为字符串命令的第一个参数</li>
<li>keystonemanage db_sync keystone</li>
<li>初始化fernet key 库
 ```shell
 # keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</li>
</ol>
<h1 id="keystone-manage-credential_setup-keystone-user-keystone-keystone-group-keystone">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</h1>
<p><div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span>
<span class="normal"><a href="#__codelineno-50-4">4</a></span>
<span class="normal"><a href="#__codelineno-50-5">5</a></span>
<span class="normal"><a href="#__codelineno-50-6">6</a></span>
<span class="normal"><a href="#__codelineno-50-7">7</a></span>
<span class="normal"><a href="#__codelineno-50-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1"></a>6. 创建bootstrap认证服务
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2"></a>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3"></a>```shell
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4"></a># keystone-manage bootstrap --bootstrap-password admin123 \
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5"></a> --bootstrap-admin-url http://controller:5000/v3/ \
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6"></a> --bootstrap-internal-url http://controller:5000/v3/ \
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7"></a> --bootstrap-public-url http://controller:5000/v3/ \
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8"></a> --bootstrap-region-id RegionOn
</span></code></pre></div></td></tr></table></div>
 7. 修改/etc/httpd/conf/httpd.conf文件
 <div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1"></a>ServerName<span class="w"> </span>controller
</span></code></pre></div></td></tr></table></div>
 8. 创建软连接文件</p>
<p><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1"></a>ln<span class="w"> </span>-s<span class="w"> </span>/usr/share/keystone/wsgi-keystone.conf<span class="w"> </span>/etc/httpd/conf.d/
</span></code></pre></div></td></tr></table></div>
 9. 启动web 服务
 ```shell</p>
<h1 id="systemctl-enable-httpdservice">systemctl enable httpd.service</h1>
<h1 id="systemctl-start-httpdservice">systemctl start httpd.service</h1>
<p><code>10. 创建 admin环境变量文件，/root/keystone_admin</code> shell
export OS_USERNAME=admin
export OS_PASSWORD=admin123
export OS_PROJECT_NAME=admin
export OS_USER_DOMAIN_NAME=Default
export OS_PROJECT_DOMAIN_NAME=Default
export OS_AUTH_URL=http://controller:5000/v3
export OS_IDENTITY_API_VERSION=3
 <div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1"></a>11. 输出环境变量
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2"></a>``` shell
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3"></a>#source keystone_admin
</span></code></pre></div></td></tr></table></div></p>
<h3 id="34-domainprojcetusers-and-roles">3.4 domain，projcet，users and roles管理</h3>
<h4 id="341-domain">3.4.1 domain管理</h4>
<ol>
<li>创建domain
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1">#openstack domain create --description &quot;An Example Domain&quot; example</span>
</span></code></pre></div></td></tr></table></div></li>
<li>查看domain
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span>
<span class="normal"><a href="#__codelineno-55-3">3</a></span>
<span class="normal"><a href="#__codelineno-55-4">4</a></span>
<span class="normal"><a href="#__codelineno-55-5">5</a></span>
<span class="normal"><a href="#__codelineno-55-6">6</a></span>
<span class="normal"><a href="#__codelineno-55-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack domain list</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2"></a>+----------------------------------+---------+---------+--------------------+
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">    </span><span class="p">|</span><span class="w"> </span>Enabled<span class="w"> </span><span class="p">|</span><span class="w"> </span>Description<span class="w">        </span><span class="p">|</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4"></a>+----------------------------------+---------+---------+--------------------+
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="p">|</span><span class="w"> </span>b0bc02701f5348df9ddf727a2e99ecb2<span class="w"> </span><span class="p">|</span><span class="w"> </span>example<span class="w"> </span><span class="p">|</span><span class="w"> </span>True<span class="w">    </span><span class="p">|</span><span class="w">  </span>An<span class="w"> </span>Example<span class="w"> </span>Domain<span class="w"> </span><span class="p">|</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span><span class="w"> </span>Default<span class="w"> </span><span class="p">|</span><span class="w"> </span>True<span class="w">    </span><span class="p">|</span><span class="w"> </span>The<span class="w"> </span>default<span class="w"> </span>domain<span class="w"> </span><span class="p">|</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7"></a>+----------------------------------+---------+---------+--------------------+
</span></code></pre></div></td></tr></table></div></li>
<li>查看domain详细信息
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack domain show cloud1821</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2"></a>+-------------+----------------------------------+
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4"></a>+-------------+----------------------------------+
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>clound1821<span class="w">                       </span><span class="p">|</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>b66b72e1feb145e38fad867a7cedeab6<span class="w"> </span><span class="p">|</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="p">|</span><span class="w"> </span>name<span class="w">        </span><span class="p">|</span><span class="w"> </span>cloud1821<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="p">|</span><span class="w"> </span>tags<span class="w">        </span><span class="p">|</span><span class="w"> </span><span class="o">[]</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div></li>
<li>删除domain
要删除domain，首先要设置domain为disable，命令如下：
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack domain set --disable example</span>
</span></code></pre></div></td></tr></table></div>
然后执行删除命令：
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span>
<span class="normal"><a href="#__codelineno-58-5">5</a></span>
<span class="normal"><a href="#__codelineno-58-6">6</a></span>
<span class="normal"><a href="#__codelineno-58-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack domain delete example</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack domain list</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3"></a>+---------+---------+---------+--------------------+
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">      </span><span class="p">|</span><span class="w"> </span>Name<span class="w">    </span><span class="p">|</span><span class="w"> </span>Enabled<span class="w"> </span><span class="p">|</span><span class="w"> </span>Description<span class="w">        </span><span class="p">|</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5"></a>+---------+---------+---------+--------------------+
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="p">|</span><span class="w"> </span>default<span class="w"> </span><span class="p">|</span><span class="w"> </span>Default<span class="w"> </span><span class="p">|</span><span class="w"> </span>True<span class="w">    </span><span class="p">|</span><span class="w"> </span>The<span class="w"> </span>default<span class="w"> </span>domain<span class="w"> </span><span class="p">|</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7"></a>+---------+---------+---------+--------------------+
</span></code></pre></div></td></tr></table></div></li>
</ol>
<h4 id="342-project">3.4.2 project管理</h4>
<ol>
<li>查看domain
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span>
<span class="normal"><a href="#__codelineno-59-4">4</a></span>
<span class="normal"><a href="#__codelineno-59-5">5</a></span>
<span class="normal"><a href="#__codelineno-59-6">6</a></span>
<span class="normal"><a href="#__codelineno-59-7">7</a></span>
<span class="normal"><a href="#__codelineno-59-8">8</a></span>
<span class="normal"><a href="#__codelineno-59-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack project list</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2"></a>+----------------------------------+-----------+
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">      </span><span class="p">|</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4"></a>+----------------------------------+-----------+
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="p">|</span><span class="w"> </span>0fc81d875cca48e489028eb84146f7a4<span class="w"> </span><span class="p">|</span><span class="w"> </span>service2<span class="w">  </span><span class="p">|</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="p">|</span><span class="w"> </span>28e2c67f8e16455a829ba18036490fd3<span class="w"> </span><span class="p">|</span><span class="w"> </span>myproject<span class="w"> </span><span class="p">|</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="p">|</span><span class="w"> </span>58e2a0860fe94bb4b244462fa9d39288<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">     </span><span class="p">|</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="p">|</span><span class="w"> </span>6ce019cfdf674c8392c3ee1af13d5d3d<span class="w"> </span><span class="p">|</span><span class="w"> </span>service<span class="w">   </span><span class="p">|</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9"></a>+----------------------------------+-----------+
</span></code></pre></div></td></tr></table></div></li>
<li>创建project
 project必须属于某个domain</li>
<li><strong>首先要查看domain</strong>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span>
<span class="normal"><a href="#__codelineno-60-5">5</a></span>
<span class="normal"><a href="#__codelineno-60-6">6</a></span>
<span class="normal"><a href="#__codelineno-60-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack domain list</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2"></a>+----------------------------------+-----------+---------+--------------------+
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">      </span><span class="p">|</span><span class="w"> </span>Enabled<span class="w"> </span><span class="p">|</span><span class="w"> </span>Description<span class="w">        </span><span class="p">|</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4"></a>+----------------------------------+-----------+---------+--------------------+
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="p">|</span><span class="w"> </span>b66b72e1feb145e38fad867a7cedeab6<span class="w"> </span><span class="p">|</span><span class="w"> </span>cloud1821<span class="w"> </span><span class="p">|</span><span class="w"> </span>False<span class="w">   </span><span class="p">|</span><span class="w"> </span>clound1821<span class="w">         </span><span class="p">|</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span><span class="w"> </span>Default<span class="w">   </span><span class="p">|</span><span class="w"> </span>True<span class="w">    </span><span class="p">|</span><span class="w"> </span>The<span class="w"> </span>default<span class="w"> </span>domain<span class="w"> </span><span class="p">|</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7"></a>+----------------------------------+-----------+---------+--------------------+
</span></code></pre></div></td></tr></table></div></li>
<li><strong>其次创建project</strong>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack project create --domain default --description &quot;create a demo domain&quot;  demo</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2"></a>+-------------+----------------------------------+
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4"></a>+-------------+----------------------------------+
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>demo<span class="w"> </span>domain<span class="w">             </span><span class="p">|</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>5059700f003e42768de44d2b88fe1e57<span class="w"> </span><span class="p">|</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="p">|</span><span class="w"> </span>is_domain<span class="w">   </span><span class="p">|</span><span class="w"> </span>False<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">        </span><span class="p">|</span><span class="w"> </span>demo<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="p">|</span><span class="w"> </span>parent_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="p">|</span><span class="w"> </span>tags<span class="w">        </span><span class="p">|</span><span class="w"> </span><span class="o">[]</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div></li>
<li>删除project
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span>
<span class="normal"><a href="#__codelineno-62-17">17</a></span>
<span class="normal"><a href="#__codelineno-62-18">18</a></span>
<span class="normal"><a href="#__codelineno-62-19">19</a></span>
<span class="normal"><a href="#__codelineno-62-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack project list</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2"></a>+----------------------------------+-----------+
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">      </span><span class="p">|</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4"></a>+----------------------------------+-----------+
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="p">|</span><span class="w"> </span>0fc81d875cca48e489028eb84146f7a4<span class="w"> </span><span class="p">|</span><span class="w"> </span>service2<span class="w">  </span><span class="p">|</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="p">|</span><span class="w"> </span>28e2c67f8e16455a829ba18036490fd3<span class="w"> </span><span class="p">|</span><span class="w"> </span>myproject<span class="w"> </span><span class="p">|</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="p">|</span><span class="w"> </span>5059700f003e42768de44d2b88fe1e57<span class="w"> </span><span class="p">|</span><span class="w"> </span>demo<span class="w">      </span><span class="p">|</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="p">|</span><span class="w"> </span>58e2a0860fe94bb4b244462fa9d39288<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">     </span><span class="p">|</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="p">|</span><span class="w"> </span>6ce019cfdf674c8392c3ee1af13d5d3d<span class="w"> </span><span class="p">|</span><span class="w"> </span>service<span class="w">   </span><span class="p">|</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10"></a>+----------------------------------+-----------+
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack project delete myproject</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack project list</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13"></a>+----------------------------------+----------+
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">     </span><span class="p">|</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15"></a>+----------------------------------+----------+
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="p">|</span><span class="w"> </span>0fc81d875cca48e489028eb84146f7a4<span class="w"> </span><span class="p">|</span><span class="w"> </span>service2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17"></a><span class="p">|</span><span class="w"> </span>5059700f003e42768de44d2b88fe1e57<span class="w"> </span><span class="p">|</span><span class="w"> </span>demo<span class="w">     </span><span class="p">|</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18"></a><span class="p">|</span><span class="w"> </span>58e2a0860fe94bb4b244462fa9d39288<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">    </span><span class="p">|</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19"></a><span class="p">|</span><span class="w"> </span>6ce019cfdf674c8392c3ee1af13d5d3d<span class="w"> </span><span class="p">|</span><span class="w"> </span>service<span class="w">  </span><span class="p">|</span>
</span><span id="__span-62-20"><a id="__codelineno-62-20" name="__codelineno-62-20"></a>+----------------------------------+----------+
</span></code></pre></div></td></tr></table></div></li>
<li>查看project详细信息
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack project show demo</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2"></a>+-------------+----------------------------------+
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4"></a>+-------------+----------------------------------+
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>create<span class="w"> </span>a<span class="w"> </span>demo<span class="w"> </span>domain<span class="w">             </span><span class="p">|</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>5059700f003e42768de44d2b88fe1e57<span class="w"> </span><span class="p">|</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="p">|</span><span class="w"> </span>is_domain<span class="w">   </span><span class="p">|</span><span class="w"> </span>False<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">        </span><span class="p">|</span><span class="w"> </span>demo<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="p">|</span><span class="w"> </span>parent_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="p">|</span><span class="w"> </span>tags<span class="w">        </span><span class="p">|</span><span class="w"> </span><span class="o">[]</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div></li>
</ol>
<h4 id="343-user">3.4.3 user管理</h4>
<ol>
<li>
<p>查看用户
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span>
<span class="normal"><a href="#__codelineno-64-4">4</a></span>
<span class="normal"><a href="#__codelineno-64-5">5</a></span>
<span class="normal"><a href="#__codelineno-64-6">6</a></span>
<span class="normal"><a href="#__codelineno-64-7">7</a></span>
<span class="normal"><a href="#__codelineno-64-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user list</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2"></a>+----------------------------------+--------+
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">   </span><span class="p">|</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4"></a>+----------------------------------+--------+
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="p">|</span><span class="w"> </span>6fafe9a3635745ba879286c2d4e2edac<span class="w"> </span><span class="p">|</span><span class="w"> </span>demo<span class="w">   </span><span class="p">|</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="p">|</span><span class="w"> </span>9856f3f21b4d4e128d849d3b1c20a6c9<span class="w"> </span><span class="p">|</span><span class="w"> </span>user25<span class="w"> </span><span class="p">|</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="p">|</span><span class="w"> </span>e65881f9aa584883a3077c9ca481c566<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">  </span><span class="p">|</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8"></a>+----------------------------------+--------+
</span></code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>创建用户
用户创建必须属于某个domain
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user create --domain cloud1821 \</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2"></a>&gt;<span class="w"> </span>--password-prompt<span class="w"> </span>user2
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3"></a>User<span class="w"> </span>Password:
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4"></a>Repeat<span class="w"> </span>User<span class="w"> </span>Password:
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5"></a>+---------------------+----------------------------------+
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">               </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7"></a>+---------------------+----------------------------------+
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">           </span><span class="p">|</span><span class="w"> </span>b66b72e1feb145e38fad867a7cedeab6<span class="w"> </span><span class="p">|</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">             </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10"></a><span class="p">|</span><span class="w"> </span>id<span class="w">                  </span><span class="p">|</span><span class="w"> </span>c57be863835e40138dc532197d845767<span class="w"> </span><span class="p">|</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="p">|</span><span class="w"> </span>name<span class="w">                </span><span class="p">|</span><span class="w"> </span>user2<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="p">|</span><span class="w"> </span>options<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14"></a>+---------------------+----------------------------------+
</span></code></pre></div></td></tr></table></div></p>
</li>
<li>删除用户
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span>
<span class="normal"><a href="#__codelineno-66-5">5</a></span>
<span class="normal"><a href="#__codelineno-66-6">6</a></span>
<span class="normal"><a href="#__codelineno-66-7">7</a></span>
<span class="normal"><a href="#__codelineno-66-8">8</a></span>
<span class="normal"><a href="#__codelineno-66-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user delete user2</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user list</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3"></a>+----------------------------------+--------+
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">   </span><span class="p">|</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5"></a>+----------------------------------+--------+
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6"></a><span class="p">|</span><span class="w"> </span>6fafe9a3635745ba879286c2d4e2edac<span class="w"> </span><span class="p">|</span><span class="w"> </span>demo<span class="w">   </span><span class="p">|</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="p">|</span><span class="w"> </span>9856f3f21b4d4e128d849d3b1c20a6c9<span class="w"> </span><span class="p">|</span><span class="w"> </span>user25<span class="w"> </span><span class="p">|</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8"></a><span class="p">|</span><span class="w"> </span>e65881f9aa584883a3077c9ca481c566<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">  </span><span class="p">|</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9"></a>+----------------------------------+--------+
</span></code></pre></div></td></tr></table></div></li>
<li>查看用户详细信息
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span>
<span class="normal"><a href="#__codelineno-67-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user show demo</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2"></a>+---------------------+----------------------------------+
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">               </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4"></a>+---------------------+----------------------------------+
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">           </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">             </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="p">|</span><span class="w"> </span>id<span class="w">                  </span><span class="p">|</span><span class="w"> </span>6fafe9a3635745ba879286c2d4e2edac<span class="w"> </span><span class="p">|</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="p">|</span><span class="w"> </span>name<span class="w">                </span><span class="p">|</span><span class="w"> </span>demo<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="p">|</span><span class="w"> </span>options<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11"></a>+---------------------+----------------------------------+
</span></code></pre></div></td></tr></table></div></li>
<li>用户信息修改
语法：
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1"></a>openstack<span class="w"> </span>user<span class="w"> </span><span class="nb">set</span><span class="w">  </span>options
</span></code></pre></div></td></tr></table></div>
options:</li>
</ol>
<table>
<thead>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>--name <name></td>
<td>设置用户名</td>
</tr>
<tr>
<td>--domain <domain></td>
<td>设置domain</td>
</tr>
<tr>
<td>--project <project></td>
<td>设置project</td>
</tr>
<tr>
<td>--project-domain <project-domain></td>
<td>设置project所属的domain</td>
</tr>
<tr>
<td>--password <password></td>
<td>设置密码</td>
</tr>
<tr>
<td>--password-prompt</td>
<td>设置密码输入提示</td>
</tr>
<tr>
<td>--email <email-address></td>
<td>设置邮件</td>
</tr>
<tr>
<td>--description <description></td>
<td>设置描述</td>
</tr>
<tr>
<td>--enable</td>
<td>设置用户起作用</td>
</tr>
<tr>
<td>--disable</td>
<td>设置用户不起作用</td>
</tr>
<tr>
<td><strong>示例：</strong></td>
<td></td>
</tr>
<tr>
<td>更名：把user25 更名为user26</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span>
<span class="normal"><a href="#__codelineno-69-15">15</a></span>
<span class="normal"><a href="#__codelineno-69-16">16</a></span>
<span class="normal"><a href="#__codelineno-69-17">17</a></span>
<span class="normal"><a href="#__codelineno-69-18">18</a></span>
<span class="normal"><a href="#__codelineno-69-19">19</a></span>
<span class="normal"><a href="#__codelineno-69-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1"></a>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user show user25</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2"></a>+---------------------+----------------------------------+
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">               </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4"></a>+---------------------+----------------------------------+
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">           </span><span class="p">|</span><span class="w"> </span>b66b72e1feb145e38fad867a7cedeab6<span class="w"> </span><span class="p">|</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">             </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7"></a><span class="p">|</span><span class="w"> </span>id<span class="w">                  </span><span class="p">|</span><span class="w"> </span>9856f3f21b4d4e128d849d3b1c20a6c9<span class="w"> </span><span class="p">|</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8"></a><span class="p">|</span><span class="w"> </span>name<span class="w">                </span><span class="p">|</span><span class="w"> </span>user25<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9"></a><span class="p">|</span><span class="w"> </span>options<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11"></a>+---------------------+----------------------------------+
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user set --name user26  user25</span>
</span><span id="__span-69-13"><a id="__codelineno-69-13" name="__codelineno-69-13"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack user list</span>
</span><span id="__span-69-14"><a id="__codelineno-69-14" name="__codelineno-69-14"></a>+----------------------------------+--------+
</span><span id="__span-69-15"><a id="__codelineno-69-15" name="__codelineno-69-15"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">   </span><span class="p">|</span>
</span><span id="__span-69-16"><a id="__codelineno-69-16" name="__codelineno-69-16"></a>+----------------------------------+--------+
</span><span id="__span-69-17"><a id="__codelineno-69-17" name="__codelineno-69-17"></a><span class="p">|</span><span class="w"> </span>6fafe9a3635745ba879286c2d4e2edac<span class="w"> </span><span class="p">|</span><span class="w"> </span>demo<span class="w">   </span><span class="p">|</span>
</span><span id="__span-69-18"><a id="__codelineno-69-18" name="__codelineno-69-18"></a><span class="p">|</span><span class="w"> </span>9856f3f21b4d4e128d849d3b1c20a6c9<span class="w"> </span><span class="p">|</span><span class="w"> </span>user26<span class="w"> </span><span class="p">|</span>
</span><span id="__span-69-19"><a id="__codelineno-69-19" name="__codelineno-69-19"></a><span class="p">|</span><span class="w"> </span>e65881f9aa584883a3077c9ca481c566<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">  </span><span class="p">|</span>
</span><span id="__span-69-20"><a id="__codelineno-69-20" name="__codelineno-69-20"></a>+----------------------------------+--------+
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>更改user26的密码为000000</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1"></a>openstack<span class="w"> </span>user<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--password<span class="w"> </span><span class="s1">&#39;000000&#39;</span><span class="w"> </span>user26
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>#### 3.4.4 role管理</td>
<td></td>
</tr>
<tr>
<td>1. 查看role</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack role list</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2"></a>+----------------------------------+---------------+
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">          </span><span class="p">|</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4"></a>+----------------------------------+---------------+
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="p">|</span><span class="w"> </span>3faf8c9b164b4751a7d6776c7cf13c54<span class="w"> </span><span class="p">|</span><span class="w"> </span>member<span class="w">        </span><span class="p">|</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6"></a><span class="p">|</span><span class="w"> </span>6dd0cba763b04c66b2b871c07517f10b<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">         </span><span class="p">|</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7"></a><span class="p">|</span><span class="w"> </span>753afe4fa2d94b55ac50cdc95372879a<span class="w"> </span><span class="p">|</span><span class="w"> </span>reader<span class="w">        </span><span class="p">|</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8"></a><span class="p">|</span><span class="w"> </span>b2686d3780274cf88441147afd2f4c8c<span class="w"> </span><span class="p">|</span><span class="w"> </span>cloud1821role<span class="w"> </span><span class="p">|</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="p">|</span><span class="w"> </span>b577c714b5284f2dab28c810c0b31fe4<span class="w"> </span><span class="p">|</span><span class="w"> </span>myrole<span class="w">        </span><span class="p">|</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10"></a>+----------------------------------+---------------+
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>2. 创建role</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span>
<span class="normal"><a href="#__codelineno-72-4">4</a></span>
<span class="normal"><a href="#__codelineno-72-5">5</a></span>
<span class="normal"><a href="#__codelineno-72-6">6</a></span>
<span class="normal"><a href="#__codelineno-72-7">7</a></span>
<span class="normal"><a href="#__codelineno-72-8">8</a></span>
<span class="normal"><a href="#__codelineno-72-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack role create myrole2</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2"></a>+-------------+----------------------------------+
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4"></a>+-------------+----------------------------------+
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>de7e5e8fbe264997bcbb905b4efa923b<span class="w"> </span><span class="p">|</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="p">|</span><span class="w"> </span>name<span class="w">        </span><span class="p">|</span><span class="w"> </span>myrole2<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>3. 修改role</td>
<td></td>
</tr>
<tr>
<td>可以修改domain，与名称</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1"></a>openstack<span class="w"> </span>role<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--domain<span class="w"> </span>&lt;domain&gt;<span class="o">]</span><span class="w"> </span><span class="o">[</span>--name<span class="w"> </span>&lt;name&gt;<span class="o">]</span><span class="w"> </span>&lt;role&gt;
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>4. 删除role</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span>
<span class="normal"><a href="#__codelineno-74-14">14</a></span>
<span class="normal"><a href="#__codelineno-74-15">15</a></span>
<span class="normal"><a href="#__codelineno-74-16">16</a></span>
<span class="normal"><a href="#__codelineno-74-17">17</a></span>
<span class="normal"><a href="#__codelineno-74-18">18</a></span>
<span class="normal"><a href="#__codelineno-74-19">19</a></span>
<span class="normal"><a href="#__codelineno-74-20">20</a></span>
<span class="normal"><a href="#__codelineno-74-21">21</a></span>
<span class="normal"><a href="#__codelineno-74-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack role list</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2"></a>+----------------------------------+---------------+
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">          </span><span class="p">|</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4"></a>+----------------------------------+---------------+
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="p">|</span><span class="w"> </span>3faf8c9b164b4751a7d6776c7cf13c54<span class="w"> </span><span class="p">|</span><span class="w"> </span>member<span class="w">        </span><span class="p">|</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6"></a><span class="p">|</span><span class="w"> </span>6dd0cba763b04c66b2b871c07517f10b<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">         </span><span class="p">|</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="p">|</span><span class="w"> </span>753afe4fa2d94b55ac50cdc95372879a<span class="w"> </span><span class="p">|</span><span class="w"> </span>reader<span class="w">        </span><span class="p">|</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="p">|</span><span class="w"> </span>b2686d3780274cf88441147afd2f4c8c<span class="w"> </span><span class="p">|</span><span class="w"> </span>cloud1821role<span class="w"> </span><span class="p">|</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9"></a><span class="p">|</span><span class="w"> </span>b577c714b5284f2dab28c810c0b31fe4<span class="w"> </span><span class="p">|</span><span class="w"> </span>myrole<span class="w">        </span><span class="p">|</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10"></a><span class="p">|</span><span class="w"> </span>de7e5e8fbe264997bcbb905b4efa923b<span class="w"> </span><span class="p">|</span><span class="w"> </span>myrole2<span class="w">       </span><span class="p">|</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11"></a>+----------------------------------+---------------+
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack role delete myrole2</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack role list</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14"></a>+----------------------------------+---------------+
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                               </span><span class="p">|</span><span class="w"> </span>Name<span class="w">          </span><span class="p">|</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16"></a>+----------------------------------+---------------+
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17"></a><span class="p">|</span><span class="w"> </span>3faf8c9b164b4751a7d6776c7cf13c54<span class="w"> </span><span class="p">|</span><span class="w"> </span>member<span class="w">        </span><span class="p">|</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18"></a><span class="p">|</span><span class="w"> </span>6dd0cba763b04c66b2b871c07517f10b<span class="w"> </span><span class="p">|</span><span class="w"> </span>admin<span class="w">         </span><span class="p">|</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19"></a><span class="p">|</span><span class="w"> </span>753afe4fa2d94b55ac50cdc95372879a<span class="w"> </span><span class="p">|</span><span class="w"> </span>reader<span class="w">        </span><span class="p">|</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20"></a><span class="p">|</span><span class="w"> </span>b2686d3780274cf88441147afd2f4c8c<span class="w"> </span><span class="p">|</span><span class="w"> </span>cloud1821role<span class="w"> </span><span class="p">|</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21"></a><span class="p">|</span><span class="w"> </span>b577c714b5284f2dab28c810c0b31fe4<span class="w"> </span><span class="p">|</span><span class="w"> </span>myrole<span class="w">        </span><span class="p">|</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22"></a>+----------------------------------+---------------+
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>5. 增加add</td>
<td></td>
</tr>
<tr>
<td>添加可以添加project ,user</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack role add --project service2 --user user26 myrole</span>
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>6. 显示详细信息 show</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span>
<span class="normal"><a href="#__codelineno-76-4">4</a></span>
<span class="normal"><a href="#__codelineno-76-5">5</a></span>
<span class="normal"><a href="#__codelineno-76-6">6</a></span>
<span class="normal"><a href="#__codelineno-76-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1">#openstack role show -f json myrole</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="o">{</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="w">  </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;b577c714b5284f2dab28c810c0b31fe4&quot;</span>,
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="w">  </span><span class="s2">&quot;description&quot;</span>:<span class="w"> </span>null,
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5"></a><span class="w">  </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;myrole&quot;</span>,
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="w">  </span><span class="s2">&quot;domain_id&quot;</span>:<span class="w"> </span>null
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="o">}[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1">#</span>
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>### 3.5 获取token</td>
<td></td>
</tr>
<tr>
<td>#### 3.5.1使用openstack命令获取token</td>
<td></td>
</tr>
<tr>
<td>1. 编辑环境变量keystone_admin文件，内容如下：</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span>
<span class="normal"><a href="#__codelineno-77-2">2</a></span>
<span class="normal"><a href="#__codelineno-77-3">3</a></span>
<span class="normal"><a href="#__codelineno-77-4">4</a></span>
<span class="normal"><a href="#__codelineno-77-5">5</a></span>
<span class="normal"><a href="#__codelineno-77-6">6</a></span>
<span class="normal"><a href="#__codelineno-77-7">7</a></span>
<span class="normal"><a href="#__codelineno-77-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># cat keystone_admin</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_USERNAME</span><span class="o">=</span>admin
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_PASSWORD</span><span class="o">=</span>admin123
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_PROJECT_NAME</span><span class="o">=</span>admin
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_USER_DOMAIN_NAME</span><span class="o">=</span>Default
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_PROJECT_DOMAIN_NAME</span><span class="o">=</span>Default
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_AUTH_URL</span><span class="o">=</span>http://controller:5000/v3
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS_IDENTITY_API_VERSION</span><span class="o">=</span><span class="m">3</span>
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>2. 输出环境变量:</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="w"> </span><span class="nb">source</span><span class="w">  </span>keystone_admin
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>3. 获取token</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span>
<span class="normal"><a href="#__codelineno-79-3">3</a></span>
<span class="normal"><a href="#__codelineno-79-4">4</a></span>
<span class="normal"><a href="#__codelineno-79-5">5</a></span>
<span class="normal"><a href="#__codelineno-79-6">6</a></span>
<span class="normal"><a href="#__codelineno-79-7">7</a></span>
<span class="normal"><a href="#__codelineno-79-8">8</a></span>
<span class="normal"><a href="#__codelineno-79-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack token issue</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2"></a>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">      </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                                                                                                                                                                                   </span><span class="p">|</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4"></a>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="p">|</span><span class="w"> </span>expires<span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">2019</span>-10-16T18:30:03+0000<span class="w">                                                                                                                                                                </span><span class="p">|</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="p">|</span><span class="w"> </span>id<span class="w">         </span><span class="p">|</span><span class="w"> </span>gAAAAABdp1Ob_DAf2oFIstLWFHWMgkiQGiDcXUc8ymFdIG5XUC4DN3v5VkJUHNqmsCWhLpkr3Eu--4ca5TR33qsWZUoISQjsO3lyCbmeWDJMJ_vLf10YD-yOwp-yld5FOgqALHG4r2oejAYhA6_9Ler42qFLrgOZyT1ZKOxtYdnFzq0q8FB9eUA<span class="w"> </span><span class="p">|</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7"></a><span class="p">|</span><span class="w"> </span>project_id<span class="w"> </span><span class="p">|</span><span class="w"> </span>58e2a0860fe94bb4b244462fa9d39288<span class="w">                                                                                                                                                        </span><span class="p">|</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="p">|</span><span class="w"> </span>user_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>e65881f9aa584883a3077c9ca481c566<span class="w">                                                                                                                                                        </span><span class="p">|</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9"></a>+------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>其中的id即为获取的token</td>
<td></td>
</tr>
<tr>
<td>#### 3.5.2 使用curl获取</td>
<td></td>
</tr>
<tr>
<td>1. curl</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># curl http://localhost:5000/v3/auth/tokens</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="o">{</span><span class="s2">&quot;error&quot;</span>:<span class="o">{</span><span class="s2">&quot;code&quot;</span>:401,<span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;The request you have made requires authentication.&quot;</span>,<span class="s2">&quot;title&quot;</span>:<span class="s2">&quot;Unauthorized&quot;</span><span class="o">}}</span>
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>2. 必须进行授权才能够访问</td>
<td></td>
</tr>
<tr>
<td>3.</td>
<td></td>
</tr>
<tr>
<td><div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span>
<span class="normal"><a href="#__codelineno-81-11">11</a></span>
<span class="normal"><a href="#__codelineno-81-12">12</a></span>
<span class="normal"><a href="#__codelineno-81-13">13</a></span>
<span class="normal"><a href="#__codelineno-81-14">14</a></span>
<span class="normal"><a href="#__codelineno-81-15">15</a></span>
<span class="normal"><a href="#__codelineno-81-16">16</a></span>
<span class="normal"><a href="#__codelineno-81-17">17</a></span>
<span class="normal"><a href="#__codelineno-81-18">18</a></span>
<span class="normal"><a href="#__codelineno-81-19">19</a></span>
<span class="normal"><a href="#__codelineno-81-20">20</a></span>
<span class="normal"><a href="#__codelineno-81-21">21</a></span>
<span class="normal"><a href="#__codelineno-81-22">22</a></span>
<span class="normal"><a href="#__codelineno-81-23">23</a></span>
<span class="normal"><a href="#__codelineno-81-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span><span class="c1"># (curl -i   -H &quot;Content-Type: application/json&quot;   -d &#39;</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="o">{</span><span class="w"> </span><span class="s2">&quot;auth&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="w">    </span><span class="s2">&quot;identity&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="w">      </span><span class="s2">&quot;methods&quot;</span>:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;password&quot;</span><span class="o">]</span>,
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5"></a><span class="w">      </span><span class="s2">&quot;password&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6"></a><span class="w">        </span><span class="s2">&quot;user&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="w">          </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;admin&quot;</span>,
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8"></a><span class="w">          </span><span class="s2">&quot;domain&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="w"> </span><span class="o">}</span>,
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9"></a><span class="w">          </span><span class="s2">&quot;password&quot;</span>:<span class="w"> </span><span class="s2">&quot;admin123&quot;</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11"></a><span class="w">      </span><span class="o">}</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12"></a><span class="w">    </span><span class="o">}</span>,
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13"></a><span class="w">    </span><span class="s2">&quot;scope&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14"></a><span class="w">      </span><span class="s2">&quot;project&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15"></a><span class="w">        </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;admin&quot;</span>,
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16"></a><span class="w">        </span><span class="s2">&quot;domain&quot;</span>:<span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;id&quot;</span>:<span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="w"> </span><span class="o">}</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17"></a><span class="w">      </span><span class="o">}</span>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19"></a><span class="w">  </span><span class="o">}</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20"></a><span class="o">}</span><span class="s1">&#39;   &quot;http://localhost:5000/v3/auth/tokens&quot;; ) |grep &quot;^X-Subject-Token:&quot; | awk &#39;</span><span class="o">{</span>print<span class="w"> </span><span class="nv">$2</span><span class="o">}</span><span class="err">&#39;</span>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21"></a><span class="w">  </span>%<span class="w"> </span>Total<span class="w">    </span>%<span class="w"> </span>Received<span class="w"> </span>%<span class="w"> </span>Xferd<span class="w">  </span>Average<span class="w"> </span>Speed<span class="w">   </span>Time<span class="w">    </span>Time<span class="w">     </span>Time<span class="w">  </span>Current
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22"></a><span class="w">                                 </span>Dload<span class="w">  </span>Upload<span class="w">   </span>Total<span class="w">   </span>Spent<span class="w">    </span>Left<span class="w">  </span>Speed
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23"></a><span class="m">100</span><span class="w">  </span><span class="m">1562</span><span class="w">  </span><span class="m">100</span><span class="w">  </span><span class="m">1220</span><span class="w">  </span><span class="m">100</span><span class="w">   </span><span class="m">342</span><span class="w">   </span><span class="m">1782</span><span class="w">    </span><span class="m">499</span><span class="w"> </span>--:--:--<span class="w"> </span>--:--:--<span class="w"> </span>--:--:--<span class="w">  </span><span class="m">1781</span>
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24"></a>gAAAAABdp1hb1YC1jTtenOq7YnQZfdSOd478_Y1wWBil4_Wa6i4VCD4b8JP_b9PVYSt8uATRMbs2Gcjg2GBvyb-abHlrgOrO3H8IxiS20az1sy7LOBkMuiUmWZHHzhusRFJ4kZe4vnCZU0JmiC-E7ksiMZoIn2D2hmcCfz2XJcvDIBGqjz2Ys0k
</span></code></pre></div></td></tr></table></div></td>
<td></td>
</tr>
<tr>
<td>#### 3.5.3使用客户端获取</td>
<td></td>
</tr>
<tr>
<td>1. restclient firefox插件</td>
<td></td>
</tr>
</tbody>
</table>
<p><img alt="" src="_v_images\20191026114300124_563824183.png" /></p>
<p><img alt="20191026114917577_1495193117" src="_v_images\20191026114917577_1495193117.png" /></p>
<p><img alt="20191026115030955_2004563872" src="_v_images\20191026115030955_2004563872.png" /></p>
<p><img alt="20191026115139474_981542568" src="_v_images\20191026115139474_981542568.png" /></p>
<p><img alt="20191026115222783_1964047769" src="_v_images\20191026115222783_1964047769.png" /></p>
<p><strong>备注：如果出现不可以访问现象，请在控制节点上执行：iptables -F</strong></p>
<h1 id="glance">Glance服务:</h1>
<blockquote>
<p>在安装和配置展示位置服务之前，必须创建数据库，服务凭证和API端点。</p>
</blockquote>
<h4 id="1_1">1. 创建数据库</h4>
<ol>
<li>以<code>root</code>登陆数据库：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1"></a>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</span></code></pre></div></td></tr></table></div>
<ol>
<li>创建<code>glance</code>数据库 ：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>glance<span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>授予对<strong>glance</strong>数据库的适当访问权限：</li>
</ol>
<p><strong>注意：</strong><code>GLANCE_DBPASS</code>替换成自己的<code>glance</code>密码</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span>
<span class="normal"><a href="#__codelineno-84-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>glance.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;glance&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;GLANCE_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>glance.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;glance&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;GLANCE_DBPASS&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="2-admincli">2. 来源admin凭据来访问仅管理员CLI命令：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="nb">source</span><span class="w"> </span>./keystone-admin
</span></code></pre></div></td></tr></table></div>
<h4 id="3_1">3.创建服务凭证：</h4>
<ol>
<li>创建glance用户：</li>
</ol>
<p><strong>注意</strong>：<code>User Password</code>就是glance的password</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-86-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-86-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-86-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-86-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-86-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-86-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-86-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-86-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-86-10">10</a></span>
<span class="normal"><a href="#__codelineno-86-11">11</a></span>
<span class="normal"><a href="#__codelineno-86-12">12</a></span>
<span class="normal"><a href="#__codelineno-86-13">13</a></span>
<span class="normal"><a href="#__codelineno-86-14">14</a></span>
<span class="normal"><a href="#__codelineno-86-15">15</a></span>
<span class="normal"><a href="#__codelineno-86-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="w"> </span>root@controlller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>openstack<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>‐‐description<span class="w"> </span><span class="s2">&quot;glance user&quot;</span><span class="w"> </span>glance
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="w"> </span>No<span class="w"> </span>password<span class="w"> </span>was<span class="w"> </span>supplied,<span class="w"> </span>authentication<span class="w"> </span>will<span class="w"> </span>fail<span class="w"> </span>when<span class="w"> </span>a<span class="w"> </span>user<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>have<span class="w"> </span>a<span class="w"> </span>password.
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="w"> </span>+‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐+‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐+
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>Field<span class="w">               </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="w"> </span>+‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐+‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐+
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>description<span class="w">         </span><span class="p">|</span><span class="w"> </span>glance<span class="w"> </span>user<span class="w">                      </span><span class="p">|</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>domain_id<span class="w">           </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>enabled<span class="w">             </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>id<span class="w">                  </span><span class="p">|</span><span class="w"> </span>20f7c58057a248289ad71104d5f03abf<span class="w"> </span><span class="p">|</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>name<span class="w">                </span><span class="p">|</span><span class="w"> </span>glance<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>options<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13"></a><span class="w"> </span>+‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐+‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐‐+
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14"></a><span class="w"> </span><span class="o">[</span>root@controlller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>openstack<span class="w"> </span>user<span class="w"> </span><span class="nb">set</span><span class="w"> </span>‐‐password‐prompt<span class="w"> </span>glance
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15"></a><span class="w"> </span>User<span class="w"> </span>Password:
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16"></a><span class="w"> </span>Repeat<span class="w"> </span>User<span class="w"> </span>Password:
</span></code></pre></div></td></tr></table></div>
<ol>
<li>将<code>admin</code>角色添加到<code>glance</code>用户和 <code>service</code>项目：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1"></a>openstack<span class="w"> </span>role<span class="w"> </span>add<span class="w"> </span>--project<span class="w"> </span>service<span class="w"> </span>--user<span class="w"> </span>glance<span class="w"> </span>admin
</span></code></pre></div></td></tr></table></div>
<ol>
<li>创建<code>glance</code>服务实体：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-88-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-88-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-88-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-88-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-88-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-88-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-88-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-88-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-88-10">10</a></span>
<span class="normal"><a href="#__codelineno-88-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1"></a>openstack<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>glance<span class="w"> </span>--description<span class="w"> </span><span class="s2">&quot;OpenStack Image&quot;</span><span class="w"> </span>image
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2"></a>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3"></a>+-------------+----------------------------------+
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5"></a>+-------------+----------------------------------+
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>OpenStack<span class="w"> </span>Image<span class="w">                  </span><span class="p">|</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>8c2c7f1b9b5049ea9e63757b5533e6d2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9"></a><span class="p">|</span><span class="w"> </span>name<span class="w">        </span><span class="p">|</span><span class="w"> </span>glance<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10"></a><span class="p">|</span><span class="w"> </span><span class="nb">type</span><span class="w">        </span><span class="p">|</span><span class="w"> </span>image<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<h4 id="4-api">4. 创建图像服务API端点：</h4>
<ol>
<li>完成以下操作：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-89-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-89-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-89-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-89-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-89-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-89-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-89-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-89-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-89-10">10</a></span>
<span class="normal"><a href="#__codelineno-89-11">11</a></span>
<span class="normal"><a href="#__codelineno-89-12">12</a></span>
<span class="normal"><a href="#__codelineno-89-13">13</a></span>
<span class="normal"><a href="#__codelineno-89-14">14</a></span>
<span class="normal"><a href="#__codelineno-89-15">15</a></span>
<span class="normal"><a href="#__codelineno-89-16">16</a></span>
<span class="normal"><a href="#__codelineno-89-17">17</a></span>
<span class="normal"><a href="#__codelineno-89-18">18</a></span>
<span class="normal"><a href="#__codelineno-89-19">19</a></span>
<span class="normal"><a href="#__codelineno-89-20">20</a></span>
<span class="normal"><a href="#__codelineno-89-21">21</a></span>
<span class="normal"><a href="#__codelineno-89-22">22</a></span>
<span class="normal"><a href="#__codelineno-89-23">23</a></span>
<span class="normal"><a href="#__codelineno-89-24">24</a></span>
<span class="normal"><a href="#__codelineno-89-25">25</a></span>
<span class="normal"><a href="#__codelineno-89-26">26</a></span>
<span class="normal"><a href="#__codelineno-89-27">27</a></span>
<span class="normal"><a href="#__codelineno-89-28">28</a></span>
<span class="normal"><a href="#__codelineno-89-29">29</a></span>
<span class="normal"><a href="#__codelineno-89-30">30</a></span>
<span class="normal"><a href="#__codelineno-89-31">31</a></span>
<span class="normal"><a href="#__codelineno-89-32">32</a></span>
<span class="normal"><a href="#__codelineno-89-33">33</a></span>
<span class="normal"><a href="#__codelineno-89-34">34</a></span>
<span class="normal"><a href="#__codelineno-89-35">35</a></span>
<span class="normal"><a href="#__codelineno-89-36">36</a></span>
<span class="normal"><a href="#__codelineno-89-37">37</a></span>
<span class="normal"><a href="#__codelineno-89-38">38</a></span>
<span class="normal"><a href="#__codelineno-89-39">39</a></span>
<span class="normal"><a href="#__codelineno-89-40">40</a></span>
<span class="normal"><a href="#__codelineno-89-41">41</a></span>
<span class="normal"><a href="#__codelineno-89-42">42</a></span>
<span class="normal"><a href="#__codelineno-89-43">43</a></span>
<span class="normal"><a href="#__codelineno-89-44">44</a></span>
<span class="normal"><a href="#__codelineno-89-45">45</a></span>
<span class="normal"><a href="#__codelineno-89-46">46</a></span>
<span class="normal"><a href="#__codelineno-89-47">47</a></span>
<span class="normal"><a href="#__codelineno-89-48">48</a></span>
<span class="normal"><a href="#__codelineno-89-49">49</a></span>
<span class="normal"><a href="#__codelineno-89-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="w">  </span>image<span class="w"> </span>public<span class="w"> </span>http://controller:9292
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3"></a>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4"></a>+--------------+----------------------------------+
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6"></a>+--------------+----------------------------------+
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>340be3625e9b4239a6415d034e98aace<span class="w"> </span><span class="p">|</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>public<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>8c2c7f1b9b5049ea9e63757b5533e6d2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>glance<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>image<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:9292<span class="w">           </span><span class="p">|</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16"></a>+--------------+----------------------------------+
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17"></a>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19"></a><span class="w">  </span>image<span class="w"> </span>internal<span class="w"> </span>http://controller:9292
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20"></a>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21"></a>+--------------+----------------------------------+
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23"></a>+--------------+----------------------------------+
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-89-25"><a id="__codelineno-89-25" name="__codelineno-89-25"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>a6e4b153c2ae4c919eccfdbb7dceb5d2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-89-26"><a id="__codelineno-89-26" name="__codelineno-89-26"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>internal<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-89-27"><a id="__codelineno-89-27" name="__codelineno-89-27"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-89-28"><a id="__codelineno-89-28" name="__codelineno-89-28"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-89-29"><a id="__codelineno-89-29" name="__codelineno-89-29"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>8c2c7f1b9b5049ea9e63757b5533e6d2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-89-30"><a id="__codelineno-89-30" name="__codelineno-89-30"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>glance<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-89-31"><a id="__codelineno-89-31" name="__codelineno-89-31"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>image<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-32"><a id="__codelineno-89-32" name="__codelineno-89-32"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:9292<span class="w">           </span><span class="p">|</span>
</span><span id="__span-89-33"><a id="__codelineno-89-33" name="__codelineno-89-33"></a>+--------------+----------------------------------+
</span><span id="__span-89-34"><a id="__codelineno-89-34" name="__codelineno-89-34"></a>
</span><span id="__span-89-35"><a id="__codelineno-89-35" name="__codelineno-89-35"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-89-36"><a id="__codelineno-89-36" name="__codelineno-89-36"></a><span class="w">  </span>image<span class="w"> </span>admin<span class="w"> </span>http://controller:9292
</span><span id="__span-89-37"><a id="__codelineno-89-37" name="__codelineno-89-37"></a>
</span><span id="__span-89-38"><a id="__codelineno-89-38" name="__codelineno-89-38"></a>+--------------+----------------------------------+
</span><span id="__span-89-39"><a id="__codelineno-89-39" name="__codelineno-89-39"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-40"><a id="__codelineno-89-40" name="__codelineno-89-40"></a>+--------------+----------------------------------+
</span><span id="__span-89-41"><a id="__codelineno-89-41" name="__codelineno-89-41"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-89-42"><a id="__codelineno-89-42" name="__codelineno-89-42"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>0c37ed58103f4300a84ff125a539032d<span class="w"> </span><span class="p">|</span>
</span><span id="__span-89-43"><a id="__codelineno-89-43" name="__codelineno-89-43"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>admin<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-44"><a id="__codelineno-89-44" name="__codelineno-89-44"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-89-45"><a id="__codelineno-89-45" name="__codelineno-89-45"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-89-46"><a id="__codelineno-89-46" name="__codelineno-89-46"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>8c2c7f1b9b5049ea9e63757b5533e6d2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-89-47"><a id="__codelineno-89-47" name="__codelineno-89-47"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>glance<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-89-48"><a id="__codelineno-89-48" name="__codelineno-89-48"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>image<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-89-49"><a id="__codelineno-89-49" name="__codelineno-89-49"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:9292<span class="w">           </span><span class="p">|</span>
</span><span id="__span-89-50"><a id="__codelineno-89-50" name="__codelineno-89-50"></a>+--------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<h2 id="_1">安装和配置部份</h2>
<h4 id="1_2">1.  安装软件包：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-glance
</span></code></pre></div></td></tr></table></div>
<h4 id="2-etcglanceglance-apiconf">2. 编辑<code>/etc/glance/glance-api.conf</code>：</h4>
<ul>
<li>在该<code>[database]</code>部分中，配置数据库访问</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span>
<span class="normal"><a href="#__codelineno-91-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="o">[</span>database<span class="o">]</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="c1"># ...</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
</span></code></pre></div></td></tr></table></div>
<p><strong>注意：</strong>替换<code>GLANCE_DBPASS</code>为自己<code>glance</code>的密码</p>
<ul>
<li>在<code>[keystone_authtoken]</code>和<code>[paste_deploy]</code>部分中，配置身份服务访问：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-92-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-92-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-92-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-92-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-92-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-92-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-92-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-92-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-92-10">10</a></span>
<span class="normal"><a href="#__codelineno-92-11">11</a></span>
<span class="normal"><a href="#__codelineno-92-12">12</a></span>
<span class="normal"><a href="#__codelineno-92-13">13</a></span>
<span class="normal"><a href="#__codelineno-92-14">14</a></span>
<span class="normal"><a href="#__codelineno-92-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="c1"># ...</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="nv">www_authenticate_uri</span><span class="w">  </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>glance
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>GLANCE_PASS
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12"></a>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13"></a><span class="o">[</span>paste_deploy<span class="o">]</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14"></a><span class="c1"># ...</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15"></a><span class="nv">flavor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span></code></pre></div></td></tr></table></div>
<p><strong>注意：</strong>替换<code>GLANCE_PASS</code>为自己<code>glance</code>的密码</p>
<ul>
<li>在该<code>[glance_store]</code>部分中，配置本地文件系统存储和图像文件的位置：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span>
<span class="normal"><a href="#__codelineno-93-3">3</a></span>
<span class="normal"><a href="#__codelineno-93-4">4</a></span>
<span class="normal"><a href="#__codelineno-93-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="o">[</span>glance_store<span class="o">]</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="c1"># ...</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="nv">stores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>file,http
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4"></a><span class="nv">default_store</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>file
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5"></a><span class="nv">filesystem_store_datadir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/lib/glance/images/
</span></code></pre></div></td></tr></table></div>
<h4 id="3-etcglanceglance-registryconf">3. 编辑<code>/etc/glance/glance-registry.conf</code>：</h4>
<ul>
<li>在该<code>[database]</code>部分中，配置数据库访问：</li>
</ul>
<p><strong>注意：</strong>替换<code>GLANCE_DBPASS</code>为自己<code>glance</code>的密码</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span>
<span class="normal"><a href="#__codelineno-94-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="o">[</span>database<span class="o">]</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="c1"># ...</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://glance:GLANCE_DBPASS@controller/glance
</span></code></pre></div></td></tr></table></div>
<ul>
<li>在<code>[keystone_authtoken]</code>和<code>[paste_deploy]</code>部分中，配置身份服务访问：</li>
</ul>
<p><strong>注意：</strong>替换<code>GLANCE_PASS</code>为自己<code>glance</code>的密码</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-95-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-95-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-95-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-95-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-95-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-95-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-95-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-95-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-95-10">10</a></span>
<span class="normal"><a href="#__codelineno-95-11">11</a></span>
<span class="normal"><a href="#__codelineno-95-12">12</a></span>
<span class="normal"><a href="#__codelineno-95-13">13</a></span>
<span class="normal"><a href="#__codelineno-95-14">14</a></span>
<span class="normal"><a href="#__codelineno-95-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="c1"># ...</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="nv">www_authenticate_uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>glance
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>GLANCE_PASS
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12"></a>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13"></a><span class="o">[</span>paste_deploy<span class="o">]</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14"></a><span class="c1"># ...</span>
</span><span id="__span-95-15"><a id="__codelineno-95-15" name="__codelineno-95-15"></a><span class="nv">flavor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span></code></pre></div></td></tr></table></div>
<h4 id="4-glance">4. 同步glance数据库</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1"></a>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;glance-manage db_sync&quot;</span><span class="w"> </span>glance
</span></code></pre></div></td></tr></table></div>
<h4 id="5">5. 完成安装</h4>
<ul>
<li>设置开机自动启动，并启动glance</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span>
<span class="normal"><a href="#__codelineno-97-2">2</a></span>
<span class="normal"><a href="#__codelineno-97-3">3</a></span>
<span class="normal"><a href="#__codelineno-97-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>openstack-glance-api.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="w">  </span>openstack-glance-registry.service
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>openstack-glance-api.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="w">  </span>openstack-glance-registry.service
</span></code></pre></div></td></tr></table></div>
<h2 id="_2">验证</h2>
<ol>
<li>查看9292端口是否可用</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span>
<span class="normal"><a href="#__codelineno-98-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>ss<span class="w"> </span>-ntl<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">9292</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2"></a>LISTEN<span class="w">     </span><span class="m">0</span><span class="w">      </span><span class="m">128</span><span class="w">          </span>*:9292<span class="w">                     </span>*:*<span class="w">  </span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>来源<code>admin</code>凭据来访问仅管理员CLI命令：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>keystone_admin
</span></code></pre></div></td></tr></table></div>
<ol>
<li>上传镜像：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-100-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-100-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-100-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-100-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-100-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-100-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-100-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-100-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-100-10">10</a></span>
<span class="normal"><a href="#__codelineno-100-11">11</a></span>
<span class="normal"><a href="#__codelineno-100-12">12</a></span>
<span class="normal"><a href="#__codelineno-100-13">13</a></span>
<span class="normal"><a href="#__codelineno-100-14">14</a></span>
<span class="normal"><a href="#__codelineno-100-15">15</a></span>
<span class="normal"><a href="#__codelineno-100-16">16</a></span>
<span class="normal"><a href="#__codelineno-100-17">17</a></span>
<span class="normal"><a href="#__codelineno-100-18">18</a></span>
<span class="normal"><a href="#__codelineno-100-19">19</a></span>
<span class="normal"><a href="#__codelineno-100-20">20</a></span>
<span class="normal"><a href="#__codelineno-100-21">21</a></span>
<span class="normal"><a href="#__codelineno-100-22">22</a></span>
<span class="normal"><a href="#__codelineno-100-23">23</a></span>
<span class="normal"><a href="#__codelineno-100-24">24</a></span>
<span class="normal"><a href="#__codelineno-100-25">25</a></span>
<span class="normal"><a href="#__codelineno-100-26">26</a></span>
<span class="normal"><a href="#__codelineno-100-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>openstack<span class="w"> </span>image<span class="w"> </span>create<span class="w"> </span><span class="s2">&quot;cirros&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2"></a>&gt;<span class="w"> </span>--file<span class="w"> </span>/root/images/cirros-0.4.0-x86_64-disk.img<span class="w"> </span><span class="se">\</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3"></a>&gt;<span class="w"> </span>--disk-format<span class="w"> </span>qcow2<span class="w"> </span>--container-format<span class="w"> </span>bare<span class="w"> </span><span class="se">\</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4"></a>&gt;<span class="w"> </span>--public
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5"></a>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6"></a>+------------------+------------------------------------------------------+
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">            </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                                                </span><span class="p">|</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8"></a>+------------------+------------------------------------------------------+
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9"></a><span class="p">|</span><span class="w"> </span>checksum<span class="w">         </span><span class="p">|</span><span class="w"> </span>133eae9fb1c98f45894a4e60d8736619<span class="w">                     </span><span class="p">|</span>
</span><span id="__span-100-10"><a id="__codelineno-100-10" name="__codelineno-100-10"></a><span class="p">|</span><span class="w"> </span>container_format<span class="w"> </span><span class="p">|</span><span class="w"> </span>bare<span class="w">                                                 </span><span class="p">|</span>
</span><span id="__span-100-11"><a id="__codelineno-100-11" name="__codelineno-100-11"></a><span class="p">|</span><span class="w"> </span>created_at<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">2015</span>-03-26T16:52:10Z<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-100-12"><a id="__codelineno-100-12" name="__codelineno-100-12"></a><span class="p">|</span><span class="w"> </span>disk_format<span class="w">      </span><span class="p">|</span><span class="w"> </span>qcow2<span class="w">                                                </span><span class="p">|</span>
</span><span id="__span-100-13"><a id="__codelineno-100-13" name="__codelineno-100-13"></a><span class="p">|</span><span class="w"> </span>file<span class="w">             </span><span class="p">|</span><span class="w"> </span>/v2/images/cc5c6982-4910-471e-b864-1098015901b5/file<span class="w"> </span><span class="p">|</span>
</span><span id="__span-100-14"><a id="__codelineno-100-14" name="__codelineno-100-14"></a><span class="p">|</span><span class="w"> </span>id<span class="w">               </span><span class="p">|</span><span class="w"> </span>cc5c6982-4910-471e-b864-1098015901b5<span class="w">                 </span><span class="p">|</span>
</span><span id="__span-100-15"><a id="__codelineno-100-15" name="__codelineno-100-15"></a><span class="p">|</span><span class="w"> </span>min_disk<span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">                                                    </span><span class="p">|</span>
</span><span id="__span-100-16"><a id="__codelineno-100-16" name="__codelineno-100-16"></a><span class="p">|</span><span class="w"> </span>min_ram<span class="w">          </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">                                                    </span><span class="p">|</span>
</span><span id="__span-100-17"><a id="__codelineno-100-17" name="__codelineno-100-17"></a><span class="p">|</span><span class="w"> </span>name<span class="w">             </span><span class="p">|</span><span class="w"> </span>cirros<span class="w">                                               </span><span class="p">|</span>
</span><span id="__span-100-18"><a id="__codelineno-100-18" name="__codelineno-100-18"></a><span class="p">|</span><span class="w"> </span>owner<span class="w">            </span><span class="p">|</span><span class="w"> </span>ae7a98326b9c455588edd2656d723b9d<span class="w">                     </span><span class="p">|</span>
</span><span id="__span-100-19"><a id="__codelineno-100-19" name="__codelineno-100-19"></a><span class="p">|</span><span class="w"> </span>protected<span class="w">        </span><span class="p">|</span><span class="w"> </span>False<span class="w">                                                </span><span class="p">|</span>
</span><span id="__span-100-20"><a id="__codelineno-100-20" name="__codelineno-100-20"></a><span class="p">|</span><span class="w"> </span>schema<span class="w">           </span><span class="p">|</span><span class="w"> </span>/v2/schemas/image<span class="w">                                    </span><span class="p">|</span>
</span><span id="__span-100-21"><a id="__codelineno-100-21" name="__codelineno-100-21"></a><span class="p">|</span><span class="w"> </span>size<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="m">13200896</span><span class="w">                                             </span><span class="p">|</span>
</span><span id="__span-100-22"><a id="__codelineno-100-22" name="__codelineno-100-22"></a><span class="p">|</span><span class="w"> </span>status<span class="w">           </span><span class="p">|</span><span class="w"> </span>active<span class="w">                                               </span><span class="p">|</span>
</span><span id="__span-100-23"><a id="__codelineno-100-23" name="__codelineno-100-23"></a><span class="p">|</span><span class="w"> </span>tags<span class="w">             </span><span class="p">|</span><span class="w">                                                      </span><span class="p">|</span>
</span><span id="__span-100-24"><a id="__codelineno-100-24" name="__codelineno-100-24"></a><span class="p">|</span><span class="w"> </span>updated_at<span class="w">       </span><span class="p">|</span><span class="w"> </span><span class="m">2015</span>-03-26T16:52:10Z<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-100-25"><a id="__codelineno-100-25" name="__codelineno-100-25"></a><span class="p">|</span><span class="w"> </span>virtual_size<span class="w">     </span><span class="p">|</span><span class="w"> </span>None<span class="w">                                                 </span><span class="p">|</span>
</span><span id="__span-100-26"><a id="__codelineno-100-26" name="__codelineno-100-26"></a><span class="p">|</span><span class="w"> </span>visibility<span class="w">       </span><span class="p">|</span><span class="w"> </span>public<span class="w">                                               </span><span class="p">|</span>
</span><span id="__span-100-27"><a id="__codelineno-100-27" name="__codelineno-100-27"></a>+------------------+------------------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<ol>
<li>确认上传并验证属性：</li>
</ol>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1">1</a></span>
<span class="normal"><a href="#__codelineno-101-2">2</a></span>
<span class="normal"><a href="#__codelineno-101-3">3</a></span>
<span class="normal"><a href="#__codelineno-101-4">4</a></span>
<span class="normal"><a href="#__codelineno-101-5">5</a></span>
<span class="normal"><a href="#__codelineno-101-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1"></a>[root@controller ~]$ openstack image list
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2"></a>+--------------------------------------+--------+--------+
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3"></a>| ID                                   | Name   | Status |
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4"></a>+------------------------------------a--+--------+--------+
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5"></a>| 60c19af9-3980-4c23-b851-df8900d117f4 | cirros | active |
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6"></a>+--------------------------------------+--------+--------+
</span></code></pre></div></td></tr></table></div>
<p># Placement服务:</p>
<blockquote>
<p>在安装和配置展示位置服务之前，必须创建数据库，服务凭证和API端点。</p>
</blockquote>
<p>#### 1. 创建数据库</p>
<ol>
<li>
<p>登陆数据库：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>创建placement数据库：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>placement<span class="p">;</span>shell
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>授予访问适当的权限： </p>
<p><strong>注意</strong>： <strong>PLACEMENT_DBPASS</strong>： 使用自己的placement密码</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span>
<span class="normal"><a href="#__codelineno-104-2">2</a></span>
<span class="normal"><a href="#__codelineno-104-3">3</a></span>
<span class="normal"><a href="#__codelineno-104-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>placement.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;placement&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;PLACEMENT_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>placement.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;placement&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;PLACEMENT_DBPASS&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>#### 2. 配置用户和端点</p>
<ol>
<li>
<p>加载admin凭据来访问仅管理员CLI命令：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>keystone_admin
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>创建placement 的user：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-106-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-106-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-106-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-106-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-106-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-106-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-106-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-106-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-106-10">10</a></span>
<span class="normal"><a href="#__codelineno-106-11">11</a></span>
<span class="normal"><a href="#__codelineno-106-12">12</a></span>
<span class="normal"><a href="#__codelineno-106-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>openstack<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>--domain<span class="w"> </span>default<span class="w"> </span>--password-prompt<span class="w"> </span>placement
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2"></a>User<span class="w"> </span>Password:
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3"></a>Repeat<span class="w"> </span>User<span class="w"> </span>Password:
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4"></a>+---------------------+----------------------------------+
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">               </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-106-6"><a id="__codelineno-106-6" name="__codelineno-106-6"></a>+---------------------+----------------------------------+
</span><span id="__span-106-7"><a id="__codelineno-106-7" name="__codelineno-106-7"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">           </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-106-8"><a id="__codelineno-106-8" name="__codelineno-106-8"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">             </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-106-9"><a id="__codelineno-106-9" name="__codelineno-106-9"></a><span class="p">|</span><span class="w"> </span>id<span class="w">                  </span><span class="p">|</span><span class="w"> </span>54682aec469741c09d93f717bd5a34cf<span class="w"> </span><span class="p">|</span>
</span><span id="__span-106-10"><a id="__codelineno-106-10" name="__codelineno-106-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">                </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-106-11"><a id="__codelineno-106-11" name="__codelineno-106-11"></a><span class="p">|</span><span class="w"> </span>options<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                               </span><span class="p">|</span>
</span><span id="__span-106-12"><a id="__codelineno-106-12" name="__codelineno-106-12"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-106-13"><a id="__codelineno-106-13" name="__codelineno-106-13"></a>+---------------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>将placement用户添加到服务器项目组中：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>openstack<span class="w"> </span>role<span class="w"> </span>add<span class="w"> </span>--project<span class="w"> </span>service<span class="w"> </span>--user<span class="w"> </span>placement<span class="w"> </span>admin
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在服务目录中创建placement API项目：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-108-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-108-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-108-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-108-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-108-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-108-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-108-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-108-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-108-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack service create --name placement --description &quot;Placement API&quot; placement</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2"></a>+-------------+----------------------------------+
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4"></a>+-------------+----------------------------------+
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>Placement<span class="w"> </span>API<span class="w">                    </span><span class="p">|</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>d2b846e769bb4fd291b4664c88cb4bb4<span class="w"> </span><span class="p">|</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8"></a><span class="p">|</span><span class="w"> </span>name<span class="w">        </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9"></a><span class="p">|</span><span class="w"> </span><span class="nb">type</span><span class="w">        </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>创建Placement API服务端点：</p>
<blockquote>
<p><strong>注意</strong>： 根据您的环境，终结点的URL将根据端口（可能是8780而不是8778，或根本没有端口）和主机名而有所不同。您有责任确定正确的URL。</p>
</blockquote>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-109-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-109-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-109-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-109-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-109-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-109-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-109-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-109-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-109-10">10</a></span>
<span class="normal"><a href="#__codelineno-109-11">11</a></span>
<span class="normal"><a href="#__codelineno-109-12">12</a></span>
<span class="normal"><a href="#__codelineno-109-13">13</a></span>
<span class="normal"><a href="#__codelineno-109-14">14</a></span>
<span class="normal"><a href="#__codelineno-109-15">15</a></span>
<span class="normal"><a href="#__codelineno-109-16">16</a></span>
<span class="normal"><a href="#__codelineno-109-17">17</a></span>
<span class="normal"><a href="#__codelineno-109-18">18</a></span>
<span class="normal"><a href="#__codelineno-109-19">19</a></span>
<span class="normal"><a href="#__codelineno-109-20">20</a></span>
<span class="normal"><a href="#__codelineno-109-21">21</a></span>
<span class="normal"><a href="#__codelineno-109-22">22</a></span>
<span class="normal"><a href="#__codelineno-109-23">23</a></span>
<span class="normal"><a href="#__codelineno-109-24">24</a></span>
<span class="normal"><a href="#__codelineno-109-25">25</a></span>
<span class="normal"><a href="#__codelineno-109-26">26</a></span>
<span class="normal"><a href="#__codelineno-109-27">27</a></span>
<span class="normal"><a href="#__codelineno-109-28">28</a></span>
<span class="normal"><a href="#__codelineno-109-29">29</a></span>
<span class="normal"><a href="#__codelineno-109-30">30</a></span>
<span class="normal"><a href="#__codelineno-109-31">31</a></span>
<span class="normal"><a href="#__codelineno-109-32">32</a></span>
<span class="normal"><a href="#__codelineno-109-33">33</a></span>
<span class="normal"><a href="#__codelineno-109-34">34</a></span>
<span class="normal"><a href="#__codelineno-109-35">35</a></span>
<span class="normal"><a href="#__codelineno-109-36">36</a></span>
<span class="normal"><a href="#__codelineno-109-37">37</a></span>
<span class="normal"><a href="#__codelineno-109-38">38</a></span>
<span class="normal"><a href="#__codelineno-109-39">39</a></span>
<span class="normal"><a href="#__codelineno-109-40">40</a></span>
<span class="normal"><a href="#__codelineno-109-41">41</a></span>
<span class="normal"><a href="#__codelineno-109-42">42</a></span>
<span class="normal"><a href="#__codelineno-109-43">43</a></span>
<span class="normal"><a href="#__codelineno-109-44">44</a></span>
<span class="normal"><a href="#__codelineno-109-45">45</a></span>
<span class="normal"><a href="#__codelineno-109-46">46</a></span>
<span class="normal"><a href="#__codelineno-109-47">47</a></span>
<span class="normal"><a href="#__codelineno-109-48">48</a></span>
<span class="normal"><a href="#__codelineno-109-49">49</a></span>
<span class="normal"><a href="#__codelineno-109-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="o">[</span>root@controller<span class="w"> </span>~<span class="o">]</span><span class="c1"># openstack endpoint create --region RegionOne \</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2"></a><span class="w">  </span>placement<span class="w"> </span>public<span class="w"> </span>http://controller:8778
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3"></a>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4"></a>+--------------+----------------------------------+
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6"></a>+--------------+----------------------------------+
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>2b1b2637908b4137a9c2e0470487cbc0<span class="w"> </span><span class="p">|</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>public<span class="w">                           </span><span class="p">|</span>
</span><span id="__span-109-10"><a id="__codelineno-109-10" name="__codelineno-109-10"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-11"><a id="__codelineno-109-11" name="__codelineno-109-11"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-12"><a id="__codelineno-109-12" name="__codelineno-109-12"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>2d1a27022e6e4185b86adac4444c495f<span class="w"> </span><span class="p">|</span>
</span><span id="__span-109-13"><a id="__codelineno-109-13" name="__codelineno-109-13"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-14"><a id="__codelineno-109-14" name="__codelineno-109-14"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-15"><a id="__codelineno-109-15" name="__codelineno-109-15"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:8778<span class="w">           </span><span class="p">|</span>
</span><span id="__span-109-16"><a id="__codelineno-109-16" name="__codelineno-109-16"></a>+--------------+----------------------------------+
</span><span id="__span-109-17"><a id="__codelineno-109-17" name="__codelineno-109-17"></a>
</span><span id="__span-109-18"><a id="__codelineno-109-18" name="__codelineno-109-18"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-109-19"><a id="__codelineno-109-19" name="__codelineno-109-19"></a><span class="w">  </span>placement<span class="w"> </span>internal<span class="w"> </span>http://controller:8778
</span><span id="__span-109-20"><a id="__codelineno-109-20" name="__codelineno-109-20"></a>
</span><span id="__span-109-21"><a id="__codelineno-109-21" name="__codelineno-109-21"></a>+--------------+----------------------------------+
</span><span id="__span-109-22"><a id="__codelineno-109-22" name="__codelineno-109-22"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-109-23"><a id="__codelineno-109-23" name="__codelineno-109-23"></a>+--------------+----------------------------------+
</span><span id="__span-109-24"><a id="__codelineno-109-24" name="__codelineno-109-24"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-109-25"><a id="__codelineno-109-25" name="__codelineno-109-25"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>02bcda9a150a4bd7993ff4879df971ab<span class="w"> </span><span class="p">|</span>
</span><span id="__span-109-26"><a id="__codelineno-109-26" name="__codelineno-109-26"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>internal<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-109-27"><a id="__codelineno-109-27" name="__codelineno-109-27"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-28"><a id="__codelineno-109-28" name="__codelineno-109-28"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-29"><a id="__codelineno-109-29" name="__codelineno-109-29"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>2d1a27022e6e4185b86adac4444c495f<span class="w"> </span><span class="p">|</span>
</span><span id="__span-109-30"><a id="__codelineno-109-30" name="__codelineno-109-30"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-31"><a id="__codelineno-109-31" name="__codelineno-109-31"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-32"><a id="__codelineno-109-32" name="__codelineno-109-32"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:8778<span class="w">           </span><span class="p">|</span>
</span><span id="__span-109-33"><a id="__codelineno-109-33" name="__codelineno-109-33"></a>+--------------+----------------------------------+
</span><span id="__span-109-34"><a id="__codelineno-109-34" name="__codelineno-109-34"></a>
</span><span id="__span-109-35"><a id="__codelineno-109-35" name="__codelineno-109-35"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-109-36"><a id="__codelineno-109-36" name="__codelineno-109-36"></a><span class="w">  </span>placement<span class="w"> </span>admin<span class="w"> </span>http://controller:8778
</span><span id="__span-109-37"><a id="__codelineno-109-37" name="__codelineno-109-37"></a>
</span><span id="__span-109-38"><a id="__codelineno-109-38" name="__codelineno-109-38"></a>+--------------+----------------------------------+
</span><span id="__span-109-39"><a id="__codelineno-109-39" name="__codelineno-109-39"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-109-40"><a id="__codelineno-109-40" name="__codelineno-109-40"></a>+--------------+----------------------------------+
</span><span id="__span-109-41"><a id="__codelineno-109-41" name="__codelineno-109-41"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-109-42"><a id="__codelineno-109-42" name="__codelineno-109-42"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>3d71177b9e0f406f98cbff198d74b182<span class="w"> </span><span class="p">|</span>
</span><span id="__span-109-43"><a id="__codelineno-109-43" name="__codelineno-109-43"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>admin<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-109-44"><a id="__codelineno-109-44" name="__codelineno-109-44"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-45"><a id="__codelineno-109-45" name="__codelineno-109-45"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-46"><a id="__codelineno-109-46" name="__codelineno-109-46"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>2d1a27022e6e4185b86adac4444c495f<span class="w"> </span><span class="p">|</span>
</span><span id="__span-109-47"><a id="__codelineno-109-47" name="__codelineno-109-47"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-48"><a id="__codelineno-109-48" name="__codelineno-109-48"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-109-49"><a id="__codelineno-109-49" name="__codelineno-109-49"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:8778<span class="w">           </span><span class="p">|</span>
</span><span id="__span-109-50"><a id="__codelineno-109-50" name="__codelineno-109-50"></a>+--------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>#### 3. 安装和配置部件</p>
<ol>
<li>
<p>安装软件包：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1"></a>yum<span class="w"> </span>install<span class="w"> </span>openstack-placement-api
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>编辑<code>/etc/placement/placement.conf</code>文件并完成以下操作：</p>
<ul>
<li>
<p>在该<code>[placement_database]</code>部分中，配置数据库访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span>
<span class="normal"><a href="#__codelineno-111-2">2</a></span>
<span class="normal"><a href="#__codelineno-111-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="o">[</span>placement_database<span class="o">]</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="c1"># ...</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://placement:PLACEMENT_DBPASS@controller/placement
</span></code></pre></div></td></tr></table></div>
<p><strong>注意</strong>： <strong>PLACEMENT_DBPASS</strong> 使用自己的placement密码</p>
</li>
<li>
<p>在<code>[api]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-112-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-112-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-112-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-112-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-112-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-112-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-112-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-112-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-112-10">10</a></span>
<span class="normal"><a href="#__codelineno-112-11">11</a></span>
<span class="normal"><a href="#__codelineno-112-12">12</a></span>
<span class="normal"><a href="#__codelineno-112-13">13</a></span>
<span class="normal"><a href="#__codelineno-112-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="o">[</span>api<span class="o">]</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2"></a><span class="c1"># ...</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4"></a>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6"></a><span class="c1"># ...</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000/v3
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-112-12"><a id="__codelineno-112-12" name="__codelineno-112-12"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-112-13"><a id="__codelineno-112-13" name="__codelineno-112-13"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>placement
</span><span id="__span-112-14"><a id="__codelineno-112-14" name="__codelineno-112-14"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PLACEMENT_PASS
</span></code></pre></div></td></tr></table></div>
<p><strong>注意：</strong>PLACEMENT_PASS用自己的placement密码</p>
</li>
</ul>
</li>
<li>
<p>同步placement数据库：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1"></a>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;placement-manage db sync&quot;</span><span class="w"> </span>placement
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>#### 4.完成安装</p>
<ol>
<li>
<p>重启<code>httpd</code>服务</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>httpd
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<p>#### 5. 验证</p>
<ol>
<li>
<p>来源<code>admin</code>凭据来访问仅管理员CLI命令：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1"></a>$ . admin-openrc
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>执行状态检查以确保一切正常：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-116-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-116-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-116-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-116-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-116-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-116-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-116-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-116-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-116-10">10</a></span>
<span class="normal"><a href="#__codelineno-116-11">11</a></span>
<span class="normal"><a href="#__codelineno-116-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1"></a>$ placement-status upgrade check
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2"></a>+----------------------------------+
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3"></a>| Upgrade Check Results            |
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4"></a>+----------------------------------+
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5"></a>| Check: Missing Root Provider IDs |
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6"></a>| Result: Success                  |
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7"></a>| Details: None                    |
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8"></a>+----------------------------------+
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9"></a>| Check: Incomplete Consumers      |
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10"></a>| Result: Success                  |
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11"></a>| Details: None                    |
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12"></a>+----------------------------------+
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>执行状态检查以确保一切正常：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-117-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-117-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-117-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-117-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-117-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-117-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-117-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-117-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-117-10">10</a></span>
<span class="normal"><a href="#__codelineno-117-11">11</a></span>
<span class="normal"><a href="#__codelineno-117-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="m">1</span>.<span class="w"> </span><span class="m">1</span>.<span class="w"> </span>$<span class="w"> </span>placement-status<span class="w"> </span>upgrade<span class="w"> </span>check
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="w">      </span>+----------------------------------+
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Upgrade<span class="w"> </span>Check<span class="w"> </span>Results<span class="w">         </span><span class="p">|</span>
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="w">      </span>+----------------------------------+
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Check:<span class="w"> </span>Missing<span class="w"> </span>Root<span class="w"> </span>Provider<span class="w"> </span>IDs<span class="w"> </span><span class="p">|</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Result:<span class="w"> </span>Success<span class="w">             </span><span class="p">|</span>
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Details:<span class="w"> </span>None<span class="w">              </span><span class="p">|</span>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8"></a><span class="w">      </span>+----------------------------------+
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Check:<span class="w"> </span>Incomplete<span class="w"> </span>Consumers<span class="w">     </span><span class="p">|</span>
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Result:<span class="w"> </span>Success<span class="w">             </span><span class="p">|</span>
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11"></a><span class="w">      </span><span class="p">|</span><span class="w"> </span>Details:<span class="w"> </span>None<span class="w">              </span><span class="p">|</span>
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12"></a><span class="w">      </span>+----------------------------------+<span class="p">|</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<h1 id="nova">nova服务</h1>
<h2 id="nova_1">nova服务控制节点</h2>
<blockquote>
<p>在安装和配置Compute服务之前，必须创建<strong>数据库</strong>，<strong>服务凭证</strong>和<strong>API端点</strong>。</p>
</blockquote>
<h4 id="1_3">1. 创建数据库</h4>
<ul>
<li>进入数据库</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1"></a>$<span class="w"> </span>mysql<span class="w"> </span>-uroot<span class="w"> </span>-p
</span></code></pre></div></td></tr></table></div>
<ul>
<li>创建<code>nova_api</code>，<code>nova</code>和<code>nova_cell0</code>数据库：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span>
<span class="normal"><a href="#__codelineno-119-2">2</a></span>
<span class="normal"><a href="#__codelineno-119-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>nova_api<span class="p">;</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>nova<span class="p">;</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>nova_cell0<span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>授予对数据库的访问权限：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-120-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-120-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-120-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-120-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-120-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-120-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-120-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-120-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-120-10">10</a></span>
<span class="normal"><a href="#__codelineno-120-11">11</a></span>
<span class="normal"><a href="#__codelineno-120-12">12</a></span>
<span class="normal"><a href="#__codelineno-120-13">13</a></span>
<span class="normal"><a href="#__codelineno-120-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>nova_api.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NOVA_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>nova_api.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NOVA_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5"></a>
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>nova.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-120-7"><a id="__codelineno-120-7" name="__codelineno-120-7"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NOVA_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-120-8"><a id="__codelineno-120-8" name="__codelineno-120-8"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>nova.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-120-9"><a id="__codelineno-120-9" name="__codelineno-120-9"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NOVA_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-120-10"><a id="__codelineno-120-10" name="__codelineno-120-10"></a>
</span><span id="__span-120-11"><a id="__codelineno-120-11" name="__codelineno-120-11"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>nova_cell0.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-120-12"><a id="__codelineno-120-12" name="__codelineno-120-12"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NOVA_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-120-13"><a id="__codelineno-120-13" name="__codelineno-120-13"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>nova_cell0.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;nova&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-120-14"><a id="__codelineno-120-14" name="__codelineno-120-14"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NOVA_DBPASS&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意：</strong> NOVA_DBPASS使用自己的nova数据库密码</p>
</blockquote>
<ul>
<li>退出数据库</li>
</ul>
<h4 id="2_1">2. 加载管理员权限：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1"></a>$<span class="w"> </span>.<span class="w"> </span>keystone_admin
</span></code></pre></div></td></tr></table></div>
<h4 id="3_2">3. 创建计算服务凭据</h4>
<ul>
<li>创建nova用户：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-122-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-122-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-122-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-122-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-122-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-122-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-122-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-122-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-122-10">10</a></span>
<span class="normal"><a href="#__codelineno-122-11">11</a></span>
<span class="normal"><a href="#__codelineno-122-12">12</a></span>
<span class="normal"><a href="#__codelineno-122-13">13</a></span>
<span class="normal"><a href="#__codelineno-122-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1"></a>$<span class="w">  </span>openstack<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>--domain<span class="w"> </span>default<span class="w"> </span>--password-prompt<span class="w"> </span>nova
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2"></a>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3"></a>User<span class="w"> </span>Password:
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4"></a>Repeat<span class="w"> </span>User<span class="w"> </span>Password:
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5"></a>+---------------------+----------------------------------+
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">               </span><span class="p">|</span><span class="w"> </span>Value<span class="w">               </span><span class="p">|</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7"></a>+---------------------+----------------------------------+
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">           </span><span class="p">|</span><span class="w"> </span>default<span class="w">               </span><span class="p">|</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">            </span><span class="p">|</span><span class="w"> </span>True<span class="w">                </span><span class="p">|</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10"></a><span class="p">|</span><span class="w"> </span>id<span class="w">                </span><span class="p">|</span><span class="w"> </span>8a7dbf5279404537b1c7b86c033620fe<span class="w"> </span><span class="p">|</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11"></a><span class="p">|</span><span class="w"> </span>name<span class="w">               </span><span class="p">|</span><span class="w"> </span>nova<span class="w">                   </span><span class="p">|</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12"></a><span class="p">|</span><span class="w"> </span>options<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                  </span><span class="p">|</span>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                    </span><span class="p">|</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14"></a>+---------------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<ul>
<li>把nova添加到admin中： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>role<span class="w"> </span>add<span class="w"> </span>--project<span class="w"> </span>service<span class="w"> </span>--user<span class="w"> </span>nova<span class="w"> </span>admin
</span></code></pre></div></td></tr></table></div>
<ul>
<li>创建nova服务：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-124-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-124-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-124-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-124-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-124-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-124-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-124-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-124-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-124-10">10</a></span>
<span class="normal"><a href="#__codelineno-124-11">11</a></span>
<span class="normal"><a href="#__codelineno-124-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>nova<span class="w"> </span><span class="se">\</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2"></a><span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;OpenStack Compute&quot;</span><span class="w"> </span>compute
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3"></a>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4"></a>+-------------+----------------------------------+
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                 </span><span class="p">|</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6"></a>+-------------+----------------------------------+
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>OpenStack<span class="w"> </span>Compute<span class="w">           </span><span class="p">|</span>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span>True<span class="w">                    </span><span class="p">|</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9"></a><span class="p">|</span><span class="w"> </span>id<span class="w">       </span><span class="p">|</span><span class="w"> </span>060d59eac51b4594815603d75a00aba2<span class="w"> </span><span class="p">|</span>
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">      </span><span class="p">|</span><span class="w"> </span>nova<span class="w">                    </span><span class="p">|</span>
</span><span id="__span-124-11"><a id="__codelineno-124-11" name="__codelineno-124-11"></a><span class="p">|</span><span class="w"> </span><span class="nb">type</span><span class="w">      </span><span class="p">|</span><span class="w"> </span>compute<span class="w">                  </span><span class="p">|</span>
</span><span id="__span-124-12"><a id="__codelineno-124-12" name="__codelineno-124-12"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<h4 id="4-computer-api">4. 创建Computer API服务端点：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-125-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-125-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-125-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-125-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-125-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-125-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-125-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-125-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-125-10">10</a></span>
<span class="normal"><a href="#__codelineno-125-11">11</a></span>
<span class="normal"><a href="#__codelineno-125-12">12</a></span>
<span class="normal"><a href="#__codelineno-125-13">13</a></span>
<span class="normal"><a href="#__codelineno-125-14">14</a></span>
<span class="normal"><a href="#__codelineno-125-15">15</a></span>
<span class="normal"><a href="#__codelineno-125-16">16</a></span>
<span class="normal"><a href="#__codelineno-125-17">17</a></span>
<span class="normal"><a href="#__codelineno-125-18">18</a></span>
<span class="normal"><a href="#__codelineno-125-19">19</a></span>
<span class="normal"><a href="#__codelineno-125-20">20</a></span>
<span class="normal"><a href="#__codelineno-125-21">21</a></span>
<span class="normal"><a href="#__codelineno-125-22">22</a></span>
<span class="normal"><a href="#__codelineno-125-23">23</a></span>
<span class="normal"><a href="#__codelineno-125-24">24</a></span>
<span class="normal"><a href="#__codelineno-125-25">25</a></span>
<span class="normal"><a href="#__codelineno-125-26">26</a></span>
<span class="normal"><a href="#__codelineno-125-27">27</a></span>
<span class="normal"><a href="#__codelineno-125-28">28</a></span>
<span class="normal"><a href="#__codelineno-125-29">29</a></span>
<span class="normal"><a href="#__codelineno-125-30">30</a></span>
<span class="normal"><a href="#__codelineno-125-31">31</a></span>
<span class="normal"><a href="#__codelineno-125-32">32</a></span>
<span class="normal"><a href="#__codelineno-125-33">33</a></span>
<span class="normal"><a href="#__codelineno-125-34">34</a></span>
<span class="normal"><a href="#__codelineno-125-35">35</a></span>
<span class="normal"><a href="#__codelineno-125-36">36</a></span>
<span class="normal"><a href="#__codelineno-125-37">37</a></span>
<span class="normal"><a href="#__codelineno-125-38">38</a></span>
<span class="normal"><a href="#__codelineno-125-39">39</a></span>
<span class="normal"><a href="#__codelineno-125-40">40</a></span>
<span class="normal"><a href="#__codelineno-125-41">41</a></span>
<span class="normal"><a href="#__codelineno-125-42">42</a></span>
<span class="normal"><a href="#__codelineno-125-43">43</a></span>
<span class="normal"><a href="#__codelineno-125-44">44</a></span>
<span class="normal"><a href="#__codelineno-125-45">45</a></span>
<span class="normal"><a href="#__codelineno-125-46">46</a></span>
<span class="normal"><a href="#__codelineno-125-47">47</a></span>
<span class="normal"><a href="#__codelineno-125-48">48</a></span>
<span class="normal"><a href="#__codelineno-125-49">49</a></span>
<span class="normal"><a href="#__codelineno-125-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2"></a><span class="w">  </span>compute<span class="w"> </span>public<span class="w"> </span>http://controller:8774/v2.1
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3"></a>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                                     </span><span class="p">|</span>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                      </span><span class="p">|</span>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">        </span><span class="p">|</span><span class="w"> </span>3c1caa473bfe4390a11e7177894bcc7b<span class="w">          </span><span class="p">|</span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>public<span class="w">                                    </span><span class="p">|</span>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>060d59eac51b4594815603d75a00aba2<span class="w">          </span><span class="p">|</span>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>nova<span class="w">                                      </span><span class="p">|</span>
</span><span id="__span-125-14"><a id="__codelineno-125-14" name="__codelineno-125-14"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>compute<span class="w">                                   </span><span class="p">|</span>
</span><span id="__span-125-15"><a id="__codelineno-125-15" name="__codelineno-125-15"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:8774/v2.1<span class="w">               </span><span class="p">|</span>
</span><span id="__span-125-16"><a id="__codelineno-125-16" name="__codelineno-125-16"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-17"><a id="__codelineno-125-17" name="__codelineno-125-17"></a>
</span><span id="__span-125-18"><a id="__codelineno-125-18" name="__codelineno-125-18"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-125-19"><a id="__codelineno-125-19" name="__codelineno-125-19"></a><span class="w">  </span>compute<span class="w"> </span>internal<span class="w"> </span>http://controller:8774/v2.1
</span><span id="__span-125-20"><a id="__codelineno-125-20" name="__codelineno-125-20"></a>
</span><span id="__span-125-21"><a id="__codelineno-125-21" name="__codelineno-125-21"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-22"><a id="__codelineno-125-22" name="__codelineno-125-22"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                                     </span><span class="p">|</span>
</span><span id="__span-125-23"><a id="__codelineno-125-23" name="__codelineno-125-23"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-24"><a id="__codelineno-125-24" name="__codelineno-125-24"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                      </span><span class="p">|</span>
</span><span id="__span-125-25"><a id="__codelineno-125-25" name="__codelineno-125-25"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>e3c918de680746a586eac1f2d9bc10ab<span class="w">          </span><span class="p">|</span>
</span><span id="__span-125-26"><a id="__codelineno-125-26" name="__codelineno-125-26"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>internal<span class="w">                                  </span><span class="p">|</span>
</span><span id="__span-125-27"><a id="__codelineno-125-27" name="__codelineno-125-27"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-125-28"><a id="__codelineno-125-28" name="__codelineno-125-28"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-125-29"><a id="__codelineno-125-29" name="__codelineno-125-29"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>060d59eac51b4594815603d75a00aba2<span class="w">          </span><span class="p">|</span>
</span><span id="__span-125-30"><a id="__codelineno-125-30" name="__codelineno-125-30"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>nova<span class="w">                                      </span><span class="p">|</span>
</span><span id="__span-125-31"><a id="__codelineno-125-31" name="__codelineno-125-31"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>compute<span class="w">                                   </span><span class="p">|</span>
</span><span id="__span-125-32"><a id="__codelineno-125-32" name="__codelineno-125-32"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:8774/v2.1<span class="w">               </span><span class="p">|</span>
</span><span id="__span-125-33"><a id="__codelineno-125-33" name="__codelineno-125-33"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-34"><a id="__codelineno-125-34" name="__codelineno-125-34"></a>
</span><span id="__span-125-35"><a id="__codelineno-125-35" name="__codelineno-125-35"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-125-36"><a id="__codelineno-125-36" name="__codelineno-125-36"></a><span class="w">  </span>compute<span class="w"> </span>admin<span class="w"> </span>http://controller:8774/v2.1
</span><span id="__span-125-37"><a id="__codelineno-125-37" name="__codelineno-125-37"></a>
</span><span id="__span-125-38"><a id="__codelineno-125-38" name="__codelineno-125-38"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-39"><a id="__codelineno-125-39" name="__codelineno-125-39"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                                     </span><span class="p">|</span>
</span><span id="__span-125-40"><a id="__codelineno-125-40" name="__codelineno-125-40"></a>+--------------+-------------------------------------------+
</span><span id="__span-125-41"><a id="__codelineno-125-41" name="__codelineno-125-41"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                      </span><span class="p">|</span>
</span><span id="__span-125-42"><a id="__codelineno-125-42" name="__codelineno-125-42"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>38f7af91666a47cfb97b4dc790b94424<span class="w">          </span><span class="p">|</span>
</span><span id="__span-125-43"><a id="__codelineno-125-43" name="__codelineno-125-43"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>admin<span class="w">                                     </span><span class="p">|</span>
</span><span id="__span-125-44"><a id="__codelineno-125-44" name="__codelineno-125-44"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-125-45"><a id="__codelineno-125-45" name="__codelineno-125-45"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-125-46"><a id="__codelineno-125-46" name="__codelineno-125-46"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>060d59eac51b4594815603d75a00aba2<span class="w">          </span><span class="p">|</span>
</span><span id="__span-125-47"><a id="__codelineno-125-47" name="__codelineno-125-47"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>nova<span class="w">                                      </span><span class="p">|</span>
</span><span id="__span-125-48"><a id="__codelineno-125-48" name="__codelineno-125-48"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>compute<span class="w">                                   </span><span class="p">|</span>
</span><span id="__span-125-49"><a id="__codelineno-125-49" name="__codelineno-125-49"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:8774/v2.1<span class="w">               </span><span class="p">|</span>
</span><span id="__span-125-50"><a id="__codelineno-125-50" name="__codelineno-125-50"></a>+--------------+-------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<h4 id="1_4">1. 安装软件包</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">1</a></span>
<span class="normal"><a href="#__codelineno-126-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1"></a>$<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-nova-api<span class="w"> </span>openstack-nova-conductor<span class="w"> </span><span class="se">\</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="w">  </span>openstack-nova-novncproxy<span class="w"> </span>openstack-nova-scheduler
</span></code></pre></div></td></tr></table></div>
<h4 id="2etcnovanovaconf">2.配置<code>/etc/nova/nova.conf</code>文件并完成以下操作:</h4>
<ul>
<li>在<code>[DEFAULT]</code>部分中，仅启用计算和元数据API：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1">1</a></span>
<span class="normal"><a href="#__codelineno-127-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="nv">enabled_apis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>osapi_compute,metadata
</span></code></pre></div></td></tr></table></div>
<ul>
<li>在<code>[api_database]</code>和<code>[database]</code>部分中，配置数据库访问权限：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1">1</a></span>
<span class="normal"><a href="#__codelineno-128-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="o">[</span>api_database<span class="o">]</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://nova:NOVA_DBPASS@controller/nova_api
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NOVA_DBPASS</code>为您为Compute数据库选择的密码。</p>
<ul>
<li>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code>消息队列访问：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="nv">transport_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rabbit://openstack:RABBIT_PASS@controller
</span></code></pre></div></td></tr></table></div>
<p>替换<code>RABBIT_PASS</code>为您在中为<code>openstack</code> 帐户选择的密码<code>RabbitMQ</code>。</p>
<ul>
<li>在<code>[api]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-130-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-130-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-130-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-130-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-130-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-130-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-130-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-130-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-130-10">10</a></span>
<span class="normal"><a href="#__codelineno-130-11">11</a></span>
<span class="normal"><a href="#__codelineno-130-12">12</a></span>
<span class="normal"><a href="#__codelineno-130-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="o">[</span>api<span class="o">]</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3"></a>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5"></a><span class="c1"># ...</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000/v3
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>nova
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NOVA_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NOVA_PASS</code>为您<code>nova</code>在身份服务中为用户选择的密码。</p>
<blockquote>
<p>注意</p>
<p>注释掉或删除此<code>[keystone_authtoken]</code> 部分中的任何其他选项。</p>
</blockquote>
<ul>
<li>在该<code>[DEFAULT]</code>部分中，配置<code>my_ip</code>选项以使用控制器节点的管理接口IP地址：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1">1</a></span>
<span class="normal"><a href="#__codelineno-131-2">2</a></span>
<span class="normal"><a href="#__codelineno-131-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2"></a>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3"></a><span class="nv">my_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">192</span>.168.10.17
</span></code></pre></div></td></tr></table></div>
<ul>
<li>在本<code>[DEFAULT]</code>节中，启用对网络服务的支持：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1">1</a></span>
<span class="normal"><a href="#__codelineno-132-2">2</a></span>
<span class="normal"><a href="#__codelineno-132-3">3</a></span>
<span class="normal"><a href="#__codelineno-132-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2"></a>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3"></a><span class="nv">use_neutron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4"></a><span class="nv">firewall_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>nova.virt.firewall.NoopFirewallDriver
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意：</p>
<p>默认情况下，Compute使用内部防火墙驱动程序。由于网络服务包含防火墙驱动程序，因此必须使用<code>nova.virt.firewall.NoopFirewallDriver</code>防火墙驱动程序禁用计算防火墙驱动 程序。</p>
</blockquote>
<ul>
<li>在该<code>[vnc]</code>部分中，将VNC代理配置为使用控制器节点的管理接口IP地址：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1">1</a></span>
<span class="normal"><a href="#__codelineno-133-2">2</a></span>
<span class="normal"><a href="#__codelineno-133-3">3</a></span>
<span class="normal"><a href="#__codelineno-133-4">4</a></span>
<span class="normal"><a href="#__codelineno-133-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="o">[</span>vnc<span class="o">]</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3"></a><span class="c1"># ...</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4"></a><span class="nv">server_listen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$my_ip</span>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5"></a><span class="nv">server_proxyclient_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$my_ip</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>在该<code>[glance]</code>部分中，配置图像服务API的位置：</li>
</ul>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1">1</a></span>
<span class="normal"><a href="#__codelineno-134-2">2</a></span>
<span class="normal"><a href="#__codelineno-134-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1"></a>[glance]
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2"></a># ...
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3"></a>api_servers = http://controller:9292
</span></code></pre></div></td></tr></table></div>
<ul>
<li>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</li>
</ul>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1">1</a></span>
<span class="normal"><a href="#__codelineno-135-2">2</a></span>
<span class="normal"><a href="#__codelineno-135-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1"></a>[oslo_concurrency]
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2"></a># ...
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3"></a>lock_path = /var/lib/nova/tmp
</span></code></pre></div></td></tr></table></div>
<ul>
<li>在该<code>[placement]</code>部分中，配置对展示位置服务的访问权限：</li>
</ul>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-136-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-136-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-136-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-136-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-136-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-136-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-136-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-136-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-136-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1"></a>[placement]
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2"></a># ...
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3"></a>region_name = RegionOne
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4"></a>project_domain_name = Default
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5"></a>project_name = service
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6"></a>auth_type = password
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7"></a>user_domain_name = Default
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8"></a>auth_url = http://controller:5000/v3
</span><span id="__span-136-9"><a id="__codelineno-136-9" name="__codelineno-136-9"></a>username = placement
</span><span id="__span-136-10"><a id="__codelineno-136-10" name="__codelineno-136-10"></a>password = PLACEMENT_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>PLACEMENT_PASS</code>为您为<code>placement</code>安装<a href="https://docs.openstack.org/placement/stein/install/">Placement</a>时创建的服务用户 选择的密码 。注释掉或删除此<code>[placement]</code>部分中的任何其他选项。</p>
<h4 id="3-nova-api">3. 填充nova-api数据库：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1"></a>$<span class="w">  </span>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;nova-manage api_db sync&quot;</span><span class="w"> </span>nova
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意：</strong></p>
<p>忽略此输出中的所有弃用消息。</p>
</blockquote>
<h4 id="4-cell0">4. 注册cell0数据库</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1"></a>$<span class="w"> </span>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;nova-manage cell_v2 map_cell0&quot;</span><span class="w"> </span>nova
</span></code></pre></div></td></tr></table></div>
<h4 id="5cell1">5.创建cell1单元格：</h4>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1">1</a></span>
<span class="normal"><a href="#__codelineno-139-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1"></a>$ su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2"></a>109e1d4b-536a-40d0-83c6-5f121b82b650
</span></code></pre></div></td></tr></table></div>
<h4 id="6-nova">6. 填充nova数据库：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-140-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1"></a>$<span class="w"> </span>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;nova-manage db sync&quot;</span><span class="w"> </span>nova
</span></code></pre></div></td></tr></table></div>
<h4 id="7-nova-cell0cell1">7. 验证nova cell0和cell1是否正确注册：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-141-1">1</a></span>
<span class="normal"><a href="#__codelineno-141-2">2</a></span>
<span class="normal"><a href="#__codelineno-141-3">3</a></span>
<span class="normal"><a href="#__codelineno-141-4">4</a></span>
<span class="normal"><a href="#__codelineno-141-5">5</a></span>
<span class="normal"><a href="#__codelineno-141-6">6</a></span>
<span class="normal"><a href="#__codelineno-141-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1"></a>$<span class="w"> </span>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;nova-manage cell_v2 list_cells&quot;</span><span class="w"> </span>nova
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2"></a>+-------+--------------------------------------+
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3"></a><span class="p">|</span><span class="w"> </span>Name<span class="w">  </span><span class="p">|</span><span class="w"> </span>UUID<span class="w">                                 </span><span class="p">|</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4"></a>+-------+--------------------------------------+
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5"></a><span class="p">|</span><span class="w"> </span>cell1<span class="w"> </span><span class="p">|</span><span class="w"> </span>109e1d4b-536a-40d0-83c6-5f121b82b650<span class="w"> </span><span class="p">|</span>
</span><span id="__span-141-6"><a id="__codelineno-141-6" name="__codelineno-141-6"></a><span class="p">|</span><span class="w"> </span>cell0<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">00000000</span>-0000-0000-0000-000000000000<span class="w"> </span><span class="p">|</span>
</span><span id="__span-141-7"><a id="__codelineno-141-7" name="__codelineno-141-7"></a>+-------+--------------------------------------+
</span></code></pre></div></td></tr></table></div>
<h2 id="_3">确定安装</h2>
<ul>
<li>启动Compute服务并将其配置为在系统启动时启动：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1">1</a></span>
<span class="normal"><a href="#__codelineno-142-2">2</a></span>
<span class="normal"><a href="#__codelineno-142-3">3</a></span>
<span class="normal"><a href="#__codelineno-142-4">4</a></span>
<span class="normal"><a href="#__codelineno-142-5">5</a></span>
<span class="normal"><a href="#__codelineno-142-6">6</a></span>
<span class="normal"><a href="#__codelineno-142-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>openstack-nova-api.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2"></a><span class="w">  </span>openstack-nova-consoleauth<span class="w"> </span>openstack-nova-scheduler.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="w">  </span>openstack-nova-conductor.service<span class="w"> </span>openstack-nova-novncproxy.service
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4"></a>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>openstack-nova-api.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6"></a><span class="w">  </span>openstack-nova-consoleauth<span class="w"> </span>openstack-nova-scheduler.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7"></a><span class="w">  </span>openstack-nova-conductor.service<span class="w"> </span>openstack-nova-novncproxy.service
</span></code></pre></div></td></tr></table></div>
<h2 id="nova_2">nova服务计算节点</h2>
<ol>
<li>安装软件包：</li>
</ol>
<div class="language-SAS highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-143-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1"></a># yum install openstack-nova-compute
</span></code></pre></div></td></tr></table></div>
<ol>
<li>
<p>编辑<code>/etc/nova/nova.conf</code>文件并完成以下操作：</p>
</li>
<li>
<p>在此<code>[DEFAULT]</code>部分中，仅启用计算和元数据API：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-144-1">1</a></span>
<span class="normal"><a href="#__codelineno-144-2">2</a></span>
<span class="normal"><a href="#__codelineno-144-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1"></a>[DEFAULT]
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2"></a># ...
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3"></a>enabled_apis = osapi_compute,metadata
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code>消息队列访问：</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-145-1">1</a></span>
<span class="normal"><a href="#__codelineno-145-2">2</a></span>
<span class="normal"><a href="#__codelineno-145-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1"></a>[DEFAULT]
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2"></a># ...
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3"></a>transport_url = rabbit://openstack:RABBIT_PASS@controller
</span></code></pre></div></td></tr></table></div>
<p>替换<code>RABBIT_PASS</code>为您在中为<code>openstack</code> 帐户选择的密码<code>RabbitMQ</code>。</p>
</li>
<li>
<p>在<code>[api]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-146-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-146-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-146-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-146-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-146-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-146-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-146-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-146-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-146-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-146-10">10</a></span>
<span class="normal"><a href="#__codelineno-146-11">11</a></span>
<span class="normal"><a href="#__codelineno-146-12">12</a></span>
<span class="normal"><a href="#__codelineno-146-13">13</a></span>
<span class="normal"><a href="#__codelineno-146-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="o">[</span>api<span class="o">]</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2"></a><span class="c1"># ...</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4"></a>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6"></a><span class="c1"># ...</span>
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000/v3
</span><span id="__span-146-8"><a id="__codelineno-146-8" name="__codelineno-146-8"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-146-9"><a id="__codelineno-146-9" name="__codelineno-146-9"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-146-10"><a id="__codelineno-146-10" name="__codelineno-146-10"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-146-11"><a id="__codelineno-146-11" name="__codelineno-146-11"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-146-12"><a id="__codelineno-146-12" name="__codelineno-146-12"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-146-13"><a id="__codelineno-146-13" name="__codelineno-146-13"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>nova
</span><span id="__span-146-14"><a id="__codelineno-146-14" name="__codelineno-146-14"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NOVA_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NOVA_PASS</code>为您<code>nova</code>在身份服务中为用户选择的密码。</p>
<blockquote>
<p><strong>注意</strong></p>
<p>注释掉或删除此<code>[keystone_authtoken]</code> 部分中的任何其他选项。</p>
</blockquote>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>my_ip</code>选项：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-147-1">1</a></span>
<span class="normal"><a href="#__codelineno-147-2">2</a></span>
<span class="normal"><a href="#__codelineno-147-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2"></a><span class="c1"># ...</span>
</span><span id="__span-147-3"><a id="__codelineno-147-3" name="__codelineno-147-3"></a><span class="nv">my_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>MANAGEMENT_INTERFACE_IP_ADDRESS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>MANAGEMENT_INTERFACE_IP_ADDRESS</code>为计算节点上管理网络接口的IP地址。</p>
</li>
<li>
<p>在本<code>[DEFAULT]</code>节中，启用对网络服务的支持：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-1">1</a></span>
<span class="normal"><a href="#__codelineno-148-2">2</a></span>
<span class="normal"><a href="#__codelineno-148-3">3</a></span>
<span class="normal"><a href="#__codelineno-148-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2"></a><span class="c1"># ...</span>
</span><span id="__span-148-3"><a id="__codelineno-148-3" name="__codelineno-148-3"></a><span class="nv">use_neutron</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-148-4"><a id="__codelineno-148-4" name="__codelineno-148-4"></a><span class="nv">firewall_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>nova.virt.firewall.NoopFirewallDriver
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意</p>
<p>默认情况下，Compute使用内部防火墙服务。由于联网包含防火墙服务，因此必须使用<code>nova.virt.firewall.NoopFirewallDriver</code>防火墙驱动程序禁用计算防火墙服务。</p>
</blockquote>
</li>
<li>
<p>在该<code>[vnc]</code>部分中，启用和配置远程控制台访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-149-1">1</a></span>
<span class="normal"><a href="#__codelineno-149-2">2</a></span>
<span class="normal"><a href="#__codelineno-149-3">3</a></span>
<span class="normal"><a href="#__codelineno-149-4">4</a></span>
<span class="normal"><a href="#__codelineno-149-5">5</a></span>
<span class="normal"><a href="#__codelineno-149-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1"></a><span class="o">[</span>vnc<span class="o">]</span>
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2"></a><span class="c1"># ...</span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3"></a><span class="nv">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4"></a><span class="nv">server_listen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>.0.0.0
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5"></a><span class="nv">server_proxyclient_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$my_ip</span>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6"></a><span class="nv">novncproxy_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:6080/vnc_auto.html
</span></code></pre></div></td></tr></table></div>
<p>服务器组件侦听所有IP地址，代理组件侦听所有计算节点的管理接口IP地址。基本URL指示可以使用Web浏览器访问此计算节点上的实例的远程控制台的位置。</p>
<blockquote>
<p>注意</p>
<p>如果用于访问远程控制台的Web浏览器驻留在无法解析<code>controller</code>主机名的主机上，则必须替换 <code>controller</code>为控制器节点的管理接口IP地址。</p>
</blockquote>
</li>
<li>
<p>在该<code>[glance]</code>部分中，配置图像服务API的位置：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-150-1">1</a></span>
<span class="normal"><a href="#__codelineno-150-2">2</a></span>
<span class="normal"><a href="#__codelineno-150-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="o">[</span>glance<span class="o">]</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2"></a><span class="c1"># ...</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3"></a><span class="nv">api_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:9292
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-151-1">1</a></span>
<span class="normal"><a href="#__codelineno-151-2">2</a></span>
<span class="normal"><a href="#__codelineno-151-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1"></a><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2"></a><span class="c1"># ...</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3"></a><span class="nv">lock_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/lib/nova/tmp
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在该<code>[placement]</code>部分中，配置Placement API：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-152-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-152-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-152-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-152-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-152-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-152-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-152-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-152-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-152-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-152-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1"></a><span class="o">[</span>placement<span class="o">]</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2"></a><span class="c1"># ...</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3"></a><span class="nv">region_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>RegionOne
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>Default
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000/v3
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>placement
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>PLACEMENT_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>PLACEMENT_PASS</code>为您<code>placement</code>在身份服务中为用户选择的密码 。注释掉该<code>[placement]</code>部分中的所有其他选项。</p>
</li>
</ol>
<p>## 最终确定安装</p>
<ol>
<li>
<p>确定您的计算节点是否支持虚拟机的硬件加速：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-153-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1"></a>$<span class="w"> </span>egrep<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;(vmx|svm)&#39;</span><span class="w"> </span>/proc/cpuinfo
</span></code></pre></div></td></tr></table></div>
<p>如果此命令返回值，则您的计算节点支持硬件加速，通常不需要其他配置。<code>one or greater</code></p>
<p>如果此命令返回值<code>zero</code>，则您的计算节点不支持硬件加速，并且您必须配置<code>libvirt</code>为使用QEMU而不是KVM。</p>
</li>
<li>
<p>编辑文件中的<code>[libvirt]</code>部分，<code>/etc/nova/nova.conf</code>如下所示：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-154-1">1</a></span>
<span class="normal"><a href="#__codelineno-154-2">2</a></span>
<span class="normal"><a href="#__codelineno-154-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1"></a><span class="o">[</span>libvirt<span class="o">]</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2"></a><span class="c1"># ...</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3"></a><span class="nv">virt_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>qemu
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>启动Compute服务及其相关性，并将其配置为在系统启动时自动启动：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-155-1">1</a></span>
<span class="normal"><a href="#__codelineno-155-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>libvirtd.service<span class="w"> </span>openstack-nova-compute.service
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>libvirtd.service<span class="w"> </span>openstack-nova-compute.service<span class="w"> </span>
</span></code></pre></div></td></tr></table></div>
</li>
</ol>
<blockquote>
<p>注意</p>
<p>如果<code>nova-compute</code>服务无法启动，请检查 <code>/var/log/nova/nova-compute.log</code>。该错误消息可能表明控制器节点上的防火墙阻止访问端口5672。将防火墙配置为打开控制器节点上的端口5672并重新启动 计算节点上的服务。<code>AMQP server on controller:5672 is unreachable``nova-compute</code></p>
</blockquote>
<p>## 将计算节点添加到单元数据库中</p>
<blockquote>
<p><strong>重要</strong></p>
<p>在<strong>控制节点</strong>上运行以下命令。</p>
</blockquote>
<ol>
<li>
<p>获取管理员凭据以启用仅管理员的CLI命令，然后确认数据库中有计算主机：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-156-1">1</a></span>
<span class="normal"><a href="#__codelineno-156-2">2</a></span>
<span class="normal"><a href="#__codelineno-156-3">3</a></span>
<span class="normal"><a href="#__codelineno-156-4">4</a></span>
<span class="normal"><a href="#__codelineno-156-5">5</a></span>
<span class="normal"><a href="#__codelineno-156-6">6</a></span>
<span class="normal"><a href="#__codelineno-156-7">7</a></span>
<span class="normal"><a href="#__codelineno-156-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1"></a>$<span class="w"> </span>.<span class="w"> </span>admin-openrc
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2"></a>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3"></a>$<span class="w"> </span>openstack<span class="w"> </span>compute<span class="w"> </span>service<span class="w"> </span>list<span class="w"> </span>--service<span class="w"> </span>nova-compute
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4"></a>+----+-------+--------------+------+-------+---------+----------------------------+
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5"></a><span class="p">|</span><span class="w"> </span>ID<span class="w"> </span><span class="p">|</span><span class="w"> </span>Host<span class="w">  </span><span class="p">|</span><span class="w"> </span>Binary<span class="w">       </span><span class="p">|</span><span class="w"> </span>Zone<span class="w"> </span><span class="p">|</span><span class="w"> </span>State<span class="w"> </span><span class="p">|</span><span class="w"> </span>Status<span class="w">  </span><span class="p">|</span><span class="w"> </span>Updated<span class="w"> </span>At<span class="w">                 </span><span class="p">|</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6"></a>+----+-------+--------------+------+-------+---------+----------------------------+
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7"></a><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>node1<span class="w"> </span><span class="p">|</span><span class="w"> </span>nova-compute<span class="w"> </span><span class="p">|</span><span class="w"> </span>nova<span class="w"> </span><span class="p">|</span><span class="w"> </span>up<span class="w">    </span><span class="p">|</span><span class="w"> </span>enabled<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">2017</span>-04-14T15:30:44.000000<span class="w"> </span><span class="p">|</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8"></a>+----+-------+--------------+------+-------+---------+----------------------------+
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>发现计算主机：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-157-1">1</a></span>
<span class="normal"><a href="#__codelineno-157-2">2</a></span>
<span class="normal"><a href="#__codelineno-157-3">3</a></span>
<span class="normal"><a href="#__codelineno-157-4">4</a></span>
<span class="normal"><a href="#__codelineno-157-5">5</a></span>
<span class="normal"><a href="#__codelineno-157-6">6</a></span>
<span class="normal"><a href="#__codelineno-157-7">7</a></span>
<span class="normal"><a href="#__codelineno-157-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1"></a>$<span class="w"> </span>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;nova-manage cell_v2 discover_hosts --verbose&quot;</span><span class="w"> </span>nova
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2"></a>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3"></a>Found<span class="w"> </span><span class="m">2</span><span class="w"> </span>cell<span class="w"> </span>mappings.
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4"></a>Skipping<span class="w"> </span>cell0<span class="w"> </span>since<span class="w"> </span>it<span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>contain<span class="w"> </span>hosts.
</span><span id="__span-157-5"><a id="__codelineno-157-5" name="__codelineno-157-5"></a>Getting<span class="w"> </span>compute<span class="w"> </span>nodes<span class="w"> </span>from<span class="w"> </span>cell<span class="w"> </span><span class="s1">&#39;cell1&#39;</span>:<span class="w"> </span>ad5a5985-a719-4567-98d8-8d148aaae4bc
</span><span id="__span-157-6"><a id="__codelineno-157-6" name="__codelineno-157-6"></a>Found<span class="w"> </span><span class="m">1</span><span class="w"> </span>computes<span class="w"> </span><span class="k">in</span><span class="w"> </span>cell:<span class="w"> </span>ad5a5985-a719-4567-98d8-8d148aaae4bc
</span><span id="__span-157-7"><a id="__codelineno-157-7" name="__codelineno-157-7"></a>Checking<span class="w"> </span>host<span class="w"> </span>mapping<span class="w"> </span><span class="k">for</span><span class="w"> </span>compute<span class="w"> </span>host<span class="w"> </span><span class="s1">&#39;compute&#39;</span>:<span class="w"> </span>fe58ddc1-1d65-4f87-9456-bc040dc106b3
</span><span id="__span-157-8"><a id="__codelineno-157-8" name="__codelineno-157-8"></a>Creating<span class="w"> </span>host<span class="w"> </span>mapping<span class="w"> </span><span class="k">for</span><span class="w"> </span>compute<span class="w"> </span>host<span class="w"> </span><span class="s1">&#39;compute&#39;</span>:<span class="w"> </span>fe58ddc1-1d65-4f87-9456-bc040dc106b3
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意</p>
<p>添加新的计算节点时，必须在控制节点上运行以注册这些新的计算节点。另外，您可以在中设置适当的时间间隔 ：</p>
<p><code>nova-manage cell_v2 discover_hosts``/etc/nova/nova.conf</code></p>
</blockquote>
<ul>
<li>
<p>编辑<code>/etc/nova/nova.conf</code></p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-158-1">1</a></span>
<span class="normal"><a href="#__codelineno-158-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1"></a><span class="o">[</span>scheduler<span class="o">]</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2"></a><span class="nv">discover_hosts_in_cells_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
</li>
</ol>
<h2 id="nova_3">验证计算nova服务的运行</h2>
<blockquote>
<p><strong>注意：</strong></p>
<p>在<strong>控制节点</strong>上执行这些命令</p>
</blockquote>
<ol>
<li>来源<code>admin</code>凭据来访问仅管理员CLI命令：</li>
</ol>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-159-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1"></a>$ . admin-openrc
</span></code></pre></div></td></tr></table></div>
<ol>
<li>列出服务组件以验证每个进程是否成功启动和注册：</li>
</ol>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-160-1">1</a></span>
<span class="normal"><a href="#__codelineno-160-2">2</a></span>
<span class="normal"><a href="#__codelineno-160-3">3</a></span>
<span class="normal"><a href="#__codelineno-160-4">4</a></span>
<span class="normal"><a href="#__codelineno-160-5">5</a></span>
<span class="normal"><a href="#__codelineno-160-6">6</a></span>
<span class="normal"><a href="#__codelineno-160-7">7</a></span>
<span class="normal"><a href="#__codelineno-160-8">8</a></span>
<span class="normal"><a href="#__codelineno-160-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1"></a>$ openstack compute service list
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2"></a>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3"></a>+----+--------------------+------------+----------+---------+-------+----------------------------+
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4"></a>| Id | Binary             | Host       | Zone     | Status  | State | Updated At                 |
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5"></a>+----+--------------------+------------+----------+---------+-------+----------------------------+
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6"></a>|  1 | nova-scheduler     | controller | internal | enabled | up    | 2016-02-09T23:11:15.000000 |
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7"></a>|  2 | nova-conductor     | controller | internal | enabled | up    | 2016-02-09T23:11:16.000000 |
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8"></a>|  3 | nova-compute       | compute1   | nova     | enabled | up    | 2016-02-09T23:11:20.000000 |
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9"></a>+----+--------------------+------------+----------+---------+-------+----------------------------+
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意：</strong></p>
<p>此输出应指示在控制器节点上启用的两个服务组件和在计算节点上启用的一个服务组件。</p>
</blockquote>
<ol>
<li>列出身份服务中的API端点以验证与身份服务的连接性：</li>
</ol>
<blockquote>
<p><strong>注意：</strong></p>
<p>以下端点列表可能会有所不同，具体取决于OpenStack组件的安装。</p>
</blockquote>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-161-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-161-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-161-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-161-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-161-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-161-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-161-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-161-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-161-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-161-10">10</a></span>
<span class="normal"><a href="#__codelineno-161-11">11</a></span>
<span class="normal"><a href="#__codelineno-161-12">12</a></span>
<span class="normal"><a href="#__codelineno-161-13">13</a></span>
<span class="normal"><a href="#__codelineno-161-14">14</a></span>
<span class="normal"><a href="#__codelineno-161-15">15</a></span>
<span class="normal"><a href="#__codelineno-161-16">16</a></span>
<span class="normal"><a href="#__codelineno-161-17">17</a></span>
<span class="normal"><a href="#__codelineno-161-18">18</a></span>
<span class="normal"><a href="#__codelineno-161-19">19</a></span>
<span class="normal"><a href="#__codelineno-161-20">20</a></span>
<span class="normal"><a href="#__codelineno-161-21">21</a></span>
<span class="normal"><a href="#__codelineno-161-22">22</a></span>
<span class="normal"><a href="#__codelineno-161-23">23</a></span>
<span class="normal"><a href="#__codelineno-161-24">24</a></span>
<span class="normal"><a href="#__codelineno-161-25">25</a></span>
<span class="normal"><a href="#__codelineno-161-26">26</a></span>
<span class="normal"><a href="#__codelineno-161-27">27</a></span>
<span class="normal"><a href="#__codelineno-161-28">28</a></span>
<span class="normal"><a href="#__codelineno-161-29">29</a></span>
<span class="normal"><a href="#__codelineno-161-30">30</a></span>
<span class="normal"><a href="#__codelineno-161-31">31</a></span>
<span class="normal"><a href="#__codelineno-161-32">32</a></span>
<span class="normal"><a href="#__codelineno-161-33">33</a></span>
<span class="normal"><a href="#__codelineno-161-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>catalog<span class="w"> </span>list
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2"></a>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3"></a>+-----------+-----------+-----------------------------------------+
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4"></a><span class="p">|</span><span class="w"> </span>Name<span class="w">      </span><span class="p">|</span><span class="w"> </span>Type<span class="w">      </span><span class="p">|</span><span class="w"> </span>Endpoints<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5"></a>+-----------+-----------+-----------------------------------------+
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6"></a><span class="p">|</span><span class="w"> </span>keystone<span class="w">  </span><span class="p">|</span><span class="w"> </span>identity<span class="w">  </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>public:<span class="w"> </span>http://controller:5000/v3/<span class="w">    </span><span class="p">|</span>
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>internal:<span class="w"> </span>http://controller:5000/v3/<span class="w">  </span><span class="p">|</span>
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-11"><a id="__codelineno-161-11" name="__codelineno-161-11"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>admin:<span class="w"> </span>http://controller:5000/v3/<span class="w">     </span><span class="p">|</span>
</span><span id="__span-161-12"><a id="__codelineno-161-12" name="__codelineno-161-12"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">                                         </span><span class="p">|</span>
</span><span id="__span-161-13"><a id="__codelineno-161-13" name="__codelineno-161-13"></a><span class="p">|</span><span class="w"> </span>glance<span class="w">    </span><span class="p">|</span><span class="w"> </span>image<span class="w">     </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-14"><a id="__codelineno-161-14" name="__codelineno-161-14"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>admin:<span class="w"> </span>http://controller:9292<span class="w">         </span><span class="p">|</span>
</span><span id="__span-161-15"><a id="__codelineno-161-15" name="__codelineno-161-15"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-16"><a id="__codelineno-161-16" name="__codelineno-161-16"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>public:<span class="w"> </span>http://controller:9292<span class="w">        </span><span class="p">|</span>
</span><span id="__span-161-17"><a id="__codelineno-161-17" name="__codelineno-161-17"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-18"><a id="__codelineno-161-18" name="__codelineno-161-18"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>internal:<span class="w"> </span>http://controller:9292<span class="w">      </span><span class="p">|</span>
</span><span id="__span-161-19"><a id="__codelineno-161-19" name="__codelineno-161-19"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">                                         </span><span class="p">|</span>
</span><span id="__span-161-20"><a id="__codelineno-161-20" name="__codelineno-161-20"></a><span class="p">|</span><span class="w"> </span>nova<span class="w">      </span><span class="p">|</span><span class="w"> </span>compute<span class="w">   </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-21"><a id="__codelineno-161-21" name="__codelineno-161-21"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>admin:<span class="w"> </span>http://controller:8774/v2.1<span class="w">    </span><span class="p">|</span>
</span><span id="__span-161-22"><a id="__codelineno-161-22" name="__codelineno-161-22"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-23"><a id="__codelineno-161-23" name="__codelineno-161-23"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>internal:<span class="w"> </span>http://controller:8774/v2.1<span class="w"> </span><span class="p">|</span>
</span><span id="__span-161-24"><a id="__codelineno-161-24" name="__codelineno-161-24"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-25"><a id="__codelineno-161-25" name="__codelineno-161-25"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>public:<span class="w"> </span>http://controller:8774/v2.1<span class="w">   </span><span class="p">|</span>
</span><span id="__span-161-26"><a id="__codelineno-161-26" name="__codelineno-161-26"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">                                         </span><span class="p">|</span>
</span><span id="__span-161-27"><a id="__codelineno-161-27" name="__codelineno-161-27"></a><span class="p">|</span><span class="w"> </span>placement<span class="w"> </span><span class="p">|</span><span class="w"> </span>placement<span class="w"> </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-28"><a id="__codelineno-161-28" name="__codelineno-161-28"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>public:<span class="w"> </span>http://controller:8778<span class="w">        </span><span class="p">|</span>
</span><span id="__span-161-29"><a id="__codelineno-161-29" name="__codelineno-161-29"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-30"><a id="__codelineno-161-30" name="__codelineno-161-30"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>admin:<span class="w"> </span>http://controller:8778<span class="w">         </span><span class="p">|</span>
</span><span id="__span-161-31"><a id="__codelineno-161-31" name="__codelineno-161-31"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-161-32"><a id="__codelineno-161-32" name="__codelineno-161-32"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">   </span>internal:<span class="w"> </span>http://controller:8778<span class="w">      </span><span class="p">|</span>
</span><span id="__span-161-33"><a id="__codelineno-161-33" name="__codelineno-161-33"></a><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">           </span><span class="p">|</span><span class="w">                                         </span><span class="p">|</span>
</span><span id="__span-161-34"><a id="__codelineno-161-34" name="__codelineno-161-34"></a>+-----------+-----------+-----------------------------------------+
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意：</strong></p>
<p>忽略此输出中的任何警告。</p>
</blockquote>
<ol>
<li>列出图像服务中的图像以验证与图像服务的连接性：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-162-1">1</a></span>
<span class="normal"><a href="#__codelineno-162-2">2</a></span>
<span class="normal"><a href="#__codelineno-162-3">3</a></span>
<span class="normal"><a href="#__codelineno-162-4">4</a></span>
<span class="normal"><a href="#__codelineno-162-5">5</a></span>
<span class="normal"><a href="#__codelineno-162-6">6</a></span>
<span class="normal"><a href="#__codelineno-162-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>image<span class="w"> </span>list
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2"></a>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3"></a>+--------------------------------------+-------------+-------------+
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4"></a><span class="p">|</span><span class="w"> </span>ID<span class="w">                                   </span><span class="p">|</span><span class="w"> </span>Name<span class="w">        </span><span class="p">|</span><span class="w"> </span>Status<span class="w">      </span><span class="p">|</span>
</span><span id="__span-162-5"><a id="__codelineno-162-5" name="__codelineno-162-5"></a>+--------------------------------------+-------------+-------------+
</span><span id="__span-162-6"><a id="__codelineno-162-6" name="__codelineno-162-6"></a><span class="p">|</span><span class="w"> </span>9a76d9f9-9620-4f2e-8c69-6c5691fae163<span class="w"> </span><span class="p">|</span><span class="w"> </span>cirros<span class="w">      </span><span class="p">|</span><span class="w"> </span>active<span class="w">      </span><span class="p">|</span>
</span><span id="__span-162-7"><a id="__codelineno-162-7" name="__codelineno-162-7"></a>+--------------------------------------+-------------+-------------+
</span></code></pre></div></td></tr></table></div>
<ol>
<li>检查单元格和展示位置API是否正常运行，以及其他必要的前提条件是否到位：</li>
</ol>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-163-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-163-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-163-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-163-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-163-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-163-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-163-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-163-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-163-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-163-10">10</a></span>
<span class="normal"><a href="#__codelineno-163-11">11</a></span>
<span class="normal"><a href="#__codelineno-163-12">12</a></span>
<span class="normal"><a href="#__codelineno-163-13">13</a></span>
<span class="normal"><a href="#__codelineno-163-14">14</a></span>
<span class="normal"><a href="#__codelineno-163-15">15</a></span>
<span class="normal"><a href="#__codelineno-163-16">16</a></span>
<span class="normal"><a href="#__codelineno-163-17">17</a></span>
<span class="normal"><a href="#__codelineno-163-18">18</a></span>
<span class="normal"><a href="#__codelineno-163-19">19</a></span>
<span class="normal"><a href="#__codelineno-163-20">20</a></span>
<span class="normal"><a href="#__codelineno-163-21">21</a></span>
<span class="normal"><a href="#__codelineno-163-22">22</a></span>
<span class="normal"><a href="#__codelineno-163-23">23</a></span>
<span class="normal"><a href="#__codelineno-163-24">24</a></span>
<span class="normal"><a href="#__codelineno-163-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1"></a>$ nova-status upgrade check
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2"></a>
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3"></a>+--------------------------------------------------------------------+
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4"></a>| Upgrade Check Results                                              |
</span><span id="__span-163-5"><a id="__codelineno-163-5" name="__codelineno-163-5"></a>+--------------------------------------------------------------------+
</span><span id="__span-163-6"><a id="__codelineno-163-6" name="__codelineno-163-6"></a>| Check: Cells v2                                                    |
</span><span id="__span-163-7"><a id="__codelineno-163-7" name="__codelineno-163-7"></a>| Result: Success                                                    |
</span><span id="__span-163-8"><a id="__codelineno-163-8" name="__codelineno-163-8"></a>| Details: None                                                      |
</span><span id="__span-163-9"><a id="__codelineno-163-9" name="__codelineno-163-9"></a>+--------------------------------------------------------------------+
</span><span id="__span-163-10"><a id="__codelineno-163-10" name="__codelineno-163-10"></a>| Check: Placement API                                               |
</span><span id="__span-163-11"><a id="__codelineno-163-11" name="__codelineno-163-11"></a>| Result: Success                                                    |
</span><span id="__span-163-12"><a id="__codelineno-163-12" name="__codelineno-163-12"></a>| Details: None                                                      |
</span><span id="__span-163-13"><a id="__codelineno-163-13" name="__codelineno-163-13"></a>+--------------------------------------------------------------------+
</span><span id="__span-163-14"><a id="__codelineno-163-14" name="__codelineno-163-14"></a>| Check: Ironic Flavor Migration                                     |
</span><span id="__span-163-15"><a id="__codelineno-163-15" name="__codelineno-163-15"></a>| Result: Success                                                    |
</span><span id="__span-163-16"><a id="__codelineno-163-16" name="__codelineno-163-16"></a>| Details: None                                                      |
</span><span id="__span-163-17"><a id="__codelineno-163-17" name="__codelineno-163-17"></a>+--------------------------------------------------------------------+
</span><span id="__span-163-18"><a id="__codelineno-163-18" name="__codelineno-163-18"></a>| Check: Request Spec Migration                                      |
</span><span id="__span-163-19"><a id="__codelineno-163-19" name="__codelineno-163-19"></a>| Result: Success                                                    |
</span><span id="__span-163-20"><a id="__codelineno-163-20" name="__codelineno-163-20"></a>| Details: None                                                      |
</span><span id="__span-163-21"><a id="__codelineno-163-21" name="__codelineno-163-21"></a>+--------------------------------------------------------------------+
</span><span id="__span-163-22"><a id="__codelineno-163-22" name="__codelineno-163-22"></a>| Check: Console Auths                                               |
</span><span id="__span-163-23"><a id="__codelineno-163-23" name="__codelineno-163-23"></a>| Result: Success                                                    |
</span><span id="__span-163-24"><a id="__codelineno-163-24" name="__codelineno-163-24"></a>| Details: None                                                      |
</span><span id="__span-163-25"><a id="__codelineno-163-25" name="__codelineno-163-25"></a>+--------------------------------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意：</strong></p>
<p><strong>如果<code>nova-status upgrade check</code>出现403错误</strong>则执行以下操作可解决：</p>
</blockquote>
<ul>
<li>
<p>修改配置文件<code>/etc/httpd/conf.d/00-nova-placement-api.conf</code>并重启`httpd</p>
</li>
<li>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-164-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-164-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-164-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-164-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-164-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-164-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-164-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-164-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-164-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-164-10">10</a></span>
<span class="normal"><a href="#__codelineno-164-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1"></a>&lt;Directory /usr/bin&gt;
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2"></a>    &lt;IfVersion &gt;= 2.4&gt;
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3"></a>       Require all granted
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4"></a>    &lt;/IfVersion&gt;
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5"></a>    &lt;IfVersion &lt; 2.4&gt;
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6"></a>       Order allow,deny
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7"></a>       Allow from all
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8"></a>    &lt;/IfVersion&gt;
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9"></a> &lt;/Directory&gt;
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10"></a>
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11"></a># 重启
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-165-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1"></a> systemctl restart httpd
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h1 id="neutron">Neutron服务配置</h1>
<h2 id="_4">控制节点</h2>
<h4 id="1_5">1.创建数据库</h4>
<ul>
<li>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-166-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1"></a>$<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</span></code></pre></div></td></tr></table></div>
<ul>
<li>创建<code>neutron</code>数据库： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-167-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span><span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>neutron<span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>授予对<code>neutron</code>数据库的适当访问权限，<code>NEUTRON_DBPASS</code>并用合适的密码代替 ： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-168-1">1</a></span>
<span class="normal"><a href="#__codelineno-168-2">2</a></span>
<span class="normal"><a href="#__codelineno-168-3">3</a></span>
<span class="normal"><a href="#__codelineno-168-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>neutron.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;neutron&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NEUTRON_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-168-3"><a id="__codelineno-168-3" name="__codelineno-168-3"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>neutron.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;neutron&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-168-4"><a id="__codelineno-168-4" name="__codelineno-168-4"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;NEUTRON_DBPASS&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>退出数据库访问客户端。 </li>
</ul>
<h4 id="2-admincli_1">2. 来源<code>admin</code>凭据来访问仅管理员CLI命令：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-169-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1"></a>$<span class="w"> </span>.<span class="w"> </span>admin-openrc
</span></code></pre></div></td></tr></table></div>
<h4 id="3_3">3. 要创建服务凭证，请完成以下步骤</h4>
<ul>
<li>创建<code>neutron</code>用户： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-170-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-170-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-170-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-170-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-170-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-170-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-170-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-170-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-170-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-170-10">10</a></span>
<span class="normal"><a href="#__codelineno-170-11">11</a></span>
<span class="normal"><a href="#__codelineno-170-12">12</a></span>
<span class="normal"><a href="#__codelineno-170-13">13</a></span>
<span class="normal"><a href="#__codelineno-170-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>--domain<span class="w"> </span>default<span class="w"> </span>--password-prompt<span class="w"> </span>neutron
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2"></a>
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3"></a>User<span class="w"> </span>Password:
</span><span id="__span-170-4"><a id="__codelineno-170-4" name="__codelineno-170-4"></a>Repeat<span class="w"> </span>User<span class="w"> </span>Password:
</span><span id="__span-170-5"><a id="__codelineno-170-5" name="__codelineno-170-5"></a>+---------------------+----------------------------------+
</span><span id="__span-170-6"><a id="__codelineno-170-6" name="__codelineno-170-6"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">          </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-170-7"><a id="__codelineno-170-7" name="__codelineno-170-7"></a>+---------------------+----------------------------------+
</span><span id="__span-170-8"><a id="__codelineno-170-8" name="__codelineno-170-8"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">        </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-170-9"><a id="__codelineno-170-9" name="__codelineno-170-9"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">         </span><span class="p">|</span><span class="w"> </span>True<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-170-10"><a id="__codelineno-170-10" name="__codelineno-170-10"></a><span class="p">|</span><span class="w"> </span>id<span class="w">            </span><span class="p">|</span><span class="w"> </span>fdb0f541e28141719b6a43c8944bf1fb<span class="w">          </span><span class="p">|</span>
</span><span id="__span-170-11"><a id="__codelineno-170-11" name="__codelineno-170-11"></a><span class="p">|</span><span class="w"> </span>name<span class="w">           </span><span class="p">|</span><span class="w"> </span>neutron<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-170-12"><a id="__codelineno-170-12" name="__codelineno-170-12"></a><span class="p">|</span><span class="w"> </span>options<span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                             </span><span class="p">|</span>
</span><span id="__span-170-13"><a id="__codelineno-170-13" name="__codelineno-170-13"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-170-14"><a id="__codelineno-170-14" name="__codelineno-170-14"></a>+---------------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<ul>
<li><code>admin</code>向<code>neutron</code>用户添加角色：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-171-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>role<span class="w"> </span>add<span class="w"> </span>--project<span class="w"> </span>service<span class="w"> </span>--user<span class="w"> </span>neutron<span class="w"> </span>admin
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意</strong>:该命令不提供任何输出。</p>
</blockquote>
<ul>
<li>创建<code>neutron</code>服务实体： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-172-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-172-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-172-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-172-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-172-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-172-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-172-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-172-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-172-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-172-10">10</a></span>
<span class="normal"><a href="#__codelineno-172-11">11</a></span>
<span class="normal"><a href="#__codelineno-172-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1"></a>openstack<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>neutron<span class="w"> </span><span class="se">\</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2"></a><span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;OpenStack Networking&quot;</span><span class="w"> </span>network
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3"></a>
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4"></a>+-------------+----------------------------------+
</span><span id="__span-172-5"><a id="__codelineno-172-5" name="__codelineno-172-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-172-6"><a id="__codelineno-172-6" name="__codelineno-172-6"></a>+-------------+----------------------------------+
</span><span id="__span-172-7"><a id="__codelineno-172-7" name="__codelineno-172-7"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>OpenStack<span class="w"> </span>Networking<span class="w">                 </span><span class="p">|</span>
</span><span id="__span-172-8"><a id="__codelineno-172-8" name="__codelineno-172-8"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span>True<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-172-9"><a id="__codelineno-172-9" name="__codelineno-172-9"></a><span class="p">|</span><span class="w"> </span>id<span class="w">       </span><span class="p">|</span><span class="w"> </span>f71529314dab4a4d8eca427e701d209e<span class="w">         </span><span class="p">|</span>
</span><span id="__span-172-10"><a id="__codelineno-172-10" name="__codelineno-172-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">      </span><span class="p">|</span><span class="w"> </span>neutron<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-172-11"><a id="__codelineno-172-11" name="__codelineno-172-11"></a><span class="p">|</span><span class="w"> </span><span class="nb">type</span><span class="w">      </span><span class="p">|</span><span class="w"> </span>network<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-172-12"><a id="__codelineno-172-12" name="__codelineno-172-12"></a>+-------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<h4 id="4-api_1">4. 创建网络服务API端点：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-173-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-173-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-173-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-173-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-173-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-173-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-173-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-173-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-173-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-173-10">10</a></span>
<span class="normal"><a href="#__codelineno-173-11">11</a></span>
<span class="normal"><a href="#__codelineno-173-12">12</a></span>
<span class="normal"><a href="#__codelineno-173-13">13</a></span>
<span class="normal"><a href="#__codelineno-173-14">14</a></span>
<span class="normal"><a href="#__codelineno-173-15">15</a></span>
<span class="normal"><a href="#__codelineno-173-16">16</a></span>
<span class="normal"><a href="#__codelineno-173-17">17</a></span>
<span class="normal"><a href="#__codelineno-173-18">18</a></span>
<span class="normal"><a href="#__codelineno-173-19">19</a></span>
<span class="normal"><a href="#__codelineno-173-20">20</a></span>
<span class="normal"><a href="#__codelineno-173-21">21</a></span>
<span class="normal"><a href="#__codelineno-173-22">22</a></span>
<span class="normal"><a href="#__codelineno-173-23">23</a></span>
<span class="normal"><a href="#__codelineno-173-24">24</a></span>
<span class="normal"><a href="#__codelineno-173-25">25</a></span>
<span class="normal"><a href="#__codelineno-173-26">26</a></span>
<span class="normal"><a href="#__codelineno-173-27">27</a></span>
<span class="normal"><a href="#__codelineno-173-28">28</a></span>
<span class="normal"><a href="#__codelineno-173-29">29</a></span>
<span class="normal"><a href="#__codelineno-173-30">30</a></span>
<span class="normal"><a href="#__codelineno-173-31">31</a></span>
<span class="normal"><a href="#__codelineno-173-32">32</a></span>
<span class="normal"><a href="#__codelineno-173-33">33</a></span>
<span class="normal"><a href="#__codelineno-173-34">34</a></span>
<span class="normal"><a href="#__codelineno-173-35">35</a></span>
<span class="normal"><a href="#__codelineno-173-36">36</a></span>
<span class="normal"><a href="#__codelineno-173-37">37</a></span>
<span class="normal"><a href="#__codelineno-173-38">38</a></span>
<span class="normal"><a href="#__codelineno-173-39">39</a></span>
<span class="normal"><a href="#__codelineno-173-40">40</a></span>
<span class="normal"><a href="#__codelineno-173-41">41</a></span>
<span class="normal"><a href="#__codelineno-173-42">42</a></span>
<span class="normal"><a href="#__codelineno-173-43">43</a></span>
<span class="normal"><a href="#__codelineno-173-44">44</a></span>
<span class="normal"><a href="#__codelineno-173-45">45</a></span>
<span class="normal"><a href="#__codelineno-173-46">46</a></span>
<span class="normal"><a href="#__codelineno-173-47">47</a></span>
<span class="normal"><a href="#__codelineno-173-48">48</a></span>
<span class="normal"><a href="#__codelineno-173-49">49</a></span>
<span class="normal"><a href="#__codelineno-173-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2"></a><span class="w">  </span>network<span class="w"> </span>public<span class="w"> </span>http://controller:9696
</span><span id="__span-173-3"><a id="__codelineno-173-3" name="__codelineno-173-3"></a>
</span><span id="__span-173-4"><a id="__codelineno-173-4" name="__codelineno-173-4"></a>+--------------+----------------------------------+
</span><span id="__span-173-5"><a id="__codelineno-173-5" name="__codelineno-173-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-173-6"><a id="__codelineno-173-6" name="__codelineno-173-6"></a>+--------------+----------------------------------+
</span><span id="__span-173-7"><a id="__codelineno-173-7" name="__codelineno-173-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-173-8"><a id="__codelineno-173-8" name="__codelineno-173-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>85d80a6d02fc4b7683f611d7fc1493a3<span class="w"> </span><span class="p">|</span>
</span><span id="__span-173-9"><a id="__codelineno-173-9" name="__codelineno-173-9"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>public<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-10"><a id="__codelineno-173-10" name="__codelineno-173-10"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                       </span><span class="p">|</span>
</span><span id="__span-173-11"><a id="__codelineno-173-11" name="__codelineno-173-11"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-173-12"><a id="__codelineno-173-12" name="__codelineno-173-12"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>f71529314dab4a4d8eca427e701d209e<span class="w"> </span><span class="p">|</span>
</span><span id="__span-173-13"><a id="__codelineno-173-13" name="__codelineno-173-13"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>neutron<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-14"><a id="__codelineno-173-14" name="__codelineno-173-14"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>network<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-15"><a id="__codelineno-173-15" name="__codelineno-173-15"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:9696<span class="w">             </span><span class="p">|</span>
</span><span id="__span-173-16"><a id="__codelineno-173-16" name="__codelineno-173-16"></a>+--------------+----------------------------------+
</span><span id="__span-173-17"><a id="__codelineno-173-17" name="__codelineno-173-17"></a>
</span><span id="__span-173-18"><a id="__codelineno-173-18" name="__codelineno-173-18"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-173-19"><a id="__codelineno-173-19" name="__codelineno-173-19"></a><span class="w">  </span>network<span class="w"> </span>internal<span class="w"> </span>http://controller:9696
</span><span id="__span-173-20"><a id="__codelineno-173-20" name="__codelineno-173-20"></a>
</span><span id="__span-173-21"><a id="__codelineno-173-21" name="__codelineno-173-21"></a>+--------------+----------------------------------+
</span><span id="__span-173-22"><a id="__codelineno-173-22" name="__codelineno-173-22"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">        </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-173-23"><a id="__codelineno-173-23" name="__codelineno-173-23"></a>+--------------+----------------------------------+
</span><span id="__span-173-24"><a id="__codelineno-173-24" name="__codelineno-173-24"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">      </span><span class="p">|</span><span class="w"> </span>True<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-25"><a id="__codelineno-173-25" name="__codelineno-173-25"></a><span class="p">|</span><span class="w"> </span>id<span class="w">           </span><span class="p">|</span><span class="w"> </span>09753b537ac74422a68d2d791cf3714f<span class="w">     </span><span class="p">|</span>
</span><span id="__span-173-26"><a id="__codelineno-173-26" name="__codelineno-173-26"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>internal<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-173-27"><a id="__codelineno-173-27" name="__codelineno-173-27"></a><span class="p">|</span><span class="w"> </span>region<span class="w">       </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                      </span><span class="p">|</span>
</span><span id="__span-173-28"><a id="__codelineno-173-28" name="__codelineno-173-28"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                        </span><span class="p">|</span>
</span><span id="__span-173-29"><a id="__codelineno-173-29" name="__codelineno-173-29"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>f71529314dab4a4d8eca427e701d209e<span class="w">        </span><span class="p">|</span>
</span><span id="__span-173-30"><a id="__codelineno-173-30" name="__codelineno-173-30"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>neutron<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-31"><a id="__codelineno-173-31" name="__codelineno-173-31"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>network<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-32"><a id="__codelineno-173-32" name="__codelineno-173-32"></a><span class="p">|</span><span class="w"> </span>url<span class="w">          </span><span class="p">|</span><span class="w"> </span>http://controller:9696<span class="w">             </span><span class="p">|</span>
</span><span id="__span-173-33"><a id="__codelineno-173-33" name="__codelineno-173-33"></a>+--------------+----------------------------------+
</span><span id="__span-173-34"><a id="__codelineno-173-34" name="__codelineno-173-34"></a>
</span><span id="__span-173-35"><a id="__codelineno-173-35" name="__codelineno-173-35"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-173-36"><a id="__codelineno-173-36" name="__codelineno-173-36"></a><span class="w">  </span>network<span class="w"> </span>admin<span class="w"> </span>http://controller:9696
</span><span id="__span-173-37"><a id="__codelineno-173-37" name="__codelineno-173-37"></a>
</span><span id="__span-173-38"><a id="__codelineno-173-38" name="__codelineno-173-38"></a>+--------------+----------------------------------+
</span><span id="__span-173-39"><a id="__codelineno-173-39" name="__codelineno-173-39"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">      </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-173-40"><a id="__codelineno-173-40" name="__codelineno-173-40"></a>+--------------+----------------------------------+
</span><span id="__span-173-41"><a id="__codelineno-173-41" name="__codelineno-173-41"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-173-42"><a id="__codelineno-173-42" name="__codelineno-173-42"></a><span class="p">|</span><span class="w"> </span>id<span class="w">        </span><span class="p">|</span><span class="w"> </span>1ee14289c9374dffb5db92a5c112fc4e<span class="w"> </span><span class="p">|</span>
</span><span id="__span-173-43"><a id="__codelineno-173-43" name="__codelineno-173-43"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>admin<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-173-44"><a id="__codelineno-173-44" name="__codelineno-173-44"></a><span class="p">|</span><span class="w"> </span>region<span class="w">      </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-173-45"><a id="__codelineno-173-45" name="__codelineno-173-45"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-173-46"><a id="__codelineno-173-46" name="__codelineno-173-46"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>f71529314dab4a4d8eca427e701d209e<span class="w">          </span><span class="p">|</span>
</span><span id="__span-173-47"><a id="__codelineno-173-47" name="__codelineno-173-47"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w">  </span><span class="p">|</span><span class="w"> </span>neutron<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-48"><a id="__codelineno-173-48" name="__codelineno-173-48"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w">  </span><span class="p">|</span><span class="w"> </span>network<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-173-49"><a id="__codelineno-173-49" name="__codelineno-173-49"></a><span class="p">|</span><span class="w"> </span>url<span class="w">        </span><span class="p">|</span><span class="w"> </span>http://controller:9696<span class="w">                </span><span class="p">|</span>
</span><span id="__span-173-50"><a id="__codelineno-173-50" name="__codelineno-173-50"></a>+--------------+----------------------------------+
</span></code></pre></div></td></tr></table></div>
<h3 id="_5">配置网络</h3>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-174-1">1</a></span>
<span class="normal"><a href="#__codelineno-174-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1"></a><span class="w">  </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-neutron<span class="w"> </span>openstack-neutron-ml2<span class="w"> </span><span class="se">\</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2"></a><span class="w">  </span>openstack-neutron-linuxbridge<span class="w"> </span>ebtables
</span></code></pre></div></td></tr></table></div>
<h3 id="_6">配置服务器组件</h3>
<ul>
<li>
<p>编辑<code>/etc/neutron/neutron.conf</code>文件并完成以下操作： </p>
</li>
<li>
<p>在该<code>[database]</code>部分中，配置数据库访问： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-175-1">1</a></span>
<span class="normal"><a href="#__codelineno-175-2">2</a></span>
<span class="normal"><a href="#__codelineno-175-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1"></a><span class="o">[</span>database<span class="o">]</span>
</span><span id="__span-175-2"><a id="__codelineno-175-2" name="__codelineno-175-2"></a><span class="c1"># ...</span>
</span><span id="__span-175-3"><a id="__codelineno-175-3" name="__codelineno-175-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NEUTRON_DBPASS</code>为您为数据库选择的密码。 </p>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，启用模块化第2层（ML2）插件，路由器服务和重叠的IP地址： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-176-1">1</a></span>
<span class="normal"><a href="#__codelineno-176-2">2</a></span>
<span class="normal"><a href="#__codelineno-176-3">3</a></span>
<span class="normal"><a href="#__codelineno-176-4">4</a></span>
<span class="normal"><a href="#__codelineno-176-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2"></a><span class="c1"># ...</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3"></a><span class="nv">core_plugin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>ml2
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4"></a><span class="nv">service_plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>router
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5"></a><span class="nv">allow_overlapping_ips</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code> 消息队列访问： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-177-1">1</a></span>
<span class="normal"><a href="#__codelineno-177-2">2</a></span>
<span class="normal"><a href="#__codelineno-177-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2"></a><span class="c1"># ...</span>
</span><span id="__span-177-3"><a id="__codelineno-177-3" name="__codelineno-177-3"></a><span class="nv">transport_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rabbit://openstack:RABBIT_PASS@controller
</span></code></pre></div></td></tr></table></div>
<p>替换<code>RABBIT_PASS</code>为您<code>openstack</code>在RabbitMQ中为帐户选择的密码 。 </p>
</li>
<li>
<p>在<code>[DEFAULT]</code>和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-178-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-178-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-178-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-178-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-178-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-178-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-178-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-178-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-178-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-178-10">10</a></span>
<span class="normal"><a href="#__codelineno-178-11">11</a></span>
<span class="normal"><a href="#__codelineno-178-12">12</a></span>
<span class="normal"><a href="#__codelineno-178-13">13</a></span>
<span class="normal"><a href="#__codelineno-178-14">14</a></span>
<span class="normal"><a href="#__codelineno-178-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-178-2"><a id="__codelineno-178-2" name="__codelineno-178-2"></a><span class="c1"># ...</span>
</span><span id="__span-178-3"><a id="__codelineno-178-3" name="__codelineno-178-3"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span><span id="__span-178-4"><a id="__codelineno-178-4" name="__codelineno-178-4"></a>
</span><span id="__span-178-5"><a id="__codelineno-178-5" name="__codelineno-178-5"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-178-6"><a id="__codelineno-178-6" name="__codelineno-178-6"></a><span class="c1"># ...</span>
</span><span id="__span-178-7"><a id="__codelineno-178-7" name="__codelineno-178-7"></a><span class="nv">www_authenticate_uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-178-8"><a id="__codelineno-178-8" name="__codelineno-178-8"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-178-9"><a id="__codelineno-178-9" name="__codelineno-178-9"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-178-10"><a id="__codelineno-178-10" name="__codelineno-178-10"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-178-11"><a id="__codelineno-178-11" name="__codelineno-178-11"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-178-12"><a id="__codelineno-178-12" name="__codelineno-178-12"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-178-13"><a id="__codelineno-178-13" name="__codelineno-178-13"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-178-14"><a id="__codelineno-178-14" name="__codelineno-178-14"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron
</span><span id="__span-178-15"><a id="__codelineno-178-15" name="__codelineno-178-15"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NEUTRON_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在身份服务中为用户选择的密码。 </p>
</li>
<li>
<p>在<code>[DEFAULT]</code>和<code>[nova]</code>部分中，将网络配置为通知Compute网络拓扑更改：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-179-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-179-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-179-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-179-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-179-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-179-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-179-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-179-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-179-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-179-10">10</a></span>
<span class="normal"><a href="#__codelineno-179-11">11</a></span>
<span class="normal"><a href="#__codelineno-179-12">12</a></span>
<span class="normal"><a href="#__codelineno-179-13">13</a></span>
<span class="normal"><a href="#__codelineno-179-14">14</a></span>
<span class="normal"><a href="#__codelineno-179-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2"></a><span class="c1"># ...</span>
</span><span id="__span-179-3"><a id="__codelineno-179-3" name="__codelineno-179-3"></a><span class="nv">notify_nova_on_port_status_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-179-4"><a id="__codelineno-179-4" name="__codelineno-179-4"></a><span class="nv">notify_nova_on_port_data_changes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-179-5"><a id="__codelineno-179-5" name="__codelineno-179-5"></a>
</span><span id="__span-179-6"><a id="__codelineno-179-6" name="__codelineno-179-6"></a><span class="o">[</span>nova<span class="o">]</span>
</span><span id="__span-179-7"><a id="__codelineno-179-7" name="__codelineno-179-7"></a><span class="c1"># ...</span>
</span><span id="__span-179-8"><a id="__codelineno-179-8" name="__codelineno-179-8"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-179-9"><a id="__codelineno-179-9" name="__codelineno-179-9"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-179-10"><a id="__codelineno-179-10" name="__codelineno-179-10"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-179-11"><a id="__codelineno-179-11" name="__codelineno-179-11"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-179-12"><a id="__codelineno-179-12" name="__codelineno-179-12"></a><span class="nv">region_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>RegionOne
</span><span id="__span-179-13"><a id="__codelineno-179-13" name="__codelineno-179-13"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-179-14"><a id="__codelineno-179-14" name="__codelineno-179-14"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>nova
</span><span id="__span-179-15"><a id="__codelineno-179-15" name="__codelineno-179-15"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NOVA_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NOVA_PASS</code>为您<code>nova</code> 在身份服务中为用户选择的密码。 </p>
</li>
<li>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-180-1">1</a></span>
<span class="normal"><a href="#__codelineno-180-2">2</a></span>
<span class="normal"><a href="#__codelineno-180-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1"></a><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2"></a><span class="c1"># ...</span>
</span><span id="__span-180-3"><a id="__codelineno-180-3" name="__codelineno-180-3"></a><span class="nv">lock_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/lib/neutron/tmp
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<p>替换<code>NEUTRON_DBPASS</code>为您为数据库选择的密码。 </p>
<h3 id="2ml2">配置模块化层2（ML2）插件</h3>
<p>ML2插件使用Linux桥接器机制为实例构建第2层（桥接和交换）虚拟网络基础架构。 </p>
<ul>
<li>
<p>编辑<code>/etc/neutron/plugins/ml2/ml2_conf.ini</code>文件并完成以下操作： </p>
</li>
<li>
<p>在该<code>[ml2]</code>部分中，启用平面，VLAN和VXLAN网络： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-181-1">1</a></span>
<span class="normal"><a href="#__codelineno-181-2">2</a></span>
<span class="normal"><a href="#__codelineno-181-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1"></a><span class="o">[</span>ml2<span class="o">]</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2"></a><span class="c1"># ...</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3"></a><span class="nv">type_drivers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>flat,vlan,vxlan
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在该<code>[ml2]</code>部分中，启用VXLAN自助服务网络： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-182-1">1</a></span>
<span class="normal"><a href="#__codelineno-182-2">2</a></span>
<span class="normal"><a href="#__codelineno-182-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1"></a><span class="o">[</span>ml2<span class="o">]</span>
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2"></a><span class="c1"># ...</span>
</span><span id="__span-182-3"><a id="__codelineno-182-3" name="__codelineno-182-3"></a><span class="nv">tenant_network_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>vxlan
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在本<code>[ml2]</code>节中，启用Linux桥接器和第2层填充机制： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-183-1">1</a></span>
<span class="normal"><a href="#__codelineno-183-2">2</a></span>
<span class="normal"><a href="#__codelineno-183-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1"></a><span class="o">[</span>ml2<span class="o">]</span>
</span><span id="__span-183-2"><a id="__codelineno-183-2" name="__codelineno-183-2"></a><span class="c1"># ...</span>
</span><span id="__span-183-3"><a id="__codelineno-183-3" name="__codelineno-183-3"></a><span class="nv">mechanism_drivers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>linuxbridge,l2population
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在此<code>[ml2]</code>部分中，启用端口安全扩展驱动程序：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-184-1">1</a></span>
<span class="normal"><a href="#__codelineno-184-2">2</a></span>
<span class="normal"><a href="#__codelineno-184-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1"></a><span class="o">[</span>ml2<span class="o">]</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2"></a><span class="c1"># ...</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3"></a><span class="nv">extension_drivers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>port_security
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在本<code>[ml2_type_flat]</code>节中，将提供者虚拟网络配置为平面网络：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-185-1">1</a></span>
<span class="normal"><a href="#__codelineno-185-2">2</a></span>
<span class="normal"><a href="#__codelineno-185-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1"></a><span class="o">[</span>ml2_type_flat<span class="o">]</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2"></a><span class="c1"># ...</span>
</span><span id="__span-185-3"><a id="__codelineno-185-3" name="__codelineno-185-3"></a><span class="nv">flat_networks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>provider
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在该<code>[ml2_type_vxlan]</code>部分中，为自助服务网络配置VXLAN网络标识符范围：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-186-1">1</a></span>
<span class="normal"><a href="#__codelineno-186-2">2</a></span>
<span class="normal"><a href="#__codelineno-186-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1"></a><span class="o">[</span>ml2_type_vxlan<span class="o">]</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2"></a><span class="c1"># ...</span>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3"></a><span class="nv">vni_ranges</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>:1000
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在本<code>[securitygroup]</code>节中，启用ipset以提高安全组规则的效率： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-187-1">1</a></span>
<span class="normal"><a href="#__codelineno-187-2">2</a></span>
<span class="normal"><a href="#__codelineno-187-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1"></a><span class="o">[</span>securitygroup<span class="o">]</span>
</span><span id="__span-187-2"><a id="__codelineno-187-2" name="__codelineno-187-2"></a><span class="c1"># ...</span>
</span><span id="__span-187-3"><a id="__codelineno-187-3" name="__codelineno-187-3"></a><span class="nv">enable_ipset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="linux">配置Linux网桥代理</h3>
<p>Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础结构并处理安全组。</p>
<ul>
<li>
<p>编辑<code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code>文件并完成以下操作： </p>
</li>
<li>
<p>在本<code>[linux_bridge]</code>节中，将提供者虚拟网络映射到提供者物理网络接口：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-188-1">1</a></span>
<span class="normal"><a href="#__codelineno-188-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1"></a><span class="o">[</span>linux_bridge<span class="o">]</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2"></a><span class="nv">physical_interface_mappings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>provider:PROVIDER_INTERFACE_NAME
</span></code></pre></div></td></tr></table></div>
<p>替换<code>PROVIDER_INTERFACE_NAME</code>为基础提供商物理网络接口的名称能上网的接口.例如：ens33</p>
</li>
<li>
<p>在本<code>[vxlan]</code>节中，启用VXLAN覆盖网络，配置处理覆盖网络的物理网络接口的IP地址，并启用第2层填充： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-189-1">1</a></span>
<span class="normal"><a href="#__codelineno-189-2">2</a></span>
<span class="normal"><a href="#__codelineno-189-3">3</a></span>
<span class="normal"><a href="#__codelineno-189-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1"></a><span class="o">[</span>vxlan<span class="o">]</span>
</span><span id="__span-189-2"><a id="__codelineno-189-2" name="__codelineno-189-2"></a><span class="nv">enable_vxlan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-189-3"><a id="__codelineno-189-3" name="__codelineno-189-3"></a><span class="nv">local_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OVERLAY_INTERFACE_IP_ADDRESS
</span><span id="__span-189-4"><a id="__codelineno-189-4" name="__codelineno-189-4"></a><span class="nv">l2_population</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div></td></tr></table></div>
<p>替换*<em>OVERLAY_INTERFACE_IP_ADDRESS</em> 为控制器节点的管理IP地址 </p>
</li>
<li>
<p>在该<code>[securitygroup]</code>部分中，启用安全组并配置Linux网桥iptables防火墙驱动程序： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-190-1">1</a></span>
<span class="normal"><a href="#__codelineno-190-2">2</a></span>
<span class="normal"><a href="#__codelineno-190-3">3</a></span>
<span class="normal"><a href="#__codelineno-190-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1"></a><span class="o">[</span>securitygroup<span class="o">]</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2"></a><span class="c1"># ...</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3"></a><span class="nv">enable_security_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4"></a><span class="nv">firewall_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>通过验证以下所有<code>sysctl</code>值是否设置为确保Linux操作系统内核支持网桥过滤器<code>1</code></p>
</li>
<li>
<p>vi /etc/sysctl.conf：增加以下两行后输入命令 sysctl -p</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-191-1">1</a></span>
<span class="normal"><a href="#__codelineno-191-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1"></a>net.bridge.bridge-nf-call-iptables<span class="o">=</span><span class="m">1</span>
</span><span id="__span-191-2"><a id="__codelineno-191-2" name="__codelineno-191-2"></a>net.bridge.bridge-nf-call-ip6tables<span class="o">=</span><span class="m">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="3_4">配置第3层剂</h3>
<p>第3层（L3）代理为自助式虚拟网络提供路由和NAT服务。</p>
<ul>
<li>
<p>编辑<code>/etc/neutron/l3_agent.ini</code>文件并完成以下操作： </p>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，配置Linux网桥接口驱动程序和外部网桥： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-192-1">1</a></span>
<span class="normal"><a href="#__codelineno-192-2">2</a></span>
<span class="normal"><a href="#__codelineno-192-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-192-2"><a id="__codelineno-192-2" name="__codelineno-192-2"></a><span class="c1"># ...</span>
</span><span id="__span-192-3"><a id="__codelineno-192-3" name="__codelineno-192-3"></a><span class="nv">interface_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>linuxbridge
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="dhcp">配置DHCP代理</h3>
<p>DHCP代理为虚拟网络提供DHCP服务。</p>
<ul>
<li>
<p>编辑<code>/etc/neutron/dhcp_agent.ini</code>文件并完成以下操作： </p>
</li>
<li>
<p>在本<code>[DEFAULT]</code>节中，配置Linux桥接口驱动程序Dnsmasq DHCP驱动程序，并启用隔离的元数据，以便提供商网络上的实例可以通过网络访问元数据： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-193-1">1</a></span>
<span class="normal"><a href="#__codelineno-193-2">2</a></span>
<span class="normal"><a href="#__codelineno-193-3">3</a></span>
<span class="normal"><a href="#__codelineno-193-4">4</a></span>
<span class="normal"><a href="#__codelineno-193-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-193-2"><a id="__codelineno-193-2" name="__codelineno-193-2"></a><span class="c1"># ...</span>
</span><span id="__span-193-3"><a id="__codelineno-193-3" name="__codelineno-193-3"></a><span class="nv">interface_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>linuxbridge
</span><span id="__span-193-4"><a id="__codelineno-193-4" name="__codelineno-193-4"></a><span class="nv">dhcp_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron.agent.linux.dhcp.Dnsmasq
</span><span id="__span-193-5"><a id="__codelineno-193-5" name="__codelineno-193-5"></a><span class="nv">enable_isolated_metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="_7">配置元数据代理</h3>
<h5 id="_8">元数据代理提供配置信息，例如实例的凭据。</h5>
<ul>
<li>
<p>编辑<code>/etc/neutron/metadata_agent.ini</code>文件并完成以下操作： </p>
</li>
<li>
<p>在该<strong>[DEFAULT]</strong>部分中，配置元数据主机和共享机密：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-194-1">1</a></span>
<span class="normal"><a href="#__codelineno-194-2">2</a></span>
<span class="normal"><a href="#__codelineno-194-3">3</a></span>
<span class="normal"><a href="#__codelineno-194-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-194-2"><a id="__codelineno-194-2" name="__codelineno-194-2"></a><span class="c1"># ...</span>
</span><span id="__span-194-3"><a id="__codelineno-194-3" name="__codelineno-194-3"></a><span class="nv">nova_metadata_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller
</span><span id="__span-194-4"><a id="__codelineno-194-4" name="__codelineno-194-4"></a><span class="nv">metadata_proxy_shared_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>METADATA_SECRET
</span></code></pre></div></td></tr></table></div>
<p>替换<strong>METADATA_SECRET</strong>为元数据代理的适当机密。 例如：123456</p>
</li>
</ul>
<h3 id="_9">配置计算服务使用网络服务</h3>
<blockquote>
<p>必须安装Nova计算服务才能完成此步骤。</p>
</blockquote>
<ul>
<li>
<p>编辑<code>/etc/nova/nova.conf</code>文件并执行以下操作：</p>
</li>
<li>
<p>在该<code>[neutron]</code>部分中，配置访问参数，启用元数据代理，并配置机密：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-195-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-195-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-195-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-195-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-195-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-195-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-195-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-195-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-195-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-195-10">10</a></span>
<span class="normal"><a href="#__codelineno-195-11">11</a></span>
<span class="normal"><a href="#__codelineno-195-12">12</a></span>
<span class="normal"><a href="#__codelineno-195-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1"></a><span class="o">[</span>neutron<span class="o">]</span>
</span><span id="__span-195-2"><a id="__codelineno-195-2" name="__codelineno-195-2"></a><span class="c1"># ...</span>
</span><span id="__span-195-3"><a id="__codelineno-195-3" name="__codelineno-195-3"></a><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:9696
</span><span id="__span-195-4"><a id="__codelineno-195-4" name="__codelineno-195-4"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-195-5"><a id="__codelineno-195-5" name="__codelineno-195-5"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-195-6"><a id="__codelineno-195-6" name="__codelineno-195-6"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-195-7"><a id="__codelineno-195-7" name="__codelineno-195-7"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-195-8"><a id="__codelineno-195-8" name="__codelineno-195-8"></a><span class="nv">region_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>RegionOne
</span><span id="__span-195-9"><a id="__codelineno-195-9" name="__codelineno-195-9"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-195-10"><a id="__codelineno-195-10" name="__codelineno-195-10"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron
</span><span id="__span-195-11"><a id="__codelineno-195-11" name="__codelineno-195-11"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NEUTRON_PASS
</span><span id="__span-195-12"><a id="__codelineno-195-12" name="__codelineno-195-12"></a><span class="nv">service_metadata_proxy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-195-13"><a id="__codelineno-195-13" name="__codelineno-195-13"></a><span class="nv">metadata_proxy_shared_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>METADATA_SECRET
</span></code></pre></div></td></tr></table></div>
<p>替换<strong>NEUTRON_PASS</strong>为您<code>neutron</code> 在身份服务中为用户选择的密码。</p>
<p>替换<strong>METADATA_SECRET</strong>为您为元数据代理选择的机密。</p>
</li>
</ul>
<h3 id="_10">最终确定安装</h3>
<ol>
<li>网络服务初始化脚本需要<code>/etc/neutron/plugin.ini</code>指向ML2插件配置文件的符号链接<code>/etc/neutron/plugins/ml2/ml2_conf.ini</code>。如果此符号链接不存在，请使用以下命令创建它： </li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-196-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1"></a>ln<span class="w"> </span>-s<span class="w"> </span>/etc/neutron/plugins/ml2/ml2_conf.ini<span class="w"> </span>/etc/neutron/plugin.ini
</span></code></pre></div></td></tr></table></div>
<ol>
<li>填充数据库： </li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-197-1">1</a></span>
<span class="normal"><a href="#__codelineno-197-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1"></a>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span>
</span><span id="__span-197-2"><a id="__codelineno-197-2" name="__codelineno-197-2"></a><span class="s2">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot;</span><span class="w"> </span>neutron
</span></code></pre></div></td></tr></table></div>
<ol>
<li>重新启动Compute API服务：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-198-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1"></a>systemctl<span class="w"> </span>restart<span class="w"> </span>openstack-nova-api.service
</span></code></pre></div></td></tr></table></div>
<ol>
<li>启动网络服务，并将其配置为在系统引导时启动。</li>
</ol>
<p>对于两个网络选项： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-199-1">1</a></span>
<span class="normal"><a href="#__codelineno-199-2">2</a></span>
<span class="normal"><a href="#__codelineno-199-3">3</a></span>
<span class="normal"><a href="#__codelineno-199-4">4</a></span>
<span class="normal"><a href="#__codelineno-199-5">5</a></span>
<span class="normal"><a href="#__codelineno-199-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>neutron-server.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-199-2"><a id="__codelineno-199-2" name="__codelineno-199-2"></a><span class="w">  </span>neutron-linuxbridge-agent.service<span class="w"> </span>neutron-dhcp-agent.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-199-3"><a id="__codelineno-199-3" name="__codelineno-199-3"></a><span class="w">  </span>neutron-metadata-agent.service
</span><span id="__span-199-4"><a id="__codelineno-199-4" name="__codelineno-199-4"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>neutron-server.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-199-5"><a id="__codelineno-199-5" name="__codelineno-199-5"></a><span class="w">  </span>neutron-linuxbridge-agent.service<span class="w"> </span>neutron-dhcp-agent.service<span class="w"> </span><span class="se">\</span>
</span><span id="__span-199-6"><a id="__codelineno-199-6" name="__codelineno-199-6"></a><span class="w">  </span>neutron-metadata-agent.service
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code> 对于网络选项2，还启用并启动第3层服务：
</code></pre></div></td></tr></table></div>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-200-1">1</a></span>
<span class="normal"><a href="#__codelineno-200-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1"></a><span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>neutron-l3-agent.service
</span><span id="__span-200-2"><a id="__codelineno-200-2" name="__codelineno-200-2"></a><span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>neutron-l3-agent.service
</span></code></pre></div></td></tr></table></div>
<h2 id="_11">计算节点</h2>
<h3 id="_12">安装的组件</h3>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-201-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1"></a><span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-neutron-linuxbridge<span class="w"> </span>ebtables<span class="w"> </span>ipset
</span></code></pre></div></td></tr></table></div>
<h3 id="_13">配置公共部件</h3>
<p>网络公用组件配置包括身份验证机制，消息队列和插件。 </p>
<blockquote>
<p>默认配置文件因分发而异。您可能需要添加这些部分和选项，而不是修改现有的部分和选项。另外，<code>...</code>配置摘要中的省略号（）表示您应保留的潜在默认配置选项。 </p>
</blockquote>
<ul>
<li>
<p>编辑<code>/etc/neutron/neutron.conf</code>文件并完成以下操作： </p>
</li>
<li>
<p>在本<code>[database]</code>节中，注释掉所有<code>connection</code>选项，因为计算节点不会直接访问数据库。</p>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，配置<code>RabbitMQ</code> 消息队列访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-202-1">1</a></span>
<span class="normal"><a href="#__codelineno-202-2">2</a></span>
<span class="normal"><a href="#__codelineno-202-3">3</a></span>
<span class="normal"><a href="#__codelineno-202-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-202-2"><a id="__codelineno-202-2" name="__codelineno-202-2"></a><span class="c1"># ...</span>
</span><span id="__span-202-3"><a id="__codelineno-202-3" name="__codelineno-202-3"></a><span class="nv">transport_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rabbit://openstack:RABBIT_PASS@controller
</span><span id="__span-202-4"><a id="__codelineno-202-4" name="__codelineno-202-4"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-203-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-203-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-203-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-203-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-203-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-203-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-203-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-203-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-203-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-203-10">10</a></span>
<span class="normal"><a href="#__codelineno-203-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-203-2"><a id="__codelineno-203-2" name="__codelineno-203-2"></a><span class="c1"># ...</span>
</span><span id="__span-203-3"><a id="__codelineno-203-3" name="__codelineno-203-3"></a><span class="nv">www_authenticate_uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-203-4"><a id="__codelineno-203-4" name="__codelineno-203-4"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-203-5"><a id="__codelineno-203-5" name="__codelineno-203-5"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-203-6"><a id="__codelineno-203-6" name="__codelineno-203-6"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-203-7"><a id="__codelineno-203-7" name="__codelineno-203-7"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-203-8"><a id="__codelineno-203-8" name="__codelineno-203-8"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-203-9"><a id="__codelineno-203-9" name="__codelineno-203-9"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-203-10"><a id="__codelineno-203-10" name="__codelineno-203-10"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron
</span><span id="__span-203-11"><a id="__codelineno-203-11" name="__codelineno-203-11"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NEUTRON_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在身份服务中为用户选择的密码。 </p>
</li>
<li>
<p>在该<code>[oslo_concurrency]</code>部分中，配置锁定路径：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-204-1">1</a></span>
<span class="normal"><a href="#__codelineno-204-2">2</a></span>
<span class="normal"><a href="#__codelineno-204-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-204-1"><a id="__codelineno-204-1" name="__codelineno-204-1"></a><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span><span id="__span-204-2"><a id="__codelineno-204-2" name="__codelineno-204-2"></a><span class="c1"># ...</span>
</span><span id="__span-204-3"><a id="__codelineno-204-3" name="__codelineno-204-3"></a><span class="nv">lock_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/lib/neutron/tmp
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="_14">配置网络</h3>
<h3 id="linux_1">配置Linux网桥代理</h3>
<p>Linux网桥代理为实例构建第2层（桥接和交换）虚拟网络基础结构并处理安全组。</p>
<ul>
<li>
<p>编辑<code>/etc/neutron/plugins/ml2/linuxbridge_agent.ini</code>文件并完成以下操作： </p>
</li>
<li>
<p>在本<code>[linux_bridge]</code>节中，将提供者虚拟网络映射到提供者物理网络接口： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-205-1">1</a></span>
<span class="normal"><a href="#__codelineno-205-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-205-1"><a id="__codelineno-205-1" name="__codelineno-205-1"></a><span class="o">[</span>linux_bridge<span class="o">]</span>
</span><span id="__span-205-2"><a id="__codelineno-205-2" name="__codelineno-205-2"></a><span class="nv">physical_interface_mappings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>provider:PROVIDER_INTERFACE_NAME
</span></code></pre></div></td></tr></table></div>
<p>替换<code>PROVIDER_INTERFACE_NAME</code>为基础提供商物理网络接口的名称,能上网的接口名称。 例如：ens33</p>
</li>
<li>
<p>在本<code>[vxlan]</code>节中，启用VXLAN覆盖网络，配置处理覆盖网络的物理网络接口的IP地址，并启用第2层填充：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-206-1">1</a></span>
<span class="normal"><a href="#__codelineno-206-2">2</a></span>
<span class="normal"><a href="#__codelineno-206-3">3</a></span>
<span class="normal"><a href="#__codelineno-206-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-206-1"><a id="__codelineno-206-1" name="__codelineno-206-1"></a><span class="o">[</span>vxlan<span class="o">]</span>
</span><span id="__span-206-2"><a id="__codelineno-206-2" name="__codelineno-206-2"></a><span class="nv">enable_vxlan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-206-3"><a id="__codelineno-206-3" name="__codelineno-206-3"></a><span class="nv">local_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>OVERLAY_INTERFACE_IP_ADDRESS
</span><span id="__span-206-4"><a id="__codelineno-206-4" name="__codelineno-206-4"></a><span class="nv">l2_population</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span></code></pre></div></td></tr></table></div>
<p>替换OVERLAY_INTERFACE_IP_ADDRESS为计算节点的管理IP地址。 </p>
</li>
<li>
<p>在该<code>[securitygroup]</code>部分中，启用安全组并配置Linux网桥iptables防火墙驱动程序： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-207-1">1</a></span>
<span class="normal"><a href="#__codelineno-207-2">2</a></span>
<span class="normal"><a href="#__codelineno-207-3">3</a></span>
<span class="normal"><a href="#__codelineno-207-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-207-1"><a id="__codelineno-207-1" name="__codelineno-207-1"></a><span class="o">[</span>securitygroup<span class="o">]</span>
</span><span id="__span-207-2"><a id="__codelineno-207-2" name="__codelineno-207-2"></a><span class="c1"># ...</span>
</span><span id="__span-207-3"><a id="__codelineno-207-3" name="__codelineno-207-3"></a><span class="nv">enable_security_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
</span><span id="__span-207-4"><a id="__codelineno-207-4" name="__codelineno-207-4"></a><span class="nv">firewall_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>通过验证以下所有<code>sysctl</code>值是否设置为确保Linux操作系统内核支持网桥过滤器1 </p>
</li>
<li>
<p>vi /etc/sysctl.conf  增加以下两行后输入命令 sysctl -p</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-208-1">1</a></span>
<span class="normal"><a href="#__codelineno-208-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-208-1"><a id="__codelineno-208-1" name="__codelineno-208-1"></a>net.bridge.bridge-nf-call-iptables<span class="o">=</span><span class="m">1</span>
</span><span id="__span-208-2"><a id="__codelineno-208-2" name="__codelineno-208-2"></a>net.bridge.bridge-nf-call-ip6tables<span class="o">=</span><span class="m">1</span>
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="_15">配置计算服务使用网络服务</h3>
<ul>
<li>
<p>编辑<code>/etc/nova/nova.conf</code>文件并完成以下操作： </p>
</li>
<li>
<p>在该<code>[neutron]</code>部分中，配置访问参数： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-209-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-209-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-209-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-209-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-209-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-209-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-209-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-209-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-209-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-209-10">10</a></span>
<span class="normal"><a href="#__codelineno-209-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-209-1"><a id="__codelineno-209-1" name="__codelineno-209-1"></a><span class="o">[</span>neutron<span class="o">]</span>
</span><span id="__span-209-2"><a id="__codelineno-209-2" name="__codelineno-209-2"></a><span class="c1"># ...</span>
</span><span id="__span-209-3"><a id="__codelineno-209-3" name="__codelineno-209-3"></a><span class="nv">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:9696
</span><span id="__span-209-4"><a id="__codelineno-209-4" name="__codelineno-209-4"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-209-5"><a id="__codelineno-209-5" name="__codelineno-209-5"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-209-6"><a id="__codelineno-209-6" name="__codelineno-209-6"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-209-7"><a id="__codelineno-209-7" name="__codelineno-209-7"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-209-8"><a id="__codelineno-209-8" name="__codelineno-209-8"></a><span class="nv">region_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>RegionOne
</span><span id="__span-209-9"><a id="__codelineno-209-9" name="__codelineno-209-9"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-209-10"><a id="__codelineno-209-10" name="__codelineno-209-10"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>neutron
</span><span id="__span-209-11"><a id="__codelineno-209-11" name="__codelineno-209-11"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>NEUTRON_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>NEUTRON_PASS</code>为您<code>neutron</code> 在身份服务中为用户选择的密码。 </p>
</li>
</ul>
<h3 id="_16">最终确定安装</h3>
<ol>
<li>重新启动计算服务： </li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-210-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-210-1"><a id="__codelineno-210-1" name="__codelineno-210-1"></a><span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>openstack-nova-compute.service
</span></code></pre></div></td></tr></table></div>
<ol>
<li>启动Linux网桥代理，并将其配置为在系统引导时启动：</li>
</ol>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-211-1">1</a></span>
<span class="normal"><a href="#__codelineno-211-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-211-1"><a id="__codelineno-211-1" name="__codelineno-211-1"></a><span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>neutron-linuxbridge-agent.service
</span><span id="__span-211-2"><a id="__codelineno-211-2" name="__codelineno-211-2"></a><span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>neutron-linuxbridge-agent.service
</span></code></pre></div></td></tr></table></div>
<h2 id="_17">验证</h2>
<p>在控制节点下验证</p>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-212-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-212-1"><a id="__codelineno-212-1" name="__codelineno-212-1"></a>$ openstack network agent list
</span></code></pre></div></td></tr></table></div>
<div class="language-text highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-213-1">1</a></span>
<span class="normal"><a href="#__codelineno-213-2">2</a></span>
<span class="normal"><a href="#__codelineno-213-3">3</a></span>
<span class="normal"><a href="#__codelineno-213-4">4</a></span>
<span class="normal"><a href="#__codelineno-213-5">5</a></span>
<span class="normal"><a href="#__codelineno-213-6">6</a></span>
<span class="normal"><a href="#__codelineno-213-7">7</a></span>
<span class="normal"><a href="#__codelineno-213-8">8</a></span>
<span class="normal"><a href="#__codelineno-213-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-213-1"><a id="__codelineno-213-1" name="__codelineno-213-1"></a>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
</span><span id="__span-213-2"><a id="__codelineno-213-2" name="__codelineno-213-2"></a>| ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |
</span><span id="__span-213-3"><a id="__codelineno-213-3" name="__codelineno-213-3"></a>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
</span><span id="__span-213-4"><a id="__codelineno-213-4" name="__codelineno-213-4"></a>| f49a4b81-afd6-4b3d-b923-66c8f0517099 | Metadata agent     | controller | None            | True  | UP    | neutron-metadata-agent    |
</span><span id="__span-213-5"><a id="__codelineno-213-5" name="__codelineno-213-5"></a>| 27eee952-a748-467b-bf71-941e89846a92 | Linux bridge agent   | controller   | None          | True  | UP    | neutron-linuxbridge-agent |
</span><span id="__span-213-6"><a id="__codelineno-213-6" name="__codelineno-213-6"></a>| 08905043-5010-4b87-bba5-aedb1956e27a | Linux bridge agent   | compute1     | None          | True  | UP    | neutron-linuxbridge-agent |
</span><span id="__span-213-7"><a id="__codelineno-213-7" name="__codelineno-213-7"></a>| 830344ff-dc36-4956-84f4-067af667a0dc | L3 agent          | controller | nova            | True  | UP    | neutron-l3-agent       |
</span><span id="__span-213-8"><a id="__codelineno-213-8" name="__codelineno-213-8"></a>| dd3644c9-1a3a-435a-9282-eb306b4b0391 | DHCP agent        | controller | nova             | True  | UP    | neutron-dhcp-agent      |
</span><span id="__span-213-9"><a id="__codelineno-213-9" name="__codelineno-213-9"></a>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+
</span></code></pre></div></td></tr></table></div>
<h1 id="dashboard">Dashboard服务配置</h1>
<h2 id="_18">安装和配置的部件</h2>
<blockquote>
<p>注意：</p>
<p>注意默认配置文件因分发而异。您可能需要添加这些部分和选项，而不是修改现有的部分和选项。另外，<code>...</code>配置摘要中的省略号（）表示您应保留的潜在默认配置选项。</p>
</blockquote>
<ul>
<li>1.安装软件包： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-214-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-214-1"><a id="__codelineno-214-1" name="__codelineno-214-1"></a>$<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-dashboard
</span></code></pre></div></td></tr></table></div>
<ul>
<li>
<p>2.编辑 <code>/etc/openstack-dashboard/local_settings</code> 文件并完成以下操作：</p>
</li>
<li>
<p>配置仪表板以在<code>controller</code>节点上使用OpenStack服务 ：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-215-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-215-1"><a id="__codelineno-215-1" name="__codelineno-215-1"></a><span class="nv">OPENSTACK_HOST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;controller&quot;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>允许主机访问仪表板：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-216-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-216-1"><a id="__codelineno-216-1" name="__codelineno-216-1"></a><span class="nv">ALLOWED_HOSTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s1">&#39;*&#39;</span>,<span class="w"> </span><span class="s1">&#39;two.example.com&#39;</span><span class="o">]</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意</p>
<p>ALLOWED_HOSTS也可以是['*']以接受所有主机。这对于开发工作可能有用，但是可能不安全，因此不应在生产中使用。有关 更多信息，请参见 https://docs.djangoproject.com/en/dev/ref/settings/#allowed-hosts。</p>
</blockquote>
</li>
<li>
<p>配置<code>memcached</code>会话存储服务：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-217-1">1</a></span>
<span class="normal"><a href="#__codelineno-217-2">2</a></span>
<span class="normal"><a href="#__codelineno-217-3">3</a></span>
<span class="normal"><a href="#__codelineno-217-4">4</a></span>
<span class="normal"><a href="#__codelineno-217-5">5</a></span>
<span class="normal"><a href="#__codelineno-217-6">6</a></span>
<span class="normal"><a href="#__codelineno-217-7">7</a></span>
<span class="normal"><a href="#__codelineno-217-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-217-1"><a id="__codelineno-217-1" name="__codelineno-217-1"></a><span class="nv">SESSION_ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;django.contrib.sessions.backends.cache&#39;</span>
</span><span id="__span-217-2"><a id="__codelineno-217-2" name="__codelineno-217-2"></a>
</span><span id="__span-217-3"><a id="__codelineno-217-3" name="__codelineno-217-3"></a><span class="nv">CACHES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-217-4"><a id="__codelineno-217-4" name="__codelineno-217-4"></a><span class="w">    </span><span class="s1">&#39;default&#39;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-217-5"><a id="__codelineno-217-5" name="__codelineno-217-5"></a><span class="w">     </span><span class="s1">&#39;BACKEND&#39;</span>:<span class="s1">&#39;django.core.cache.backends.memcached.MemcachedCache&#39;</span>,
</span><span id="__span-217-6"><a id="__codelineno-217-6" name="__codelineno-217-6"></a><span class="w">         </span><span class="s1">&#39;LOCATION&#39;</span>:<span class="w"> </span><span class="s1">&#39;controller:11211&#39;</span>,
</span><span id="__span-217-7"><a id="__codelineno-217-7" name="__codelineno-217-7"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-217-8"><a id="__codelineno-217-8" name="__codelineno-217-8"></a><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意：</p>
<p>注释掉任何其他会话储存配置。</p>
</blockquote>
</li>
<li>
<p>启用身份API版本3：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-218-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-218-1"><a id="__codelineno-218-1" name="__codelineno-218-1"></a>$<span class="w"> </span><span class="nv">OPENSTACK_KEYSTONE_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;http://%s:5000/v3&quot;</span><span class="w"> </span>%<span class="w"> </span>OPENSTACK_HOST
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>启用对域的支持：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-219-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-219-1"><a id="__codelineno-219-1" name="__codelineno-219-1"></a>$<span class="w"> </span><span class="nv">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>配置API版本：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-220-1">1</a></span>
<span class="normal"><a href="#__codelineno-220-2">2</a></span>
<span class="normal"><a href="#__codelineno-220-3">3</a></span>
<span class="normal"><a href="#__codelineno-220-4">4</a></span>
<span class="normal"><a href="#__codelineno-220-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-220-1"><a id="__codelineno-220-1" name="__codelineno-220-1"></a><span class="nv">OPENSTACK_API_VERSIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-220-2"><a id="__codelineno-220-2" name="__codelineno-220-2"></a><span class="w">    </span><span class="s2">&quot;identity&quot;</span>:<span class="w"> </span><span class="m">3</span>,
</span><span id="__span-220-3"><a id="__codelineno-220-3" name="__codelineno-220-3"></a><span class="w">    </span><span class="s2">&quot;image&quot;</span>:<span class="w"> </span><span class="m">2</span>,
</span><span id="__span-220-4"><a id="__codelineno-220-4" name="__codelineno-220-4"></a><span class="w">    </span><span class="s2">&quot;volume&quot;</span>:<span class="w"> </span><span class="m">3</span>,
</span><span id="__span-220-5"><a id="__codelineno-220-5" name="__codelineno-220-5"></a><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>配置<code>Default</code>为通过仪表板创建的用户的默认域：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-221-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-221-1"><a id="__codelineno-221-1" name="__codelineno-221-1"></a><span class="nv">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Default&quot;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>配置<code>user</code>为通过仪表板创建的用户的默认角色：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-222-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-222-1"><a id="__codelineno-222-1" name="__codelineno-222-1"></a><span class="nv">OPENSTACK_KEYSTONE_DEFAULT_ROLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;user&quot;</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>如果选择网络选项1，请禁用对第3层网络服务的支持：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-223-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-223-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-223-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-223-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-223-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-223-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-223-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-223-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-223-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-223-10">10</a></span>
<span class="normal"><a href="#__codelineno-223-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-223-1"><a id="__codelineno-223-1" name="__codelineno-223-1"></a><span class="nv">OPENSTACK_NEUTRON_NETWORK</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-223-2"><a id="__codelineno-223-2" name="__codelineno-223-2"></a><span class="w">    </span>...
</span><span id="__span-223-3"><a id="__codelineno-223-3" name="__codelineno-223-3"></a><span class="w">    </span><span class="s1">&#39;enable_router&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-4"><a id="__codelineno-223-4" name="__codelineno-223-4"></a><span class="w">    </span><span class="s1">&#39;enable_quotas&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-5"><a id="__codelineno-223-5" name="__codelineno-223-5"></a><span class="w">    </span><span class="s1">&#39;enable_distributed_router&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-6"><a id="__codelineno-223-6" name="__codelineno-223-6"></a><span class="w">    </span><span class="s1">&#39;enable_ha_router&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-7"><a id="__codelineno-223-7" name="__codelineno-223-7"></a><span class="w">    </span><span class="s1">&#39;enable_lb&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-8"><a id="__codelineno-223-8" name="__codelineno-223-8"></a><span class="w">    </span><span class="s1">&#39;enable_firewall&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-9"><a id="__codelineno-223-9" name="__codelineno-223-9"></a><span class="w">    </span><span class="s1">&#39;enable_vpn&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-10"><a id="__codelineno-223-10" name="__codelineno-223-10"></a><span class="w">    </span><span class="s1">&#39;enable_fip_topology_check&#39;</span>:<span class="w"> </span>False,
</span><span id="__span-223-11"><a id="__codelineno-223-11" name="__codelineno-223-11"></a><span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>（可选）配置时区：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-224-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-224-1"><a id="__codelineno-224-1" name="__codelineno-224-1"></a><span class="nv">TIME_ZONE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TIME_ZONE&quot;</span>
</span></code></pre></div></td></tr></table></div>
<p>替换<code>TIME_ZONE</code>为适当的时区标识符。有关更多信息，请参见<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">时区列表</a>。</p>
</li>
<li>
<p>3.<code>/etc/httpd/conf.d/openstack-dashboard.conf</code>如果不包含以下内容，请添加以下行 。</p>
</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-225-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-225-1"><a id="__codelineno-225-1" name="__codelineno-225-1"></a>WSGIApplicationGroup<span class="w"> </span>%<span class="o">{</span>GLOBAL<span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="_19">最终确定安装</h2>
<ul>
<li>重新启动Web服务器和会话存储服务：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-226-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-226-1"><a id="__codelineno-226-1" name="__codelineno-226-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>httpd.service<span class="w"> </span>memcached.service
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意:</p>
<p>如果当前未运行，该命令将启动每个服务。<code>systemctl restart</code></p>
</blockquote>
<h1 id="cinder">Cinder服务配置</h1>
<h2 id="_20">控制节点</h2>
<h4 id="1_6">1.创建数据库</h4>
<ul>
<li>使用数据库访问客户端以<code>root</code>用户身份连接到数据库服务器： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-227-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-227-1"><a id="__codelineno-227-1" name="__codelineno-227-1"></a>$<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</span></code></pre></div></td></tr></table></div>
<ul>
<li>创建<code>cinder</code>数据库： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-228-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-228-1"><a id="__codelineno-228-1" name="__codelineno-228-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span><span class="w"> </span>CREATE<span class="w"> </span>DATABASE<span class="w"> </span>cinder<span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>授予对<code>neutron</code>数据库的适当访问权限，<code>NEUTRON_DBPASS</code>并用合适的密码代替 ： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-229-1">1</a></span>
<span class="normal"><a href="#__codelineno-229-2">2</a></span>
<span class="normal"><a href="#__codelineno-229-3">3</a></span>
<span class="normal"><a href="#__codelineno-229-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-229-1"><a id="__codelineno-229-1" name="__codelineno-229-1"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>cinder.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;cinder&#39;</span>@<span class="s1">&#39;localhost&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-229-2"><a id="__codelineno-229-2" name="__codelineno-229-2"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;CINDER_DBPASS&#39;</span><span class="p">;</span>
</span><span id="__span-229-3"><a id="__codelineno-229-3" name="__codelineno-229-3"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>GRANT<span class="w"> </span>ALL<span class="w"> </span>PRIVILEGES<span class="w"> </span>ON<span class="w"> </span>cinder.*<span class="w"> </span>TO<span class="w"> </span><span class="s1">&#39;cinder&#39;</span>@<span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-229-4"><a id="__codelineno-229-4" name="__codelineno-229-4"></a><span class="w">  </span>IDENTIFIED<span class="w"> </span>BY<span class="w"> </span><span class="s1">&#39;CINDER_DBPASS&#39;</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>退出数据库访问客户端。 </li>
</ul>
<h4 id="2-sourceadmincli">2. SOURCE<code>admin</code>凭据以获得对仅限管理的CLI命令的访问权限：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-230-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-230-1"><a id="__codelineno-230-1" name="__codelineno-230-1"></a>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>admin-openrc
</span></code></pre></div></td></tr></table></div>
<h4 id="3_5">3. 要创建服务凭证，请完成以下步骤</h4>
<ul>
<li>创建<code>cinder</code>用户： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-231-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-231-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-231-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-231-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-231-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-231-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-231-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-231-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-231-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-231-10">10</a></span>
<span class="normal"><a href="#__codelineno-231-11">11</a></span>
<span class="normal"><a href="#__codelineno-231-12">12</a></span>
<span class="normal"><a href="#__codelineno-231-13">13</a></span>
<span class="normal"><a href="#__codelineno-231-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-231-1"><a id="__codelineno-231-1" name="__codelineno-231-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>--domain<span class="w"> </span>default<span class="w"> </span>--password-prompt<span class="w"> </span>cinder
</span><span id="__span-231-2"><a id="__codelineno-231-2" name="__codelineno-231-2"></a>
</span><span id="__span-231-3"><a id="__codelineno-231-3" name="__codelineno-231-3"></a>User<span class="w"> </span>Password:
</span><span id="__span-231-4"><a id="__codelineno-231-4" name="__codelineno-231-4"></a>Repeat<span class="w"> </span>User<span class="w"> </span>Password:
</span><span id="__span-231-5"><a id="__codelineno-231-5" name="__codelineno-231-5"></a>+---------------------+----------------------------------------------+
</span><span id="__span-231-6"><a id="__codelineno-231-6" name="__codelineno-231-6"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">          </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-231-7"><a id="__codelineno-231-7" name="__codelineno-231-7"></a>+---------------------+----------------------------------------------+
</span><span id="__span-231-8"><a id="__codelineno-231-8" name="__codelineno-231-8"></a><span class="p">|</span><span class="w"> </span>domain_id<span class="w">        </span><span class="p">|</span><span class="w"> </span>default<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-231-9"><a id="__codelineno-231-9" name="__codelineno-231-9"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">         </span><span class="p">|</span><span class="w"> </span>True<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-231-10"><a id="__codelineno-231-10" name="__codelineno-231-10"></a><span class="p">|</span><span class="w"> </span>id<span class="w">            </span><span class="p">|</span><span class="w"> </span>9d7e33de3e1a498390353819bc7d245d<span class="w">         </span><span class="p">|</span>
</span><span id="__span-231-11"><a id="__codelineno-231-11" name="__codelineno-231-11"></a><span class="p">|</span><span class="w"> </span>name<span class="w">           </span><span class="p">|</span><span class="w"> </span>cinder<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-231-12"><a id="__codelineno-231-12" name="__codelineno-231-12"></a><span class="p">|</span><span class="w"> </span>options<span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="o">{}</span><span class="w">                             </span><span class="p">|</span>
</span><span id="__span-231-13"><a id="__codelineno-231-13" name="__codelineno-231-13"></a><span class="p">|</span><span class="w"> </span>password_expires_at<span class="w"> </span><span class="p">|</span><span class="w"> </span>None<span class="w">                            </span><span class="p">|</span>
</span><span id="__span-231-14"><a id="__codelineno-231-14" name="__codelineno-231-14"></a>+---------------------+----------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<ul>
<li><code>admin</code>向<code>cinder</code>用户添加角色：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-232-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-232-1"><a id="__codelineno-232-1" name="__codelineno-232-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>role<span class="w"> </span>add<span class="w"> </span>--project<span class="w"> </span>service<span class="w"> </span>--user<span class="w"> </span>cinder<span class="w"> </span>admin
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意</strong>:该命令不提供任何输出。</p>
</blockquote>
<ul>
<li>创建<code>cinder</code>服务实体：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-233-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-233-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-233-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-233-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-233-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-233-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-233-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-233-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-233-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-233-10">10</a></span>
<span class="normal"><a href="#__codelineno-233-11">11</a></span>
<span class="normal"><a href="#__codelineno-233-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-233-1"><a id="__codelineno-233-1" name="__codelineno-233-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>cinderv2<span class="w"> </span><span class="se">\</span>
</span><span id="__span-233-2"><a id="__codelineno-233-2" name="__codelineno-233-2"></a><span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;OpenStack Block Storage&quot;</span><span class="w"> </span>volumev2
</span><span id="__span-233-3"><a id="__codelineno-233-3" name="__codelineno-233-3"></a>
</span><span id="__span-233-4"><a id="__codelineno-233-4" name="__codelineno-233-4"></a>+-------------+-------------------------------------------+
</span><span id="__span-233-5"><a id="__codelineno-233-5" name="__codelineno-233-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">     </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-233-6"><a id="__codelineno-233-6" name="__codelineno-233-6"></a>+-------------+-------------------------------------------+
</span><span id="__span-233-7"><a id="__codelineno-233-7" name="__codelineno-233-7"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>OpenStack<span class="w"> </span>Block<span class="w"> </span>Storage<span class="w">             </span><span class="p">|</span>
</span><span id="__span-233-8"><a id="__codelineno-233-8" name="__codelineno-233-8"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span>True<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-233-9"><a id="__codelineno-233-9" name="__codelineno-233-9"></a><span class="p">|</span><span class="w"> </span>id<span class="w">       </span><span class="p">|</span><span class="w"> </span>eb9fd245bdbc414695952e93f29fe3ac<span class="w">       </span><span class="p">|</span>
</span><span id="__span-233-10"><a id="__codelineno-233-10" name="__codelineno-233-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">      </span><span class="p">|</span><span class="w"> </span>cinderv2<span class="w">                       </span><span class="p">|</span>
</span><span id="__span-233-11"><a id="__codelineno-233-11" name="__codelineno-233-11"></a><span class="p">|</span><span class="w"> </span><span class="nb">type</span><span class="w">      </span><span class="p">|</span><span class="w"> </span>volumev2<span class="w">                       </span><span class="p">|</span>
</span><span id="__span-233-12"><a id="__codelineno-233-12" name="__codelineno-233-12"></a>+-------------+-------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-234-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-234-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-234-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-234-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-234-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-234-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-234-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-234-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-234-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-234-10">10</a></span>
<span class="normal"><a href="#__codelineno-234-11">11</a></span>
<span class="normal"><a href="#__codelineno-234-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-234-1"><a id="__codelineno-234-1" name="__codelineno-234-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>cinderv3<span class="w"> </span><span class="se">\</span>
</span><span id="__span-234-2"><a id="__codelineno-234-2" name="__codelineno-234-2"></a><span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;OpenStack Block Storage&quot;</span><span class="w"> </span>volumev3
</span><span id="__span-234-3"><a id="__codelineno-234-3" name="__codelineno-234-3"></a>
</span><span id="__span-234-4"><a id="__codelineno-234-4" name="__codelineno-234-4"></a>+-------------+-------------------------------------------+
</span><span id="__span-234-5"><a id="__codelineno-234-5" name="__codelineno-234-5"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">     </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                         </span><span class="p">|</span>
</span><span id="__span-234-6"><a id="__codelineno-234-6" name="__codelineno-234-6"></a>+-------------+-------------------------------------------+
</span><span id="__span-234-7"><a id="__codelineno-234-7" name="__codelineno-234-7"></a><span class="p">|</span><span class="w"> </span>description<span class="w"> </span><span class="p">|</span><span class="w"> </span>OpenStack<span class="w"> </span>Block<span class="w"> </span>Storage<span class="w">             </span><span class="p">|</span>
</span><span id="__span-234-8"><a id="__codelineno-234-8" name="__codelineno-234-8"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">    </span><span class="p">|</span><span class="w"> </span>True<span class="w">                          </span><span class="p">|</span>
</span><span id="__span-234-9"><a id="__codelineno-234-9" name="__codelineno-234-9"></a><span class="p">|</span><span class="w"> </span>id<span class="w">       </span><span class="p">|</span><span class="w"> </span>ab3bbbef780845a1a283490d281e7fda<span class="w">       </span><span class="p">|</span>
</span><span id="__span-234-10"><a id="__codelineno-234-10" name="__codelineno-234-10"></a><span class="p">|</span><span class="w"> </span>name<span class="w">      </span><span class="p">|</span><span class="w"> </span>cinderv3<span class="w">                       </span><span class="p">|</span>
</span><span id="__span-234-11"><a id="__codelineno-234-11" name="__codelineno-234-11"></a><span class="p">|</span><span class="w"> </span><span class="nb">type</span><span class="w">      </span><span class="p">|</span><span class="w"> </span>volumev3<span class="w">                       </span><span class="p">|</span>
</span><span id="__span-234-12"><a id="__codelineno-234-12" name="__codelineno-234-12"></a>+-------------+-------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意</strong>:块储存服务需要两个服务实体。</p>
</blockquote>
<h4 id="4api">4.创建块储存服务API终端：</h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-235-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-235-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-235-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-235-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-235-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-235-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-235-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-235-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-235-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-235-10">10</a></span>
<span class="normal"><a href="#__codelineno-235-11">11</a></span>
<span class="normal"><a href="#__codelineno-235-12">12</a></span>
<span class="normal"><a href="#__codelineno-235-13">13</a></span>
<span class="normal"><a href="#__codelineno-235-14">14</a></span>
<span class="normal"><a href="#__codelineno-235-15">15</a></span>
<span class="normal"><a href="#__codelineno-235-16">16</a></span>
<span class="normal"><a href="#__codelineno-235-17">17</a></span>
<span class="normal"><a href="#__codelineno-235-18">18</a></span>
<span class="normal"><a href="#__codelineno-235-19">19</a></span>
<span class="normal"><a href="#__codelineno-235-20">20</a></span>
<span class="normal"><a href="#__codelineno-235-21">21</a></span>
<span class="normal"><a href="#__codelineno-235-22">22</a></span>
<span class="normal"><a href="#__codelineno-235-23">23</a></span>
<span class="normal"><a href="#__codelineno-235-24">24</a></span>
<span class="normal"><a href="#__codelineno-235-25">25</a></span>
<span class="normal"><a href="#__codelineno-235-26">26</a></span>
<span class="normal"><a href="#__codelineno-235-27">27</a></span>
<span class="normal"><a href="#__codelineno-235-28">28</a></span>
<span class="normal"><a href="#__codelineno-235-29">29</a></span>
<span class="normal"><a href="#__codelineno-235-30">30</a></span>
<span class="normal"><a href="#__codelineno-235-31">31</a></span>
<span class="normal"><a href="#__codelineno-235-32">32</a></span>
<span class="normal"><a href="#__codelineno-235-33">33</a></span>
<span class="normal"><a href="#__codelineno-235-34">34</a></span>
<span class="normal"><a href="#__codelineno-235-35">35</a></span>
<span class="normal"><a href="#__codelineno-235-36">36</a></span>
<span class="normal"><a href="#__codelineno-235-37">37</a></span>
<span class="normal"><a href="#__codelineno-235-38">38</a></span>
<span class="normal"><a href="#__codelineno-235-39">39</a></span>
<span class="normal"><a href="#__codelineno-235-40">40</a></span>
<span class="normal"><a href="#__codelineno-235-41">41</a></span>
<span class="normal"><a href="#__codelineno-235-42">42</a></span>
<span class="normal"><a href="#__codelineno-235-43">43</a></span>
<span class="normal"><a href="#__codelineno-235-44">44</a></span>
<span class="normal"><a href="#__codelineno-235-45">45</a></span>
<span class="normal"><a href="#__codelineno-235-46">46</a></span>
<span class="normal"><a href="#__codelineno-235-47">47</a></span>
<span class="normal"><a href="#__codelineno-235-48">48</a></span>
<span class="normal"><a href="#__codelineno-235-49">49</a></span>
<span class="normal"><a href="#__codelineno-235-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-235-1"><a id="__codelineno-235-1" name="__codelineno-235-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-235-2"><a id="__codelineno-235-2" name="__codelineno-235-2"></a><span class="w">  </span>volumev2<span class="w"> </span>public<span class="w"> </span>http://controller:8776/v2/%<span class="se">\(</span>project_id<span class="se">\)</span>s
</span><span id="__span-235-3"><a id="__codelineno-235-3" name="__codelineno-235-3"></a>
</span><span id="__span-235-4"><a id="__codelineno-235-4" name="__codelineno-235-4"></a>+---------------+----------------------------------------------------+
</span><span id="__span-235-5"><a id="__codelineno-235-5" name="__codelineno-235-5"></a><span class="p">|</span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-235-6"><a id="__codelineno-235-6" name="__codelineno-235-6"></a>+---------------+----------------------------------------------------+
</span><span id="__span-235-7"><a id="__codelineno-235-7" name="__codelineno-235-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-235-8"><a id="__codelineno-235-8" name="__codelineno-235-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>513e73819e14460fb904163f41ef3759<span class="w">             </span><span class="p">|</span>
</span><span id="__span-235-9"><a id="__codelineno-235-9" name="__codelineno-235-9"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>public<span class="w">                                  </span><span class="p">|</span>
</span><span id="__span-235-10"><a id="__codelineno-235-10" name="__codelineno-235-10"></a><span class="p">|</span><span class="w"> </span>region<span class="w">      </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-235-11"><a id="__codelineno-235-11" name="__codelineno-235-11"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-235-12"><a id="__codelineno-235-12" name="__codelineno-235-12"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>f71529314dab4a4d8eca427e701d209e<span class="w">             </span><span class="p">|</span>
</span><span id="__span-235-13"><a id="__codelineno-235-13" name="__codelineno-235-13"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w">  </span><span class="p">|</span><span class="w"> </span>cinderv2<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-235-14"><a id="__codelineno-235-14" name="__codelineno-235-14"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w">  </span><span class="p">|</span><span class="w"> </span>volumev2<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-235-15"><a id="__codelineno-235-15" name="__codelineno-235-15"></a><span class="p">|</span><span class="w"> </span>url<span class="w">        </span><span class="p">|</span><span class="w"> </span>http://controller:8776/v2/%<span class="o">(</span>project_id<span class="o">)</span>s<span class="w">        </span><span class="p">|</span>
</span><span id="__span-235-16"><a id="__codelineno-235-16" name="__codelineno-235-16"></a>+--------------+-----------------------------------------------------+
</span><span id="__span-235-17"><a id="__codelineno-235-17" name="__codelineno-235-17"></a>
</span><span id="__span-235-18"><a id="__codelineno-235-18" name="__codelineno-235-18"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-235-19"><a id="__codelineno-235-19" name="__codelineno-235-19"></a><span class="w">  </span>volumev2<span class="w"> </span>internal<span class="w"> </span>http://controller:8776/v2/%<span class="se">\(</span>project_id<span class="se">\)</span>s
</span><span id="__span-235-20"><a id="__codelineno-235-20" name="__codelineno-235-20"></a>
</span><span id="__span-235-21"><a id="__codelineno-235-21" name="__codelineno-235-21"></a>+--------------+----------------------------------------------------+
</span><span id="__span-235-22"><a id="__codelineno-235-22" name="__codelineno-235-22"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">      </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-235-23"><a id="__codelineno-235-23" name="__codelineno-235-23"></a>+--------------+----------------------------------------------------+
</span><span id="__span-235-24"><a id="__codelineno-235-24" name="__codelineno-235-24"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-235-25"><a id="__codelineno-235-25" name="__codelineno-235-25"></a><span class="p">|</span><span class="w"> </span>id<span class="w">        </span><span class="p">|</span><span class="w"> </span>09753b537ac74422a68d2d791cf3714f<span class="w">             </span><span class="p">|</span>
</span><span id="__span-235-26"><a id="__codelineno-235-26" name="__codelineno-235-26"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">   </span><span class="p">|</span><span class="w"> </span>internal<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-235-27"><a id="__codelineno-235-27" name="__codelineno-235-27"></a><span class="p">|</span><span class="w"> </span>region<span class="w">     </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-235-28"><a id="__codelineno-235-28" name="__codelineno-235-28"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-235-29"><a id="__codelineno-235-29" name="__codelineno-235-29"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>f71529314dab4a4d8eca427e701d209e<span class="w">              </span><span class="p">|</span>
</span><span id="__span-235-30"><a id="__codelineno-235-30" name="__codelineno-235-30"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>cinderv2<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-235-31"><a id="__codelineno-235-31" name="__codelineno-235-31"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>volumev2<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-235-32"><a id="__codelineno-235-32" name="__codelineno-235-32"></a><span class="p">|</span><span class="w"> </span>url<span class="w">       </span><span class="p">|</span><span class="w"> </span>http://controller:8776/v2/%<span class="o">(</span>project_id<span class="o">)</span>s<span class="w">        </span><span class="p">|</span>
</span><span id="__span-235-33"><a id="__codelineno-235-33" name="__codelineno-235-33"></a>+--------------+----------------------------------------------------+
</span><span id="__span-235-34"><a id="__codelineno-235-34" name="__codelineno-235-34"></a>
</span><span id="__span-235-35"><a id="__codelineno-235-35" name="__codelineno-235-35"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-235-36"><a id="__codelineno-235-36" name="__codelineno-235-36"></a><span class="w">  </span>volumev2<span class="w"> </span>admin<span class="w"> </span>http://controller:8776/v2/%<span class="se">\(</span>project_id<span class="se">\)</span>s
</span><span id="__span-235-37"><a id="__codelineno-235-37" name="__codelineno-235-37"></a>
</span><span id="__span-235-38"><a id="__codelineno-235-38" name="__codelineno-235-38"></a>+---------------+----------------------------------------------------+
</span><span id="__span-235-39"><a id="__codelineno-235-39" name="__codelineno-235-39"></a><span class="p">|</span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-235-40"><a id="__codelineno-235-40" name="__codelineno-235-40"></a>+---------------+----------------------------------------------------+
</span><span id="__span-235-41"><a id="__codelineno-235-41" name="__codelineno-235-41"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-235-42"><a id="__codelineno-235-42" name="__codelineno-235-42"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>e652cf84dd334f359ae9b045a2c91d96<span class="w">             </span><span class="p">|</span>
</span><span id="__span-235-43"><a id="__codelineno-235-43" name="__codelineno-235-43"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>admin<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-235-44"><a id="__codelineno-235-44" name="__codelineno-235-44"></a><span class="p">|</span><span class="w"> </span>region<span class="w">      </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-235-45"><a id="__codelineno-235-45" name="__codelineno-235-45"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-235-46"><a id="__codelineno-235-46" name="__codelineno-235-46"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>eb9fd245bdbc414695952e93f29fe3ac<span class="w">             </span><span class="p">|</span>
</span><span id="__span-235-47"><a id="__codelineno-235-47" name="__codelineno-235-47"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w">  </span><span class="p">|</span><span class="w"> </span>cinderv2<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-235-48"><a id="__codelineno-235-48" name="__codelineno-235-48"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w">  </span><span class="p">|</span><span class="w"> </span>volumev2<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-235-49"><a id="__codelineno-235-49" name="__codelineno-235-49"></a><span class="p">|</span><span class="w"> </span>url<span class="w">        </span><span class="p">|</span><span class="w"> </span>http://controller:8776/v2/%<span class="o">(</span>project_id<span class="o">)</span>s<span class="w">        </span><span class="p">|</span>
</span><span id="__span-235-50"><a id="__codelineno-235-50" name="__codelineno-235-50"></a>+--------------+-----------------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<h4 id="_21"></h4>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-236-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-236-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-236-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-236-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-236-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-236-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-236-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-236-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-236-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-236-10">10</a></span>
<span class="normal"><a href="#__codelineno-236-11">11</a></span>
<span class="normal"><a href="#__codelineno-236-12">12</a></span>
<span class="normal"><a href="#__codelineno-236-13">13</a></span>
<span class="normal"><a href="#__codelineno-236-14">14</a></span>
<span class="normal"><a href="#__codelineno-236-15">15</a></span>
<span class="normal"><a href="#__codelineno-236-16">16</a></span>
<span class="normal"><a href="#__codelineno-236-17">17</a></span>
<span class="normal"><a href="#__codelineno-236-18">18</a></span>
<span class="normal"><a href="#__codelineno-236-19">19</a></span>
<span class="normal"><a href="#__codelineno-236-20">20</a></span>
<span class="normal"><a href="#__codelineno-236-21">21</a></span>
<span class="normal"><a href="#__codelineno-236-22">22</a></span>
<span class="normal"><a href="#__codelineno-236-23">23</a></span>
<span class="normal"><a href="#__codelineno-236-24">24</a></span>
<span class="normal"><a href="#__codelineno-236-25">25</a></span>
<span class="normal"><a href="#__codelineno-236-26">26</a></span>
<span class="normal"><a href="#__codelineno-236-27">27</a></span>
<span class="normal"><a href="#__codelineno-236-28">28</a></span>
<span class="normal"><a href="#__codelineno-236-29">29</a></span>
<span class="normal"><a href="#__codelineno-236-30">30</a></span>
<span class="normal"><a href="#__codelineno-236-31">31</a></span>
<span class="normal"><a href="#__codelineno-236-32">32</a></span>
<span class="normal"><a href="#__codelineno-236-33">33</a></span>
<span class="normal"><a href="#__codelineno-236-34">34</a></span>
<span class="normal"><a href="#__codelineno-236-35">35</a></span>
<span class="normal"><a href="#__codelineno-236-36">36</a></span>
<span class="normal"><a href="#__codelineno-236-37">37</a></span>
<span class="normal"><a href="#__codelineno-236-38">38</a></span>
<span class="normal"><a href="#__codelineno-236-39">39</a></span>
<span class="normal"><a href="#__codelineno-236-40">40</a></span>
<span class="normal"><a href="#__codelineno-236-41">41</a></span>
<span class="normal"><a href="#__codelineno-236-42">42</a></span>
<span class="normal"><a href="#__codelineno-236-43">43</a></span>
<span class="normal"><a href="#__codelineno-236-44">44</a></span>
<span class="normal"><a href="#__codelineno-236-45">45</a></span>
<span class="normal"><a href="#__codelineno-236-46">46</a></span>
<span class="normal"><a href="#__codelineno-236-47">47</a></span>
<span class="normal"><a href="#__codelineno-236-48">48</a></span>
<span class="normal"><a href="#__codelineno-236-49">49</a></span>
<span class="normal"><a href="#__codelineno-236-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-236-1"><a id="__codelineno-236-1" name="__codelineno-236-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-236-2"><a id="__codelineno-236-2" name="__codelineno-236-2"></a><span class="w">  </span>volumev3<span class="w"> </span>public<span class="w"> </span>http://controller:8776/v3/%<span class="se">\(</span>project_id<span class="se">\)</span>s
</span><span id="__span-236-3"><a id="__codelineno-236-3" name="__codelineno-236-3"></a>
</span><span id="__span-236-4"><a id="__codelineno-236-4" name="__codelineno-236-4"></a>+---------------+----------------------------------------------------+
</span><span id="__span-236-5"><a id="__codelineno-236-5" name="__codelineno-236-5"></a><span class="p">|</span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-236-6"><a id="__codelineno-236-6" name="__codelineno-236-6"></a>+---------------+----------------------------------------------------+
</span><span id="__span-236-7"><a id="__codelineno-236-7" name="__codelineno-236-7"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-236-8"><a id="__codelineno-236-8" name="__codelineno-236-8"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>03fa2c90153546c295bf30ca86b1344b<span class="w">             </span><span class="p">|</span>
</span><span id="__span-236-9"><a id="__codelineno-236-9" name="__codelineno-236-9"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>public<span class="w">                                  </span><span class="p">|</span>
</span><span id="__span-236-10"><a id="__codelineno-236-10" name="__codelineno-236-10"></a><span class="p">|</span><span class="w"> </span>region<span class="w">      </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-236-11"><a id="__codelineno-236-11" name="__codelineno-236-11"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-236-12"><a id="__codelineno-236-12" name="__codelineno-236-12"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>ab3bbbef780845a1a283490d281e7fda<span class="w">             </span><span class="p">|</span>
</span><span id="__span-236-13"><a id="__codelineno-236-13" name="__codelineno-236-13"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w">  </span><span class="p">|</span><span class="w"> </span>cinderv3<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-236-14"><a id="__codelineno-236-14" name="__codelineno-236-14"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w">  </span><span class="p">|</span><span class="w"> </span>volumev3<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-236-15"><a id="__codelineno-236-15" name="__codelineno-236-15"></a><span class="p">|</span><span class="w"> </span>url<span class="w">        </span><span class="p">|</span><span class="w"> </span>http://controller:8776/v3/%<span class="o">(</span>project_id<span class="o">)</span>s<span class="w">        </span><span class="p">|</span>
</span><span id="__span-236-16"><a id="__codelineno-236-16" name="__codelineno-236-16"></a>+--------------+-----------------------------------------------------+
</span><span id="__span-236-17"><a id="__codelineno-236-17" name="__codelineno-236-17"></a>
</span><span id="__span-236-18"><a id="__codelineno-236-18" name="__codelineno-236-18"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-236-19"><a id="__codelineno-236-19" name="__codelineno-236-19"></a><span class="w">  </span>volumev3<span class="w"> </span>internal<span class="w"> </span>http://controller:8776/v3/%<span class="se">\(</span>project_id<span class="se">\)</span>s
</span><span id="__span-236-20"><a id="__codelineno-236-20" name="__codelineno-236-20"></a>
</span><span id="__span-236-21"><a id="__codelineno-236-21" name="__codelineno-236-21"></a>+--------------+----------------------------------------------------+
</span><span id="__span-236-22"><a id="__codelineno-236-22" name="__codelineno-236-22"></a><span class="p">|</span><span class="w"> </span>Field<span class="w">      </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-236-23"><a id="__codelineno-236-23" name="__codelineno-236-23"></a>+--------------+----------------------------------------------------+
</span><span id="__span-236-24"><a id="__codelineno-236-24" name="__codelineno-236-24"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-236-25"><a id="__codelineno-236-25" name="__codelineno-236-25"></a><span class="p">|</span><span class="w"> </span>id<span class="w">        </span><span class="p">|</span><span class="w"> </span>94f684395d1b41068c70e4ecb11364b2<span class="w">             </span><span class="p">|</span>
</span><span id="__span-236-26"><a id="__codelineno-236-26" name="__codelineno-236-26"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">   </span><span class="p">|</span><span class="w"> </span>internal<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-236-27"><a id="__codelineno-236-27" name="__codelineno-236-27"></a><span class="p">|</span><span class="w"> </span>region<span class="w">     </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-236-28"><a id="__codelineno-236-28" name="__codelineno-236-28"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-236-29"><a id="__codelineno-236-29" name="__codelineno-236-29"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>ab3bbbef780845a1a283490d281e7fda<span class="w">              </span><span class="p">|</span>
</span><span id="__span-236-30"><a id="__codelineno-236-30" name="__codelineno-236-30"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>cinderv3<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-236-31"><a id="__codelineno-236-31" name="__codelineno-236-31"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w"> </span><span class="p">|</span><span class="w"> </span>volumev3<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-236-32"><a id="__codelineno-236-32" name="__codelineno-236-32"></a><span class="p">|</span><span class="w"> </span>url<span class="w">       </span><span class="p">|</span><span class="w"> </span>http://controller:8776/v3/%<span class="o">(</span>project_id<span class="o">)</span>s<span class="w">        </span><span class="p">|</span>
</span><span id="__span-236-33"><a id="__codelineno-236-33" name="__codelineno-236-33"></a>+--------------+----------------------------------------------------+
</span><span id="__span-236-34"><a id="__codelineno-236-34" name="__codelineno-236-34"></a>
</span><span id="__span-236-35"><a id="__codelineno-236-35" name="__codelineno-236-35"></a>$<span class="w"> </span>openstack<span class="w"> </span>endpoint<span class="w"> </span>create<span class="w"> </span>--region<span class="w"> </span>RegionOne<span class="w"> </span><span class="se">\</span>
</span><span id="__span-236-36"><a id="__codelineno-236-36" name="__codelineno-236-36"></a><span class="w">  </span>volumev3<span class="w"> </span>admin<span class="w"> </span>http://controller:8776/v3/%<span class="se">\(</span>project_id<span class="se">\)</span>s
</span><span id="__span-236-37"><a id="__codelineno-236-37" name="__codelineno-236-37"></a>
</span><span id="__span-236-38"><a id="__codelineno-236-38" name="__codelineno-236-38"></a>+---------------+----------------------------------------------------+
</span><span id="__span-236-39"><a id="__codelineno-236-39" name="__codelineno-236-39"></a><span class="p">|</span>Field<span class="w">       </span><span class="p">|</span><span class="w"> </span>Value<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-236-40"><a id="__codelineno-236-40" name="__codelineno-236-40"></a>+---------------+----------------------------------------------------+
</span><span id="__span-236-41"><a id="__codelineno-236-41" name="__codelineno-236-41"></a><span class="p">|</span><span class="w"> </span>enabled<span class="w">     </span><span class="p">|</span><span class="w"> </span>True<span class="w">                                </span><span class="p">|</span>
</span><span id="__span-236-42"><a id="__codelineno-236-42" name="__codelineno-236-42"></a><span class="p">|</span><span class="w"> </span>id<span class="w">          </span><span class="p">|</span><span class="w"> </span>4511c28a0f9840c78bacb25f10f62c98<span class="w">             </span><span class="p">|</span>
</span><span id="__span-236-43"><a id="__codelineno-236-43" name="__codelineno-236-43"></a><span class="p">|</span><span class="w"> </span>interface<span class="w">    </span><span class="p">|</span><span class="w"> </span>admin<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-236-44"><a id="__codelineno-236-44" name="__codelineno-236-44"></a><span class="p">|</span><span class="w"> </span>region<span class="w">      </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                              </span><span class="p">|</span>
</span><span id="__span-236-45"><a id="__codelineno-236-45" name="__codelineno-236-45"></a><span class="p">|</span><span class="w"> </span>region_id<span class="w">    </span><span class="p">|</span><span class="w"> </span>RegionOne<span class="w">                               </span><span class="p">|</span>
</span><span id="__span-236-46"><a id="__codelineno-236-46" name="__codelineno-236-46"></a><span class="p">|</span><span class="w"> </span>service_id<span class="w">   </span><span class="p">|</span><span class="w"> </span>ab3bbbef780845a1a283490d281e7fda<span class="w">             </span><span class="p">|</span>
</span><span id="__span-236-47"><a id="__codelineno-236-47" name="__codelineno-236-47"></a><span class="p">|</span><span class="w"> </span>service_name<span class="w">  </span><span class="p">|</span><span class="w"> </span>cinderv3<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-236-48"><a id="__codelineno-236-48" name="__codelineno-236-48"></a><span class="p">|</span><span class="w"> </span>service_type<span class="w">  </span><span class="p">|</span><span class="w"> </span>volumev3<span class="w">                             </span><span class="p">|</span>
</span><span id="__span-236-49"><a id="__codelineno-236-49" name="__codelineno-236-49"></a><span class="p">|</span><span class="w"> </span>url<span class="w">        </span><span class="p">|</span><span class="w"> </span>http://controller:8776/v3/%<span class="o">(</span>project_id<span class="o">)</span>s<span class="w">        </span><span class="p">|</span>
</span><span id="__span-236-50"><a id="__codelineno-236-50" name="__codelineno-236-50"></a>+--------------+-----------------------------------------------------+
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意</strong>:块存储服务需要每个服务实体的终端。</p>
</blockquote>
<h3 id="_22">安装和配置组件：</h3>
<ul>
<li>1.安装：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-237-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-237-1"><a id="__codelineno-237-1" name="__codelineno-237-1"></a>$<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-cinder
</span></code></pre></div></td></tr></table></div>
<ul>
<li></li>
<li>
<p>2.编辑文件<code>/etc/cinder/cinder.conf</code>并完成下列命令：</p>
</li>
<li>
<p>在该<code>[database]</code>部分中，配置数据库访问： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-238-1">1</a></span>
<span class="normal"><a href="#__codelineno-238-2">2</a></span>
<span class="normal"><a href="#__codelineno-238-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-238-1"><a id="__codelineno-238-1" name="__codelineno-238-1"></a><span class="o">[</span>database<span class="o">]</span>
</span><span id="__span-238-2"><a id="__codelineno-238-2" name="__codelineno-238-2"></a><span class="c1"># ...</span>
</span><span id="__span-238-3"><a id="__codelineno-238-3" name="__codelineno-238-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder
</span></code></pre></div></td></tr></table></div>
<p>替换<code>CINDER_DBPASS</code>为您为数据库选择的密码。</p>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分中，配置RabbitMQ消息队列： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-239-1">1</a></span>
<span class="normal"><a href="#__codelineno-239-2">2</a></span>
<span class="normal"><a href="#__codelineno-239-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-239-1"><a id="__codelineno-239-1" name="__codelineno-239-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-239-2"><a id="__codelineno-239-2" name="__codelineno-239-2"></a><span class="c1"># ...</span>
</span><span id="__span-239-3"><a id="__codelineno-239-3" name="__codelineno-239-3"></a><span class="nv">transport_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rabbit://openstack:RABBIT_PASS@controller
</span></code></pre></div></td></tr></table></div>
<p>替换<code>RABBIT_PASS</code>为你在RabbitMQ中为openstack账户提供的密码。</p>
</li>
<li>
<p>在该<code>[DEFAULT]</code>部分和<code>[keystone_authtoken]</code>部分中，配置身份服务访问：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-240-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-240-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-240-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-240-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-240-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-240-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-240-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-240-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-240-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-240-10">10</a></span>
<span class="normal"><a href="#__codelineno-240-11">11</a></span>
<span class="normal"><a href="#__codelineno-240-12">12</a></span>
<span class="normal"><a href="#__codelineno-240-13">13</a></span>
<span class="normal"><a href="#__codelineno-240-14">14</a></span>
<span class="normal"><a href="#__codelineno-240-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-240-1"><a id="__codelineno-240-1" name="__codelineno-240-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-240-2"><a id="__codelineno-240-2" name="__codelineno-240-2"></a><span class="c1"># ...</span>
</span><span id="__span-240-3"><a id="__codelineno-240-3" name="__codelineno-240-3"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span><span id="__span-240-4"><a id="__codelineno-240-4" name="__codelineno-240-4"></a>
</span><span id="__span-240-5"><a id="__codelineno-240-5" name="__codelineno-240-5"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-240-6"><a id="__codelineno-240-6" name="__codelineno-240-6"></a><span class="c1"># ...</span>
</span><span id="__span-240-7"><a id="__codelineno-240-7" name="__codelineno-240-7"></a><span class="nv">www_authenticate_uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-240-8"><a id="__codelineno-240-8" name="__codelineno-240-8"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-240-9"><a id="__codelineno-240-9" name="__codelineno-240-9"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-240-10"><a id="__codelineno-240-10" name="__codelineno-240-10"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-240-11"><a id="__codelineno-240-11" name="__codelineno-240-11"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-240-12"><a id="__codelineno-240-12" name="__codelineno-240-12"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-240-13"><a id="__codelineno-240-13" name="__codelineno-240-13"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-240-14"><a id="__codelineno-240-14" name="__codelineno-240-14"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cinder
</span><span id="__span-240-15"><a id="__codelineno-240-15" name="__codelineno-240-15"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CINDER_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>CINDER_PASS</code>为您<code>cinder</code> 在身份服务中为用户选择的密码。 </p>
<blockquote>
<p><strong>注意</strong>:注释掉或删除[keystone_authtoken]部分中的任何其他选项。 </p>
</blockquote>
</li>
<li>
<p>在<code>[DEFAULT]</code>部分中配置my_ip选项来使用控制节点的网络管理接口：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-241-1">1</a></span>
<span class="normal"><a href="#__codelineno-241-2">2</a></span>
<span class="normal"><a href="#__codelineno-241-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-241-1"><a id="__codelineno-241-1" name="__codelineno-241-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-241-2"><a id="__codelineno-241-2" name="__codelineno-241-2"></a><span class="c1"># ...</span>
</span><span id="__span-241-3"><a id="__codelineno-241-3" name="__codelineno-241-3"></a><span class="nv">my_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span>.0.0.11
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>3.在<code>[oslo_concurrency]</code>部分中，配置路径：</p>
</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-242-1">1</a></span>
<span class="normal"><a href="#__codelineno-242-2">2</a></span>
<span class="normal"><a href="#__codelineno-242-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-242-1"><a id="__codelineno-242-1" name="__codelineno-242-1"></a><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span><span id="__span-242-2"><a id="__codelineno-242-2" name="__codelineno-242-2"></a><span class="c1"># ...</span>
</span><span id="__span-242-3"><a id="__codelineno-242-3" name="__codelineno-242-3"></a><span class="nv">lock_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/lib/cinder/tmp
</span></code></pre></div></td></tr></table></div>
<ul>
<li>4.同步块储存数据库：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-243-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-243-1"><a id="__codelineno-243-1" name="__codelineno-243-1"></a>$<span class="w"> </span>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cinder-manage db sync&quot;</span><span class="w"> </span>cinder
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>注意</strong>:忽视任何输出结果。 </p>
</blockquote>
<h3 id="_23">配置计算服务来使用块储存</h3>
<ul>
<li>1.编辑<code>/etc/nova/nova.conf</code>文件并添加如下：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-244-1">1</a></span>
<span class="normal"><a href="#__codelineno-244-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-244-1"><a id="__codelineno-244-1" name="__codelineno-244-1"></a><span class="o">[</span>cinder<span class="o">]</span>
</span><span id="__span-244-2"><a id="__codelineno-244-2" name="__codelineno-244-2"></a><span class="nv">os_region_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>RegionOne
</span></code></pre></div></td></tr></table></div>
<h3 id="_24">最终确定安装</h3>
<ul>
<li>1.重启计算API服务：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-245-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-245-1"><a id="__codelineno-245-1" name="__codelineno-245-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>openstack-nova-api.service
</span></code></pre></div></td></tr></table></div>
<ul>
<li>2.开启块储存服务并设置开机自启：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-246-1">1</a></span>
<span class="normal"><a href="#__codelineno-246-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-246-1"><a id="__codelineno-246-1" name="__codelineno-246-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>openstack-cinder-api.service<span class="w"> </span>openstack-cinder-scheduler.service
</span><span id="__span-246-2"><a id="__codelineno-246-2" name="__codelineno-246-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>openstack-cinder-api.service<span class="w"> </span>openstack-cinder-scheduler.service
</span></code></pre></div></td></tr></table></div>
<h2 id="compute">安装并配置一个储存节点（在compute上完成）</h2>
<h3 id="_25">准备</h3>
<p>在你安装块储存服务前你必须先准备一块额外的储存设备(在虚拟机上添加一块硬盘)</p>
<blockquote>
<p>在存储节点上完成下列步骤</p>
</blockquote>
<ul>
<li>
<p>1.安装支持实用程序包： </p>
</li>
<li>
<p>安装LVM包：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-247-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-247-1"><a id="__codelineno-247-1" name="__codelineno-247-1"></a>$<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>lvm2<span class="w"> </span>device-mapper-persistent-data
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>开启LVM服务并设置开机自启：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-248-1">1</a></span>
<span class="normal"><a href="#__codelineno-248-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-248-1"><a id="__codelineno-248-1" name="__codelineno-248-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>lvm2-lvmetad.service
</span><span id="__span-248-2"><a id="__codelineno-248-2" name="__codelineno-248-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>lvm2-lvmetad.service
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>一些分布默认包括LVM服务</p>
</blockquote>
</li>
<li>
<p>2.创建LVM物理卷<code>/dev/sdb</code>： </p>
</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-249-1">1</a></span>
<span class="normal"><a href="#__codelineno-249-2">2</a></span>
<span class="normal"><a href="#__codelineno-249-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-249-1"><a id="__codelineno-249-1" name="__codelineno-249-1"></a>$<span class="w"> </span>pvcreate<span class="w"> </span>/dev/sdb
</span><span id="__span-249-2"><a id="__codelineno-249-2" name="__codelineno-249-2"></a>成功后显示：
</span><span id="__span-249-3"><a id="__codelineno-249-3" name="__codelineno-249-3"></a>Physical<span class="w"> </span>volume<span class="w"> </span><span class="s2">&quot;/dev/sdb&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created
</span></code></pre></div></td></tr></table></div>
<ul>
<li>3.创建LVM卷组<code>cinder-volumes</code>：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-250-1">1</a></span>
<span class="normal"><a href="#__codelineno-250-2">2</a></span>
<span class="normal"><a href="#__codelineno-250-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-250-1"><a id="__codelineno-250-1" name="__codelineno-250-1"></a>$<span class="w"> </span>vgcreate<span class="w"> </span>cinder-volumes<span class="w"> </span>/dev/sdb
</span><span id="__span-250-2"><a id="__codelineno-250-2" name="__codelineno-250-2"></a>成功后显示：
</span><span id="__span-250-3"><a id="__codelineno-250-3" name="__codelineno-250-3"></a>Volume<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;cinder-volumes&quot;</span><span class="w"> </span>successfully<span class="w"> </span>created
</span></code></pre></div></td></tr></table></div>
<p>块存储服务在此卷组中创建逻辑卷。</p>
<ul>
<li>
<p>4.只有实例才能访问块存储卷。但是，底层操作系统管理与卷关联的设备。默认情况下，LVM卷扫描工具扫描<code>/dev</code>目录以查找包含卷的块存储设备。如果项目在其卷上使用LVM，扫描工具将检测这些卷并尝试缓存它们，这可能会导致底层操作系统和项目卷出现各种问题。必须重新配置LVM，以便仅扫描包含cinder卷卷组的设备。编辑<code>/etc/lvm/lvm.conf</code>文件并完成以下操作：</p>
</li>
<li>
<p>在devices选项中，增加一个接受<code>/dev/sdb</code>设备并拒绝所有其他设备的筛选器：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-251-1">1</a></span>
<span class="normal"><a href="#__codelineno-251-2">2</a></span>
<span class="normal"><a href="#__codelineno-251-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-251-1"><a id="__codelineno-251-1" name="__codelineno-251-1"></a>devices<span class="w"> </span><span class="o">{</span>
</span><span id="__span-251-2"><a id="__codelineno-251-2" name="__codelineno-251-2"></a>...
</span><span id="__span-251-3"><a id="__codelineno-251-3" name="__codelineno-251-3"></a><span class="nv">filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;a/sda/&quot;</span>,<span class="w"> </span><span class="s2">&quot;a/sdb/&quot;</span>,<span class="w"> </span><span class="s2">&quot;r/.*/&quot;</span><span class="o">]</span>
</span></code></pre></div></td></tr></table></div>
<p>筛选器数组中的每个项都以<code>for accept</code>或<code>r for reject</code>开头，并包含设备名称的正则表达式。数组必须以r/*/结尾才能拒绝任何剩余的设备。你可以使用<code>vgs-vvvv</code>命令来测试过滤器。</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-252-1">1</a></span>
<span class="normal"><a href="#__codelineno-252-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-252-1"><a id="__codelineno-252-1" name="__codelineno-252-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>lvm2-lvmetad.service
</span><span id="__span-252-2"><a id="__codelineno-252-2" name="__codelineno-252-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>lvm2-lvmetad.service
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>一些分布默认包括LVM服务</p>
</blockquote>
</li>
</ul>
<h3 id="_26">安装和配置组件</h3>
<ul>
<li>1.安装支持实用程序包： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-253-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-253-1"><a id="__codelineno-253-1" name="__codelineno-253-1"></a>$<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-cinder<span class="w"> </span>targetcli<span class="w"> </span>python-keystone
</span></code></pre></div></td></tr></table></div>
<ul>
<li>
<p>2.编辑<code>/etc/cinder/cinder.conf</code>文件并完成下列操作： </p>
</li>
<li>
<p>在<code>[database]</code>选项，配置数据库：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-254-1">1</a></span>
<span class="normal"><a href="#__codelineno-254-2">2</a></span>
<span class="normal"><a href="#__codelineno-254-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-254-1"><a id="__codelineno-254-1" name="__codelineno-254-1"></a><span class="o">[</span>database<span class="o">]</span>
</span><span id="__span-254-2"><a id="__codelineno-254-2" name="__codelineno-254-2"></a><span class="c1"># ...</span>
</span><span id="__span-254-3"><a id="__codelineno-254-3" name="__codelineno-254-3"></a><span class="nv">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>mysql+pymysql://cinder:CINDER_DBPASS@controller/cinder
</span></code></pre></div></td></tr></table></div>
<p>替换<code>CINDER_DBPASS</code>为你的用于块储存数据库的密码。</p>
</li>
<li>
<p>在<code>[DEFAULT]</code>选项中配置<code>RabbitMQ</code>消息队列：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-255-1">1</a></span>
<span class="normal"><a href="#__codelineno-255-2">2</a></span>
<span class="normal"><a href="#__codelineno-255-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-255-1"><a id="__codelineno-255-1" name="__codelineno-255-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-255-2"><a id="__codelineno-255-2" name="__codelineno-255-2"></a><span class="c1"># ...</span>
</span><span id="__span-255-3"><a id="__codelineno-255-3" name="__codelineno-255-3"></a><span class="nv">transport_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>rabbit://openstack:RABBIT_PASS@controller
</span></code></pre></div></td></tr></table></div>
<p>替换<code>RABBIT_PASS</code>为你的用于RABBITMQ中openstack账户的密码。</p>
</li>
<li>
<p>在<code>[DEFAULT]</code>和<code>[keystone_authtoken]</code>选项中配置身份认证：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-256-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-256-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-256-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-256-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-256-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-256-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-256-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-256-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-256-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-256-10">10</a></span>
<span class="normal"><a href="#__codelineno-256-11">11</a></span>
<span class="normal"><a href="#__codelineno-256-12">12</a></span>
<span class="normal"><a href="#__codelineno-256-13">13</a></span>
<span class="normal"><a href="#__codelineno-256-14">14</a></span>
<span class="normal"><a href="#__codelineno-256-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-256-1"><a id="__codelineno-256-1" name="__codelineno-256-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-256-2"><a id="__codelineno-256-2" name="__codelineno-256-2"></a><span class="c1"># ...</span>
</span><span id="__span-256-3"><a id="__codelineno-256-3" name="__codelineno-256-3"></a><span class="nv">auth_strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>keystone
</span><span id="__span-256-4"><a id="__codelineno-256-4" name="__codelineno-256-4"></a>
</span><span id="__span-256-5"><a id="__codelineno-256-5" name="__codelineno-256-5"></a><span class="o">[</span>keystone_authtoken<span class="o">]</span>
</span><span id="__span-256-6"><a id="__codelineno-256-6" name="__codelineno-256-6"></a><span class="c1"># ...</span>
</span><span id="__span-256-7"><a id="__codelineno-256-7" name="__codelineno-256-7"></a><span class="nv">www_authenticate_uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-256-8"><a id="__codelineno-256-8" name="__codelineno-256-8"></a><span class="nv">auth_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:5000
</span><span id="__span-256-9"><a id="__codelineno-256-9" name="__codelineno-256-9"></a><span class="nv">memcached_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>controller:11211
</span><span id="__span-256-10"><a id="__codelineno-256-10" name="__codelineno-256-10"></a><span class="nv">auth_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>password
</span><span id="__span-256-11"><a id="__codelineno-256-11" name="__codelineno-256-11"></a><span class="nv">project_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-256-12"><a id="__codelineno-256-12" name="__codelineno-256-12"></a><span class="nv">user_domain_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default
</span><span id="__span-256-13"><a id="__codelineno-256-13" name="__codelineno-256-13"></a><span class="nv">project_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>service
</span><span id="__span-256-14"><a id="__codelineno-256-14" name="__codelineno-256-14"></a><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cinder
</span><span id="__span-256-15"><a id="__codelineno-256-15" name="__codelineno-256-15"></a><span class="nv">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>CINDER_PASS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>CINDER_DBPASS</code>为你的用于块储存数据库的密码。</p>
<blockquote>
<p>去除在<code>[keystone_authtoken]</code>项目中所有除上面输入内容之外的其他内容</p>
</blockquote>
</li>
<li>
<p>在<code>[DEFAULT]</code>选项中配置<code>[my_ip]</code>选项：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-257-1">1</a></span>
<span class="normal"><a href="#__codelineno-257-2">2</a></span>
<span class="normal"><a href="#__codelineno-257-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-257-1"><a id="__codelineno-257-1" name="__codelineno-257-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-257-2"><a id="__codelineno-257-2" name="__codelineno-257-2"></a><span class="c1"># ...</span>
</span><span id="__span-257-3"><a id="__codelineno-257-3" name="__codelineno-257-3"></a><span class="nv">my_ip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>MANAGEMENT_INTERFACE_IP_ADDRESS
</span></code></pre></div></td></tr></table></div>
<p>替换<code>MANAGEMENT_INTERFACE_IP_ADDRESS</code>为你存储节点上的管理接口ip地址。</p>
</li>
<li>
<p>在<code>[lvm]</code>选项中配置使用LVM驱动程序、<code>cinder-volume</code>卷组、iSCSI协议和适当的iSCSI服务配置LVM后端。如果<code>[lvm]</code>部分不存在，则创建它： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-258-1">1</a></span>
<span class="normal"><a href="#__codelineno-258-2">2</a></span>
<span class="normal"><a href="#__codelineno-258-3">3</a></span>
<span class="normal"><a href="#__codelineno-258-4">4</a></span>
<span class="normal"><a href="#__codelineno-258-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-258-1"><a id="__codelineno-258-1" name="__codelineno-258-1"></a><span class="o">[</span>lvm<span class="o">]</span>
</span><span id="__span-258-2"><a id="__codelineno-258-2" name="__codelineno-258-2"></a><span class="nv">volume_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cinder.volume.drivers.lvm.LVMVolumeDriver
</span><span id="__span-258-3"><a id="__codelineno-258-3" name="__codelineno-258-3"></a><span class="nv">volume_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cinder-volumes
</span><span id="__span-258-4"><a id="__codelineno-258-4" name="__codelineno-258-4"></a><span class="nv">target_protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>iscsi
</span><span id="__span-258-5"><a id="__codelineno-258-5" name="__codelineno-258-5"></a><span class="nv">target_helper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lioadm
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在<code>[DEFAULT]</code>选项中启用LVM后端：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-259-1">1</a></span>
<span class="normal"><a href="#__codelineno-259-2">2</a></span>
<span class="normal"><a href="#__codelineno-259-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-259-1"><a id="__codelineno-259-1" name="__codelineno-259-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-259-2"><a id="__codelineno-259-2" name="__codelineno-259-2"></a><span class="c1"># ...</span>
</span><span id="__span-259-3"><a id="__codelineno-259-3" name="__codelineno-259-3"></a><span class="nv">enabled_backends</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>lvm
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>注意 </p>
<p>后端名称是任意的。例如，本指南使用驱动程序的名称作为后端的名称。</p>
</blockquote>
</li>
<li>
<p>在<code>[DEFAULT]</code>选项中配置映像服务API的位置： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-260-1">1</a></span>
<span class="normal"><a href="#__codelineno-260-2">2</a></span>
<span class="normal"><a href="#__codelineno-260-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-260-1"><a id="__codelineno-260-1" name="__codelineno-260-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-260-2"><a id="__codelineno-260-2" name="__codelineno-260-2"></a><span class="c1"># ...</span>
</span><span id="__span-260-3"><a id="__codelineno-260-3" name="__codelineno-260-3"></a><span class="nv">glance_api_servers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>http://controller:9292
</span></code></pre></div></td></tr></table></div>
</li>
<li>
<p>在<code>[oslo_concurrency]</code>选项中配置锁定路径：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-261-1">1</a></span>
<span class="normal"><a href="#__codelineno-261-2">2</a></span>
<span class="normal"><a href="#__codelineno-261-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-261-1"><a id="__codelineno-261-1" name="__codelineno-261-1"></a><span class="o">[</span>oslo_concurrency<span class="o">]</span>
</span><span id="__span-261-2"><a id="__codelineno-261-2" name="__codelineno-261-2"></a><span class="c1"># ...</span>
</span><span id="__span-261-3"><a id="__codelineno-261-3" name="__codelineno-261-3"></a><span class="nv">lock_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>/var/lib/cinder/tmp
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<p>### 最终安装</p>
<ul>
<li>4.启动块存储卷服务（包括其依赖项），并将其配置为在系统启动时启动： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-262-1">1</a></span>
<span class="normal"><a href="#__codelineno-262-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-262-1"><a id="__codelineno-262-1" name="__codelineno-262-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>openstack-cinder-volume.service<span class="w"> </span>target.service
</span><span id="__span-262-2"><a id="__codelineno-262-2" name="__codelineno-262-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>openstack-cinder-volume.service<span class="w"> </span>target.service
</span></code></pre></div></td></tr></table></div>
<h2 id="_27">安装并配置一个备份节点</h2>
<p>（可选）安装和配置备份服务。为了简单起见，此配置使用块存储节点和对象存储（swift）驱动程序，因此依赖于对象存储服务。 </p>
<blockquote>
<p>注意：在安装和配置备份服务之前，必须安装和配置存储节点。</p>
</blockquote>
<h3 id="_28">安装并配置组件</h3>
<blockquote>
<p>注意：在块存储节点上执行以下步骤。</p>
</blockquote>
<ul>
<li>1.安装程序包： </li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-263-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-263-1"><a id="__codelineno-263-1" name="__codelineno-263-1"></a>$<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>openstack-cinder
</span></code></pre></div></td></tr></table></div>
<ul>
<li>
<p>2.编辑<code>/etc/cinder/cinder.conf</code>文件并完成下列操作： </p>
</li>
<li>
<p>在<code>[DEFAULT]</code>选项中配置备份选项 ：</p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-264-1">1</a></span>
<span class="normal"><a href="#__codelineno-264-2">2</a></span>
<span class="normal"><a href="#__codelineno-264-3">3</a></span>
<span class="normal"><a href="#__codelineno-264-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-264-1"><a id="__codelineno-264-1" name="__codelineno-264-1"></a><span class="o">[</span>DEFAULT<span class="o">]</span>
</span><span id="__span-264-2"><a id="__codelineno-264-2" name="__codelineno-264-2"></a><span class="c1"># ...</span>
</span><span id="__span-264-3"><a id="__codelineno-264-3" name="__codelineno-264-3"></a><span class="nv">backup_driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>cinder.backup.drivers.swift
</span><span id="__span-264-4"><a id="__codelineno-264-4" name="__codelineno-264-4"></a><span class="nv">backup_swift_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SWIFT_URL
</span></code></pre></div></td></tr></table></div>
<blockquote>
<p>将SWIFT_URL替换为对象存储服务的URL。URL可以通过显示对象存储API终结点来找到： </p>
</blockquote>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-265-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-265-1"><a id="__codelineno-265-1" name="__codelineno-265-1"></a>$<span class="w"> </span>openstack<span class="w"> </span>catalog<span class="w"> </span>show<span class="w"> </span>object-store
</span></code></pre></div></td></tr></table></div>
</li>
</ul>
<h3 id="_29">最终安装</h3>
<p>启动块存储备份服务，并将其配置为在系统启动时启动： </p>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-266-1">1</a></span>
<span class="normal"><a href="#__codelineno-266-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-266-1"><a id="__codelineno-266-1" name="__codelineno-266-1"></a>$<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>openstack-cinder-backup.service
</span><span id="__span-266-2"><a id="__codelineno-266-2" name="__codelineno-266-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>openstack-cinder-backup.service
</span></code></pre></div></td></tr></table></div>
<h2 id="cinder_1">验证cinder操作</h2>
<p>验证块存储服务的操作。</p>
<blockquote>
<p>注意：在控制器节点上执行这些命令。 </p>
</blockquote>
<ul>
<li>1.获取管理员凭据以访问仅限管理员的CLI命令：</li>
</ul>
<div class="language-shell highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-267-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-267-1"><a id="__codelineno-267-1" name="__codelineno-267-1"></a>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>admin-openrc
</span></code></pre></div></td></tr></table></div>
<ul>
<li>
<p>2.列出服务组件以验证每个进程是否成功启动：  </p>
</li>
<li>
<p><code>$ openstack volume service list
  +------------------+------------+------+---------+-------+----------------------------+
  | Binary        | Host     | Zone | Status  | State | Updated_at            |
  +------------------+------------+------+---------+-------+----------------------------+
  | cinder-scheduler | controller | nova | enabled | up   | 2016-09-30T02:27:41.000000 |
  | cinder-volume   | block@lvm  | nova | enabled | up   | 2016-09-30T02:27:46.000000 |
  | cinder-backup   | controller | nova | enabled | up   | 2016-09-30T02:27:41.000000 |
  +------------------+------------+------+---------+-------+----------------------------+</code></p>
</li>
</ul>
<h2 id="_30"></h2>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../%E5%87%A0%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84%E6%9C%AF%E8%AF%AD/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 几个有用的术语">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                几个有用的术语
              </div>
            </div>
          </a>
        
        
          
          <a href="../%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B/" class="md-footer__link md-footer__link--next" aria-label="下一页: 服务安装流程">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                服务安装流程
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2016 - 2023 Martin Donath – <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs.sticky", "navigation.path", "navigation.prune", "content.code.copy", "content.action.edit", "content.action.view", "navigation.footer"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c18c5fb9.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>